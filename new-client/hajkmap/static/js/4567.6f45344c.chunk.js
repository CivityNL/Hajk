"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[4567],{74567:(e,t,r)=>{r.r(t);var s=r(72791),i=r(66934),n=r(68870),a=r(20890),o=r(78506),l=r.n(o),d=r(24518),c=r(4110),h=r(48550),u=r(94454),p=r(84795),m=r(17133),F=r(68096),g=r(79012),v=r(85523),f=r(88264),x=r(67394),j=r(55931),k=r(44366),b=r(98246),y=r(80184);const D=(0,i.ZP)("div")((()=>({height:"calc(100% - 60px)",overflowX:"hidden",borderBottom:"1px solid #ccc"}))),T=(0,i.ZP)("div")((()=>({paddingBottom:"10px"})));class S extends s.Component{constructor(e){if(super(e),this.save=()=>{this.props.model.save((e=>{if(e&&e.TransactionResponse&&e.TransactionResponse.TransactionSummary&&e.TransactionResponse.TransactionSummary.totalInserted){const t=e.TransactionResponse.TransactionSummary.totalInserted.toString();Number(t)>0?this.props.options.showThankYou?this.setState({displayThankYou:!0}):this.setState({displayThankYou:!0},(()=>{this.props.model.observer.publish("abort")})):this.saveError()}else this.saveError()}),(e=>{this.saveError()}))},this.saveError=()=>{this.props.model.globalObserver.publish("core.alert","Det gick inte att spara, f\xf6rs\xf6k igen senare.")},this.createMarkup=()=>({__html:this.props.options.thankYou}),e.page.text){var t=l().html2json(e.page.text);this.state={json:t,displayThankYou:!1},this.formErrors={}}}getError(e){return this.formErrors.hasOwnProperty(e.name)?(0,y.jsx)("div",{children:this.formErrors[e.name]}):null}checkInteger(e,t){var r=Object.assign({},this.props.model.formValues);/^\d+$/.test(t)||""===t?r[e]=t:this.props.model.formValues[e]||(r[e]=""),this.props.model.formValues=r,this.forceUpdate()}checkNumber(e,t){var r=Object.assign({},this.props.model.formValues);/^\d+([.,](\d+)?)?$/.test(t)||""===t?(t=t.replace(",","."),r[e]=t):this.props.model.formValues[e]||(r[e]=""),this.props.model.formValues=r,this.forceUpdate()}checkUrl(e,t){var r=/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)|\/|\?)*)?$/i.test(t),s=Object.assign({},this.props.model.formValues);r||""===t?(s[e]=t,delete this.formErrors[e]):(s[e]="",this.formErrors[e]="Ange en giltig url. t.ex. https://www.example.com"),this.props.model.formValues=s,this.forceUpdate()}checkText(e,t){var r=Object.assign({},this.props.model.formValues);r[e]=t,this.props.model.formValues=r,this.forceUpdate()}checkSelect(e,t){var r=Object.assign({},this.props.model.formValues);r[e]=t,this.props.model.formValues=r,this.forceUpdate()}checkMultiple(e,t,r,s){var i=Object.assign({},this.props.model.formValues);i[e][s].checked=t,this.props.model.formValues=i,this.forceUpdate()}checkDate(e,t){var r=Object.assign({},this.props.model.formValues);r[e]=t,this.props.model.formValues=r,this.forceUpdate()}getValueMarkup(e,t){if(!e)return null;"int"===e.dataType&&(e.textType="heltal"),"number"===e.dataType&&(e.textType="nummer"),"date"===e.dataType&&(e.textType="datum");var r=this.props.model.formValues[e.name];switch(void 0!==r&&null!==r||(r=""),""===r&&e.initialRender&&null!==e.defaultValue&&(r=e.defaultValue),Array.isArray(t)&&(t=t.join(" ")),e.textType){case"heltal":return(0,y.jsx)(h.Z,{id:e.id,label:t||e.name,sx:{minWidth:"60%"},margin:"normal",value:r,onChange:t=>{this.checkInteger(e.name,t.target.value),e.initialRender=!1}});case"nummer":return(0,y.jsx)(h.Z,{id:e.id,label:t||e.name,sx:{minWidth:"60%"},margin:"normal",value:r,onChange:t=>{this.checkNumber(e.name,t.target.value),e.initialRender=!1}});case"datum":return(0,y.jsx)(h.Z,{id:e.id,label:t||e.name,sx:{minWidth:"60%"},type:"datetime-local",margin:"normal",value:r,onChange:t=>{this.checkDate(e.name,t.target.value),e.initialRender=!1},InputLabelProps:{shrink:!0}});case"url":case"fritext":return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(h.Z,{id:e.id,multiline:!0,label:t||e.name,sx:{minWidth:"60%"},margin:"normal",value:r,onChange:t=>{this.checkText(e.name,t.target.value),e.initialRender=!1},onBlur:t=>{"url"===e.textType&&this.checkUrl(e.name,t.target.value),e.initialRender=!1}}),this.getError(e)]});case"flerval":let s=[];"string"===typeof e.defaultValue&&(s=e.defaultValue.split(",")),e.initialRender&&s.forEach((e=>{r.forEach((t=>{e===t.value&&(t.checked=!0)}))}));let i=e.values.map(((t,s)=>{var i=e.name+s,n=Array.isArray(r)&&r.find((e=>e.value===t))||{checked:!1};return(0,y.jsx)(v.Z,{control:(0,y.jsx)(u.Z,{checked:n.checked,onChange:r=>{this.checkMultiple(e.name,r.target.checked,t,s),e.initialRender=!1}}),label:t},i)}));return(0,y.jsx)("div",{children:(0,y.jsxs)(F.Z,{component:"fieldset",children:[(0,y.jsx)(m.Z,{component:"legend",children:t||e.name}),(0,y.jsx)(g.Z,{children:i})]})});case"lista":let n=[];return Array.isArray(e.values)&&(n=e.values.map(((e,t)=>(0,y.jsx)("option",{value:e,children:e},t))),void 0!==e.defaultValue&&""!==e.defaultValue||n.unshift((0,y.jsx)("option",{value:"",children:"-V\xe4lj v\xe4rde-"},"-1"))),r&&""!==r||!e.defaultValue||(r=e.defaultValue,!1!==e.initialRender&&setTimeout((()=>{this.checkSelect(e.name,r)}),0)),(0,y.jsx)("div",{children:(0,y.jsxs)(F.Z,{component:"fieldset",children:[(0,y.jsx)(m.Z,{component:"legend",children:t||e.name}),(0,y.jsx)(p.Z,{value:r,input:(0,y.jsx)(c.Z,{name:e.name,id:e.name}),onChange:t=>{this.checkSelect(e.name,t.target.value),e.initialRender=!1},children:n})]})});default:return(0,y.jsx)("span",{children:r})}}getFieldConfig(e){return this.props.serviceConfig.editableFields.find((t=>t.name===e))}renderFromAttribute(e){return e?e.type&&"toolbar"===e.type?(0,y.jsx)(k.default,{ref:"toolbar",field:e.field,geotype:e.geotype,serviceConfig:this.props.serviceConfig,enabled:!0,model:this.props.model,onChangeTool:()=>{window.innerWidth<600&&(this.props.model.globalObserver.publish("core.minimizeWindow"),this.props.enqueueSnackbar("Klicka i kartan f\xf6r att rita objekt"))}}):e.field?this.getValueMarkup(this.getFieldConfig(e.field),e.label):void 0:null}renderFromJsonDom(e){return e&&e.child?e.child.map(((e,t)=>{if("element"===e.node)switch(e.tag){case"div":return(0,y.jsxs)("div",{children:[this.renderFromAttribute(e.attr),this.renderFromJsonDom(e)]},t);case"p":return(0,y.jsxs)("p",{children:[this.renderFromAttribute(e.attr),this.renderFromJsonDom(e)]},t);case"label":return(0,y.jsx)("label",{children:this.renderFromJsonDom(e)},t);case"h1":return(0,y.jsx)(a.Z,{variant:"h1",children:this.renderFromJsonDom(e)},t);case"h2":return(0,y.jsx)(a.Z,{variant:"h2",children:this.renderFromJsonDom(e)},t);case"h3":return(0,y.jsx)(a.Z,{variant:"h3",children:this.renderFromJsonDom(e)},t);case"h4":return(0,y.jsx)(a.Z,{variant:"h4",children:this.renderFromJsonDom(e)},t);case"h5":return(0,y.jsx)(a.Z,{variant:"h5",children:this.renderFromJsonDom(e)},t);case"h6":return(0,y.jsx)(a.Z,{variant:"h6",children:this.renderFromJsonDom(e)},t);case"a":return(0,y.jsx)("a",{href:e.attr.href,rel:"noopener noreferrer",target:"_blank",children:this.renderFromJsonDom(e)},t);case"ul":return(0,y.jsx)("ul",{children:this.renderFromJsonDom(e)},t);case"li":return(0,y.jsx)("li",{children:this.renderFromJsonDom(e)},t);case"br":return(0,y.jsx)("br",{},t);case"img":return(0,y.jsx)("img",{src:e.attr.src,width:e.attr.width,height:e.attr.height,alt:e.attr.alt,children:this.renderFromJsonDom(e)},t);default:return null}return"text"===e.node?(0,y.jsx)("span",{children:e.text},t):null})):null}renderButtons(){const{page:e,numPages:t,onPrevPage:r,onNextPage:s}=this.props,i=(0,y.jsx)(d.Z,{variant:"contained",sx:{float:"left",margin:1},onClick:()=>{"undefined"!==typeof this.refs.toolbar&&this.refs.toolbar.storeValues(),r()},children:(0,y.jsx)(x.Z,{})}),n=(0,y.jsx)(d.Z,{variant:"contained",sx:{float:"right",margin:1},onClick:()=>{"undefined"!==typeof this.refs.toolbar&&this.refs.toolbar.storeValues(),s()},children:(0,y.jsx)(f.Z,{})}),a=(0,y.jsx)(d.Z,{variant:"contained",sx:{float:"right",margin:1},onClick:this.save,children:"Skicka"}),o=(0,y.jsx)(d.Z,{variant:"contained",sx:{float:"right",margin:1},onClick:()=>{this.props.model.observer.publish("abort")},children:this.props.options.collectAgain?"Tyck till igen":"St\xe4ng"}),l=(0,y.jsx)(d.Z,{variant:"contained",sx:{float:"right",margin:1},onClick:()=>{this.props.model.app.windows.forEach((e=>{"collector"===e.type&&e.closeWindow()}))},children:"Sluiten"});return this.state.displayThankYou?this.props.options.collectAgain?(0,y.jsxs)("div",{children:[o,l]}):(0,y.jsx)("div",{children:o}):1===t?(0,y.jsx)("div",{children:a}):t>1&&e.order===t-1?(0,y.jsxs)("div",{children:[i,a]}):e.order>0&&e.order<t-1?(0,y.jsxs)("div",{children:[i,n]}):0===e.order?(0,y.jsx)("div",{children:n}):null}renderThankYou(){return(0,y.jsx)("div",{dangerouslySetInnerHTML:this.createMarkup()})}renderSlide(){const{page:e}=this.props,{json:t}=this.state;return(0,y.jsx)(j.Z,{direction:this.props.direction||"left",in:!0,mountOnEnter:!0,unmountOnExit:!0,sx:{height:"100%"},children:(0,y.jsxs)("div",{children:[(0,y.jsx)(a.Z,{variant:"h4",children:e.header}),(0,y.jsx)(T,{children:this.renderFromJsonDom(t)})]})})}render(){const{displayThankYou:e}=this.state;return this.props.active&&(0,y.jsxs)(n.Z,{sx:{height:"100%"},children:[(0,y.jsx)(D,{children:e?this.renderThankYou():this.renderSlide()}),(0,y.jsx)("div",{children:this.renderButtons()})]})}}t.default=(0,b.RM)(S)},44366:(e,t,r)=>{r.r(t);var s=r(72791),i=r(66934),n=r(24518),a=r(16426),o=r(21456),l=r(43526),d=r(20890),c=r(27982),h=r(80184);const u=(0,i.ZP)(n.Z)((e=>{let{theme:t}=e;return{margin:t.spacing(1),width:"115px"}})),p=(0,i.ZP)("div")((e=>{let{theme:t}=e;return{margin:"5px"}}));class m extends s.Component{constructor(e){if(super(e),this.state={activeTool:void 0},this.props.model.observer.subscribe("abortInteraction",(()=>{this.setState({activeTool:void 0})})),this.props.model.wkt){this.props.model.vectorSource.clear();const e=new c.Z,t=this.props.model.formValues[this.props.field];if(t&&t.length>0){e.readFeatures(t).forEach((e=>{this.props.model.vectorSource.addFeature(e)}))}}}componentWillUnmount(){this.props.model.observer.unsubscribe("abortInteraction"),this.props.model.deactivateInteraction()}changeTool(e,t){const{model:r}=this.props;if(this.props.onChangeTool(),t&&this.state.activeTool===t.toLowerCase())return r.deactivateInteraction(),this.setState({activeTool:void 0});if(this.state.activeTool===e)return r.deactivateInteraction(),this.setState({activeTool:void 0});switch(r.deactivateInteraction(),e){case"add":r.activateInteraction("add",t);break;case"remove":r.activateInteraction("remove");break;case"modify":r.activateInteraction("modify");break;case"move":r.activateInteraction("move")}}onAddPointClicked(){this.setState({activeTool:"point"}),this.changeTool("add","Point")}onAddLineClicked(){this.setState({activeTool:"linestring"}),this.changeTool("add","LineString")}onAddPolygonClicked(){this.setState({activeTool:"polygon"}),this.changeTool("add","Polygon")}getStatusMessage(e){return e?e.ExceptionReport?(0,h.jsxs)(d.Z,{children:["Uppdateringen misslyckades:"," ",e.ExceptionReport.Exception.ExceptionText.toString()]}):e.TransactionResponse&&e.TransactionResponse.TransactionSummary?(0,h.jsxs)("div",{children:[(0,h.jsx)(d.Z,{children:"Uppdateringen lyckades."}),(0,h.jsxs)(d.Z,{children:["Antal skapade objekt:"," ",e.TransactionResponse.TransactionSummary.totalInserted.toString()]}),(0,h.jsxs)(d.Z,{children:["Antal borttagna objekt:"," ",e.TransactionResponse.TransactionSummary.totalDeleted.toString()]}),(0,h.jsxs)(d.Z,{children:["Antal uppdaterade objekt:"," ",e.TransactionResponse.TransactionSummary.totalUpdated.toString()]})]}):(0,h.jsx)(d.Z,{children:"Status f\xf6r uppdateringen kunde inte avl\xe4sas ur svaret fr\xe5n servern."}):(0,h.jsx)(d.Z,{children:"Uppdateringen lyckades men det uppt\xe4cktes inte n\xe5gra \xe4ndringar."})}onSaveClicked(){this.props.model.editSource&&this.props.model.save((e=>{this.props.model.filty=!1,this.props.model.refreshEditingLayer(),this.props.app.globalObserver.publish("core.alert",this.getStatusMessage(e))}))}onCancelClicked(){this.props.model.deactivate(),this.props.panel.setState({checked:!1,enabled:!1,selectedSource:!1}),this.setState({activeTool:void 0})}getSelectedStyle(e){var t={};return e===this.state.activeTool&&(t.backgroundColor="#ccc"),t}storeValues(){if(!this.props.model.wkt)return;const e=new c.Z;let t="";this.props.model.vectorSource.getFeatures().length>0&&(t=e.writeFeatures(this.props.model.vectorSource.getFeatures()));let r=Object.assign({},this.props.model.formValues);r[this.props.field]=t,this.props.model.formValues=r,this.props.model.vectorSource.clear()}render(){const e=this.props.serviceConfig;var t=!this.props.enabled,r=!1,s=!1,i=!1;return this.props.model.wkt?(r=-1!==this.props.geotype.indexOf("point"),s=-1!==this.props.geotype.indexOf("polygon"),i=-1!==this.props.geotype.indexOf("line")):e&&(r=e.editPoint,i=e.editLine,s=e.editPolygon),(0,h.jsx)("div",{children:(0,h.jsx)(p,{children:(0,h.jsxs)("div",{children:[(0,h.jsxs)(u,{variant:"contained",disabled:!1===t?!r:t,onClick:()=>{this.onAddPointClicked()},type:"button",title:"L\xe4gg till plats",style:this.getSelectedStyle("point"),children:["Plats",(0,h.jsx)(a.Z,{sx:{marginLeft:1}})]}),(0,h.jsxs)(u,{variant:"contained",disabled:!1===t?!i:t,onClick:()=>{this.onAddLineClicked()},type:"button",title:"L\xe4gg till str\xe4cka",style:this.getSelectedStyle("linestring"),children:["Str\xe4cka",(0,h.jsx)(l.Z,{sx:{marginLeft:1}})]}),(0,h.jsxs)(u,{variant:"contained",disabled:!1===t?!s:t,onClick:()=>{this.onAddPolygonClicked()},type:"button",title:"L\xe4gg till omr\xe5de",style:this.getSelectedStyle("polygon"),children:["Omr\xe5de",(0,h.jsx)(o.Z,{sx:{marginLeft:1}})]})]})})})}}t.default=m}}]);
//# sourceMappingURL=4567.6f45344c.chunk.js.map