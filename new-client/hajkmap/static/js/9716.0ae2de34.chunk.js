"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[9716],{99716:(t,e,i)=>{i.r(e);var o=i(73803),s=i(62652),a=i(29409),n=i(9501),r=i(5426),c=i(29868),h=i(75004),g=i(35201),l=i(64665),u=i(5400),d=i(66233),p=i(90927);e.default=class{constructor(t){this.handleGeolocationChange=t=>{this.localObserver.publish("geolocationChange",{accuracy:t.target.getAccuracy(),altitude:t.target.getAltitude(),altitudeAccuracy:t.target.getAltitudeAccuracy(),heading:t.target.getHeading(),speed:t.target.getSpeed()})},this.handleGeolocationError=t=>{this.localObserver.publish("locationStatus","error"),this.localObserver.publish("geolocationError",t)},this.handleGeolocationChangeAccuracy=t=>{this.accuracyFeature.setGeometry(t.target.getAccuracyGeometry())},this.handleGeolocationChangePosition=t=>{const e=t.target.getPosition();if(this.positionFeature.setGeometry(e?new a.Z(e):null),this.localObserver.publish("locationStatus","on"),this.zoomToLocation){const t=this.map.getView().getMaxZoom(),i=this.map.getView().getMinZoom(),o=Math.ceil(.5*(t-i));this.map.getView().animate({duration:2500,center:e,zoom:o}),this.zoomToLocation=!1}},this.toggleTracking=t=>{this.localObserver.publish("locationStatus",t?"loading":"off"),this.geolocation.setTracking(t),!1===t?(this.layer.getSource().clear(),this.zoomToLocation=!0):(this.layer.getSource().addFeature(this.accuracyFeature),this.layer.getSource().addFeature(this.positionFeature),setInterval((()=>{this.flash(this.positionFeature)}),3e3))},this.flash=t=>{const e=3e3,i=Date.now(),o=t.getGeometry().clone(),s=this.layer.on("postrender",(t=>{const a=t.frameState.time-i;if(a>=e)return void(0,g.B)(s);const n=(0,h.getVectorContext)(t),r=a/e,p=25*(0,c.Vv)(r)+5,y=(0,c.Vv)(1-r),m=new l.ZP({image:new u.Z({radius:p,stroke:new d.Z({color:"rgba(255, 0, 0, "+y+")",width:.25+y})})});n.setStyle(m),n.drawGeometry(o),this.map.render()}))},this.map=t.map,this.localObserver=t.localObserver,this.zoomToLocation=!0,this.source=new r.Z({wrapX:!1}),this.layer=new n.Z({source:this.source,layerType:"system",zIndex:5e3,name:"pluginLocation",caption:"Location layer"}),this.map.addLayer(this.layer),this.accuracyFeature=new s.Z,this.positionFeature=new s.Z,this.positionFeature.setStyle(new l.ZP({image:new u.Z({radius:6,fill:new p.Z({color:"#3399CC"}),stroke:new d.Z({color:"#fff",width:2})})})),this.geolocation=new o.Z({trackingOptions:{enableHighAccuracy:!0},projection:this.map.getView().getProjection()}),this.geolocation.on("change",this.handleGeolocationChange),this.geolocation.on("error",this.handleGeolocationError),this.geolocation.on("change:accuracyGeometry",this.handleGeolocationChangeAccuracy),this.geolocation.on("change:position",this.handleGeolocationChangePosition)}enable(){this.toggleTracking(!0)}disable(){this.toggleTracking(!1)}}},73803:(t,e,i)=>{var o=i(25326),s=i(45957),a=i(56957),n=i(42708),r=i(22357);const c="accuracy",h="accuracyGeometry",g="altitude",l="altitudeAccuracy",u="heading",d="position",p="projection",y="speed",m="tracking",w="trackingOptions",k="error";class _ extends o.ZP{constructor(t){super(k),this.code=t.code,this.message=t.message}}class v extends s.Z{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.position_=null,this.transform_=n.gD,this.watchId_=void 0,this.addChangeListener(p,this.handleProjectionChanged_),this.addChangeListener(m,this.handleTrackingChanged_),void 0!==t.projection&&this.setProjection(t.projection),void 0!==t.trackingOptions&&this.setTrackingOptions(t.trackingOptions),this.setTracking(void 0!==t.tracking&&t.tracking)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const t=this.getProjection();t&&(this.transform_=(0,n.WO)((0,n.U2)("EPSG:4326"),t),this.position_&&this.set(d,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const t=this.getTracking();t&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):t||void 0===this.watchId_||(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(t){const e=t.coords;this.set(c,e.accuracy),this.set(g,null===e.altitude?void 0:e.altitude),this.set(l,null===e.altitudeAccuracy?void 0:e.altitudeAccuracy),this.set(u,null===e.heading?void 0:(0,r.Yr)(e.heading)),this.position_?(this.position_[0]=e.longitude,this.position_[1]=e.latitude):this.position_=[e.longitude,e.latitude];const i=this.transform_(this.position_);this.set(d,i.slice()),this.set(y,null===e.speed?void 0:e.speed);const o=(0,a.iu)(this.position_,e.accuracy);o.applyTransform(this.transform_),this.set(h,o),this.changed()}positionError_(t){this.dispatchEvent(new _(t))}getAccuracy(){return this.get(c)}getAccuracyGeometry(){return this.get(h)||null}getAltitude(){return this.get(g)}getAltitudeAccuracy(){return this.get(l)}getHeading(){return this.get(u)}getPosition(){return this.get(d)}getProjection(){return this.get(p)}getSpeed(){return this.get(y)}getTracking(){return this.get(m)}getTrackingOptions(){return this.get(w)}setProjection(t){this.set(p,(0,n.U2)(t))}setTracking(t){this.set(m,t)}setTrackingOptions(t){this.set(w,t)}}e.Z=v}}]);
//# sourceMappingURL=9716.0ae2de34.chunk.js.map