"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[8954],{28954:(e,t,r)=>{r.r(t);var i=r(66274),o=r(99359),s=r(9501),l=r(5426),a=r(43572),n=r(88490),h=r(56957),u=r(64802),c=r(90927),Z=r(64665),d=r(5400),p=r(66233),f=r(69236),y=(0,o.Z)("map"),b=(0,o.Z)("layerName"),g=(0,o.Z)("drawModel"),v=(0,o.Z)("observer"),w=(0,o.Z)("kmlSource"),m=(0,o.Z)("kmlLayer"),F=(0,o.Z)("parser"),P=(0,o.Z)("currentExtent"),E=(0,o.Z)("handleInitiationParametersMissing"),S=(0,o.Z)("initiateKmlLayer"),O=(0,o.Z)("addMapDropListeners"),j=(0,o.Z)("preventDefaultDropBehavior"),T=(0,o.Z)("handleDrop"),L=(0,o.Z)("importDroppedKml"),C=(0,o.Z)("vectorLayerExists"),x=(0,o.Z)("getAllMapLayers"),k=(0,o.Z)("layerHasCorrectNameAndType"),D=(0,o.Z)("isVectorLayer"),I=(0,o.Z)("connectExistingVectorLayer"),M=(0,o.Z)("createNewKmlLayer"),N=(0,o.Z)("getNewVectorSource"),R=(0,o.Z)("getNewVectorLayer"),_=(0,o.Z)("translateFeatureToViewSrs"),A=(0,o.Z)("setFeatureStyle"),K=(0,o.Z)("setFeatureStyleFromProps"),G=(0,o.Z)("setStyleFromStyleFunction"),X=(0,o.Z)("styleFillIsNullish"),z=(0,o.Z)("setFeatureTextProperties"),V=(0,o.Z)("createFeatureStyle"),H=(0,o.Z)("getFillStyle"),U=(0,o.Z)("getImageStyle"),W=(0,o.Z)("getStrokeStyle"),B=(0,o.Z)("getTextStyle"),J=(0,o.Z)("getFeaturePointPosition"),Y=(0,o.Z)("prepareForMapInjection"),q=(0,o.Z)("tagFeaturesAsImported"),Q=(0,o.Z)("getAllImportedFeatures"),$=(0,o.Z)("kmlSourceHasFeatures"),ee=(0,o.Z)("fitMapToExtent"),te=(0,o.Z)("setFeatureProperties"),re=(0,o.Z)("getKmlCompatibleFeatures");t.default=class{constructor(e){var t=this;if(Object.defineProperty(this,y,{writable:!0,value:void 0}),Object.defineProperty(this,b,{writable:!0,value:void 0}),Object.defineProperty(this,g,{writable:!0,value:void 0}),Object.defineProperty(this,v,{writable:!0,value:void 0}),Object.defineProperty(this,w,{writable:!0,value:void 0}),Object.defineProperty(this,m,{writable:!0,value:void 0}),Object.defineProperty(this,F,{writable:!0,value:void 0}),Object.defineProperty(this,P,{writable:!0,value:void 0}),Object.defineProperty(this,E,{writable:!0,value:()=>{throw new Error("Failed to initiate KML-model, - required parameters missing. \n Required parameters: map, layerName")}}),Object.defineProperty(this,S,{writable:!0,value:()=>(0,i.Z)(this,C)[C]()?(0,i.Z)(this,I)[I]():(0,i.Z)(this,M)[M]()}),Object.defineProperty(this,O,{writable:!0,value:()=>{const e=document.getElementById("map");["drop","dragover","dragend","dragleave","dragenter"].forEach((t=>{e.addEventListener(t,(0,i.Z)(this,j)[j],!1)})),e.addEventListener("drop",(0,i.Z)(this,T)[T],!1)}}),Object.defineProperty(this,j,{writable:!0,value:e=>{e.stopPropagation(),e.preventDefault()}}),Object.defineProperty(this,T,{writable:!0,value:async e=>{try{for await(const t of e.dataTransfer.files){const e=t.type?t.type:t.name.split(".").pop();"kml"!==e&&"application/vnd.google-earth.kml+xml"!==e||(0,i.Z)(this,L)[L](t)}}catch(t){console.error("Error importing KML-file... ".concat(t))}}}),Object.defineProperty(this,L,{writable:!0,value:e=>{const t=new FileReader,r=Math.random().toString(36).slice(2,9);t.onload=()=>{this.import(t.result,{zoomToExtent:!0,setProperties:{KML_ID:r}}),(0,i.Z)(this,v)[v]&&(0,i.Z)(this,v)[v].publish("kmlModel.fileImported",{id:r})},t.readAsText(e)}}),Object.defineProperty(this,C,{writable:!0,value:()=>(0,i.Z)(this,x)[x]().some((e=>(0,i.Z)(this,k)[k](e)))}),Object.defineProperty(this,x,{writable:!0,value:()=>(0,i.Z)(this,y)[y].getLayers().getArray()}),Object.defineProperty(this,k,{writable:!0,value:e=>e.get("name")===(0,i.Z)(this,b)[b]&&(0,i.Z)(this,D)[D](e)}),Object.defineProperty(this,D,{writable:!0,value:e=>e instanceof s.Z}),Object.defineProperty(this,I,{writable:!0,value:()=>{const e=(0,i.Z)(this,x)[x]().find((e=>(0,i.Z)(this,k)[k](e)));(0,i.Z)(this,m)[m]=e,(0,i.Z)(this,w)[w]=e.getSource()}}),Object.defineProperty(this,M,{writable:!0,value:()=>{(0,i.Z)(this,w)[w]=(0,i.Z)(this,N)[N](),(0,i.Z)(this,m)[m]=(0,i.Z)(this,R)[R]((0,i.Z)(this,w)[w]),(0,i.Z)(this,m)[m].set("name",(0,i.Z)(this,b)[b]),(0,i.Z)(this,y)[y].addLayer((0,i.Z)(this,m)[m])}}),Object.defineProperty(this,N,{writable:!0,value:()=>new l.Z({wrapX:!1})}),Object.defineProperty(this,R,{writable:!0,value:e=>new s.Z({source:e,layerType:"system",zIndex:5e3,caption:"KML model"})}),Object.defineProperty(this,_,{writable:!0,value:e=>{var t,r,o,s;if(null===(null!==(t=null===e||void 0===e||null===(r=e.getGeometry)||void 0===r||null===(o=(s=r.call(e)).getType)||void 0===o?void 0:o.call(s))&&void 0!==t?t:null))return null;const l=(0,i.Z)(this,y)[y].getView().getProjection();e.getGeometry().transform("EPSG:4326",l)}}),Object.defineProperty(this,A,{writable:!0,value:e=>{var t;e||console.warn("Cannot apply a style on nothing. (Supplied feature is nullish).");const r=e.get("EXTRACTED_STYLE")||e.get("style")||null;if(null!==r)return(0,i.Z)(this,K)[K](e,r);const o=null!==(t=e.getStyleFunction())&&void 0!==t?t:null;return null!==o?(0,i.Z)(this,G)[G](e,o):void 0}}),Object.defineProperty(this,K,{writable:!0,value:(e,t)=>{try{const r=JSON.parse(t);"Text"===(e.get("DRAW_METHOD")||e.get("geometryType")||null)&&(0,i.Z)(this,z)[z](e,r.text),e.setStyle((0,i.Z)(this,V)[V](r))}catch(r){console.error("KML-model: Style attribute could not be parsed. Error: ".concat(r))}}}),Object.defineProperty(this,G,{writable:!0,value:(e,t)=>{const r=t(e,(0,i.Z)(this,y)[y].getView().getResolution());(0,i.Z)(this,X)[X](r)&&r[0].setFill(new c.Z({color:[0,0,0,0]})),e.setStyle(r)}}),Object.defineProperty(this,X,{writable:!0,value:e=>e[0]&&e[0].getFill&&null===e[0].getFill()}),Object.defineProperty(this,z,{writable:!0,value:(e,t)=>{e.get("USER_TEXT")||(e.set("USER_TEXT",t),e.set("TEXT_SETTINGS",{backgroundColor:"#000000",foregroundColor:"#FFFFFF",size:14}))}}),Object.defineProperty(this,V,{writable:!0,value:e=>new Z.ZP({fill:(0,i.Z)(this,H)[H](e),image:(0,i.Z)(this,U)[U](e),stroke:(0,i.Z)(this,W)[W](e),text:(0,i.Z)(this,B)[B](e)})}),Object.defineProperty(this,H,{writable:!0,value:e=>{const{fillStyle:t,fillColor:r}=e;return t?new c.Z({color:t.color}):new c.Z({color:r})}}),Object.defineProperty(this,U,{writable:!0,value:e=>{const{imageStyle:t,pointColor:r}=e;return t?new d.Z({radius:6,stroke:new p.Z({color:t.strokeColor,width:t.strokeWidth,lineDash:t.dash}),fill:new c.Z({color:t.fillColor})}):new d.Z({radius:6,stroke:new p.Z({color:"#FFFFFF",width:2,lineDash:null}),fill:new c.Z({color:r})})}}),Object.defineProperty(this,W,{writable:!0,value:e=>{const{strokeStyle:t}=e;if(t)return new p.Z({lineDash:t.dash,color:t.color,width:t.width});const{strokeDash:r,strokeWidth:i,strokeColor:o}=e;return new p.Z({lineDash:r,color:o,width:i})}}),Object.defineProperty(this,B,{writable:!0,value:e=>{const{text:t}=e;return new f.Z({font:"12pt sans-serif",fill:new c.Z({color:"#FFFFF"}),text:t,overflow:!0,stroke:new p.Z({color:"rgba(0, 0, 0, 0.5)",width:3}),offsetX:0,offsetY:-15})}}),Object.defineProperty(this,J,{writable:!0,value:e=>{if("Point"!==e.getType())return null;const t=e.getCoordinates();return{n:t[1],e:t[0]}}}),Object.defineProperty(this,Y,{writable:!0,value:e=>{if(!e||0===(null===e||void 0===e?void 0:e.length))return null;e.forEach((e=>{(0,i.Z)(this,_)[_](e),(0,i.Z)(this,A)[A](e),(0,i.Z)(this,g)[g]&&e.set("USER_DRAWN",!0)}))}}),Object.defineProperty(this,q,{writable:!0,value:e=>{if(!e||0===(null===e||void 0===e?void 0:e.length))return null;e.forEach((e=>{e.set("KML_IMPORT",!0),e.set("SHOW_TEXT",!0)}))}}),Object.defineProperty(this,Q,{writable:!0,value:()=>(0,i.Z)(this,w)[w].getFeatures().filter((e=>!0===e.get("KML_IMPORT")))}),Object.defineProperty(this,$,{writable:!0,value:()=>(0,i.Z)(this,w)[w].getFeatures().length>0}),Object.defineProperty(this,ee,{writable:!0,value:()=>{(0,i.Z)(this,y)[y].getView().fit((0,i.Z)(this,P)[P],{size:(0,i.Z)(this,y)[y].getSize(),padding:[20,20,20,20],maxZoom:7})}}),Object.defineProperty(this,te,{writable:!0,value:(e,t)=>{for(const r of e)r.setProperties(t)}}),this.importedKmlStillHasFeatures=e=>(0,i.Z)(this,w)[w].getFeatures().filter((t=>t.get("KML_ID")===e)).length>0,this.parseFeatures=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{prepareForMapInjection:!0};const o=r.prepareForMapInjection;try{var s;const r=null!==(s=(0,i.Z)(t,F)[F].readFeatures(e))&&void 0!==s?s:[];return(0,i.Z)(t,q)[q](r),o&&(0,i.Z)(t,Y)[Y](r),{features:r,error:null}}catch(l){return{features:[],error:l}}},this.import=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{zoomToExtent:!0};const{features:o,error:s}=t.parseFeatures(e);return null!==s?{status:"FAILED",error:s}:(r.setProperties&&(0,i.Z)(t,te)[te](o,r.setProperties),(0,i.Z)(t,g)[g]?(0,i.Z)(t,g)[g].addKmlFeatures(o):(0,i.Z)(t,w)[w].addFeatures(o),(0,i.Z)(t,P)[P]=(0,i.Z)(t,w)[w].getExtent(),r.zoomToExtent&&t.zoomToCurrentExtent(),{status:"SUCCESS",error:null})},this.export=()=>{const e=(0,i.Z)(this,w)[w].getFeatures().filter((e=>!0!==e.get("HIDDEN")));if(!e||0===(null===e||void 0===e?void 0:e.length))return{status:"FAILED",error:"No features exist in the current kml-layer."};const t=(0,i.Z)(this,re)[re](e);if(0===t.length)return{status:"FAILED",error:"Could not transform any features to the .kml standard."};const r=(0,i.Z)(this,F)[F].writeFeatures(t,"".concat((0,i.Z)(this,b)[b],"-kml-export"));try{return(0,u.saveAs)(new Blob([r],{type:"application/vnd.google-earth.kml+xml;charset=utf-8"}),"Ritexport - ".concat((new Date).toLocaleString(),".kml")),{status:"SUCCESS",error:null}}catch(o){return{status:"FAILED",error:"Could not save the KML-file. File-saver Error."}}},Object.defineProperty(this,re,{writable:!0,value:e=>{const t=[];return e.forEach((e=>{const r=e.clone(),o=r.getGeometry()instanceof n.Z;if((0,i.Z)(this,g)[g]&&(r.set("EXTRACTED_STYLE",JSON.stringify((0,i.Z)(this,g)[g].extractFeatureStyleInfo(e))),r.set("TEXT_SETTINGS",JSON.stringify(e.get("TEXT_SETTINGS")))),o){const e=r.getGeometry();r.set("CIRCLE_RADIUS",e.getRadius()),r.set("CIRCLE_CENTER",JSON.stringify(e.getCenter()));const t=(0,h.Bb)(e,96);r.setGeometry(t)}r.getGeometry().transform((0,i.Z)(this,y)[y].getView().getProjection(),"EPSG:4326"),t.push(r)})),t}}),this.zoomToCurrentExtent=()=>{(0,i.Z)(this,$)[$]()&&null!==(0,i.Z)(this,P)[P]&&!1===(0,i.Z)(this,P)[P].map(Number.isFinite).includes(!1)&&(0,i.Z)(this,ee)[ee]((0,i.Z)(this,P)[P])},this.removeImportedFeatures=()=>{(0,i.Z)(this,Q)[Q]().forEach((e=>{(0,i.Z)(this,w)[w].removeFeature(e)})),(0,i.Z)(this,P)[P]=(0,i.Z)(this,w)[w].getExtent()},this.setLayer=e=>{(0,i.Z)(this,b)[b]=e,(0,i.Z)(this,S)[S](),(0,i.Z)(this,P)[P]=(0,i.Z)(this,w)[w].getExtent()},this.getCurrentLayerName=()=>(0,i.Z)(this,b)[b],this.getCurrentExtent=()=>(0,i.Z)(this,P)[P],!e.map||!e.layerName)return(0,i.Z)(this,E)[E]();(0,i.Z)(this,y)[y]=e.map,(0,i.Z)(this,b)[b]=e.layerName,(0,i.Z)(this,g)[g]=e.drawModel||null,(0,i.Z)(this,v)[v]=e.observer||null,e.enableDragAndDrop&&(0,i.Z)(this,O)[O](),(0,i.Z)(this,F)[F]=new a.ZP,(0,i.Z)(this,P)[P]=null,(0,i.Z)(this,S)[S]()}}}}]);
//# sourceMappingURL=8954.58242c66.chunk.js.map