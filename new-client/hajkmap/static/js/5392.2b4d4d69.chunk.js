"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[5392,1960,541,6542],{95392:(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});var a=r(30541),s=r(92810),i=r(21960),c=r(35077);class n{constructor(e){this.bindListenForSearchResultClick=()=>{this.app.globalObserver.subscribe("search.featureClicked.documentHandlerSearchResultClicked",(e=>{this.localObserver.publish("document-link-clicked",{documentName:e.properties.documentFileName,headerIdentifier:e.properties.headerIdentifier})}))},this.createDocumentCollectionsToSearch=e=>e.reduce(((e,t)=>[...e,{documentFileName:t.documentFileName,documentTitle:t.documentTitle,features:[...this.getFeatures(t.chapters,t),this.getSpecialTitleFeature(t)]}]),[]),this.getFeatures=(e,t)=>e.reduce(((e,r)=>(r.chapters&&(e=[...e,...this.getFeatures(r.chapters,t)]),e=[...e,this.createFeatureFromChapter(r,t)])),[]),this.getSpecialTitleFeature=e=>{let t={header:e.documentTitle,geoids:[],headerIdentifier:e.documentTitle,documentTitle:e.documentTitle,documentFileName:e.documentFileName};const r="".concat(e.documentTitle).concat(Math.floor(1e3*Math.random()));return{type:"Feature",isTitleFeature:!0,geometry:null,searchValues:[e.title],id:r,onClickName:"documentHandlerSearchResultClicked",properties:t,get:e=>t[e],getGeometry:()=>null,getId:()=>r,setStyle:()=>null}},this.createFeatureFromChapter=(e,t)=>{let r=[];e.header&&r.push(e.header),e.keywords&&e.keywords.length>0&&(r=[...r,...e.keywords]);const a={header:e.header,geoids:e.geoids,headerIdentifier:e.headerIdentifier,documentTitle:t.documentTitle,documentFileName:t.documentFileName},s="".concat(e.headerIdentifier).concat(Math.floor(1e3*Math.random()));return{type:"Feature",geometry:null,isTitleFeature:!1,searchValues:r,id:s,onClickName:"documentHandlerSearchResultClicked",properties:a,get:e=>a[e],getGeometry:()=>null,getId:()=>s,setStyle:()=>null}},this.implementSearchInterface=()=>({getResults:this.getResults,getFunctionality:this.getFunctionality}),this.getFunctionality=()=>null,this.getResults=(e,t)=>(this.matchSearch=new a.default(t),this.searchOptions=t,this.getDocumentHandlerResults(e)),this.getDocumentHandlerResults=e=>new Promise(((t,r)=>{""===e&&t({featureCollections:[],errors:[]});let a=this.searchOptions.getPossibleCombinations?this.globalSearchModel.getPossibleSearchCombinations(e):[(0,i.splitAndTrimOnCommas)(e)];a=this.decodePotentialSpecialCharsFromFeatureProps(a),t({featureCollections:this.getFeatureCollectionsForMatchingDocuments(a),errors:[]})})),this.decodePotentialSpecialCharsFromFeatureProps=e=>e.map((e=>e.map((e=>(0,c.decodeCommas)(e))))),this.getSearchFields=e=>e.reduce(((e,t)=>(t.matchedSearchValues.length>0&&(e=[...e,...this.getMockedSearchFieldForChapter(t)]),e)),[]),this.getMatchedFeatures=(e,t)=>{const{initiator:r}=this.searchOptions;return e.features.reduce(((a,s)=>{if("search"===r){if(s.isTitleFeature)return a;s.searchValues.push(e.documentTitle)}return"autocomplete"!==r||s.isTitleFeature||(s.searchValues=s.searchValues.filter((t=>t!==e.documentTitle))),s.matchedSearchValues=this.getMatchedSearchValues(t,s.searchValues),s.matchedSearchValues.length>0?[...a,s]:a}),[])},this.createFeatureCollection=(e,t,r)=>({value:{status:"fulfilled",type:"FeatureCollection",crs:{type:null,properties:{name:null}},features:e,numberMatched:e.length,numberReturned:e.length,timeStamp:(new Date).toISOString(),totalFeatures:e.length},source:{id:r.documentTitle||r.documentFileName,caption:r.documentTitle||r.documentFileName,displayFields:["header"],searchFields:[...t]},origin:"DOCUMENT"}),this.getFeatureCollectionsForMatchingDocuments=e=>this.documentCollections.reduce(((t,r)=>{const a=this.getMatchedFeatures(r,e),s=this.getSearchFields(a),i=this.createFeatureCollection(a,s,r);return i?[...t,i]:t}),[]),this.getMockedSearchFieldForChapter=e=>e.matchedSearchValues.reduce(((t,r)=>{const a=(0,s.Z)();return e.properties[a]=r,[...t,a]}),[]),this.getAllMatchedSearchValues=(e,t)=>{const r=new Set;return this.getMatched(e,t).forEach((e=>{r.add(e)})),r},this.getMatchedSearchValues=(e,t)=>{let r=new Set;return e.some((e=>e.every((e=>{let a=this.getAllMatchedSearchValues(e,t);return r=new Set([...r,...a]),a.size>0}))))?Array.from(r):[]},this.getMatched=(e,t)=>t.reduce(((t,r)=>this.matchSearch.compare(e,r)?[...t,r]:t),[]),this.globalSearchModel=e.globalSearchModel,this.documentCollections=this.createDocumentCollectionsToSearch(e.allDocuments),this.localObserver=e.localObserver,this.app=e.app,this.bindListenForSearchResultClick()}}},30541:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});class a{constructor(e){this.getMatchRegexp=e=>{const{wildcardAtEnd:t,wildcardAtStart:r,matchCase:a}=this.searchOptions;let s=a?"g":"gi";return r&&!t?new RegExp(".*".concat(e,"$"),s):!r&&t?new RegExp("^".concat(e,".*"),s):r&&t?new RegExp("".concat(e),s):new RegExp("^".concat(e,"$"),s)},this.escapeSpecialChars=e=>e.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),this.compare=(e,t)=>{const r=this.escapeSpecialChars(e);return this.getMatchRegexp(r).test(t)},this.searchOptions=e}}},21960:(e,t,r)=>{r.r(t),r.d(t,{flattenChaptersTree:()=>c,getStringArray:()=>s,hasSubMenu:()=>i,splitAndTrimOnCommas:()=>a});const a=e=>e.split(",").map((e=>e.trim())),s=e=>a(e).join(" ").split(" "),i=e=>e.menu&&e.menu.length>0,c=e=>e.reduce(((e,t)=>{if(t.header){let r={...t};r.chapters=[],e=[...e,r]}return t.chapters&&t.chapters.length>0?[...e,...c(t.chapters)]:e}),[])},92810:(e,t,r)=>{var a;r.d(t,{Z:()=>h});var s=new Uint8Array(16);function i(){if(!a&&!(a="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(s)}var c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var n=function(e){return"string"===typeof e&&c.test(e)},o=[],l=0;l<256;++l)o.push((l+256).toString(16).substr(1));var u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]).toLowerCase();if(!n(r))throw TypeError("Stringified UUID is invalid");return r};var h=function(e,t,r){var a=(e=e||{}).random||(e.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(var s=0;s<16;++s)t[r+s]=a[s];return t}return u(a)}}}]);
//# sourceMappingURL=5392.2b4d4d69.chunk.js.map