"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[7816],{57816:(e,t,s)=>{s.r(t);var i=s(72791),r=s(74390),n=s(66934),o=s(89673),a=s(55818),l=s(3721),h=s(20890),p=s(68870),d=s(77907),g=s(98937),u=s(5397),c=s(85172),m=s(80184);const y=(0,n.ZP)(o.Z)((()=>({borderRadius:0,boxShadow:"none",backgroundImage:"none"}))),x=(0,n.ZP)(a.Z)((()=>({minHeight:35,padding:"0px",overflow:"hidden","&.MuiAccordionSummary-root.Mui-expanded":{minHeight:35},"& .MuiAccordionSummary-content":{transition:"inherit",marginTop:0,marginBottom:0,"&.Mui-expanded":{marginTop:0,marginBottom:0}}}))),b=(0,n.ZP)(l.Z)((()=>({width:"100%",display:"block",padding:"0"}))),f=(0,n.ZP)("div")((e=>{let{theme:t}=e;return{display:"flex",flexBasis:"100%",borderBottom:"".concat(t.spacing(.2)," solid ").concat(t.palette.divider)}})),v=(0,n.ZP)(h.Z)((e=>{let{theme:t}=e;return{fontSize:t.typography.pxToRem(15),flexBasis:"100%"}})),j=(0,n.ZP)("div")((()=>({float:"left"}))),Z={cursor:"pointer",float:"left",marginRight:"5px",padding:"0"};class S extends i.PureComponent{constructor(e){super(e),this.state={expanded:!1,groups:[],layers:[],name:"",parent:"-1",toggled:!1,chapters:[]},this.layerVisibilityChanged=e=>{this.forceUpdate()},this.getAllLayersInGroupAndSubGroups=e=>e.reduce(((e,t)=>(this.hasSubGroups(t)&&(e=[...e,...this.getAllLayersInGroupAndSubGroups(t.groups)]),[...e,...t.layers])),[]),this.getAllMapLayersReferencedByGroup=()=>{const{app:e,group:t}=this.props,s=this.getAllLayersInGroupAndSubGroups([t]);return e.getMap().getLayers().getArray().filter((e=>s.find((t=>t.id===e.get("name")))))},this.bindVisibleChangeForLayersInGroup=()=>{this.getAllMapLayersReferencedByGroup().forEach((e=>{e.on("change:visible",this.layerVisibilityChanged)}))},this.unbindVisibleChangeForLayersInGroup=()=>{this.getAllMapLayersReferencedByGroup().forEach((e=>{e.un("change:visible",this.layerVisibilityChanged)}))},this.handleChange=e=>(t,s)=>{this.setState({expanded:!!s&&e})},this.toggleExpanded=()=>{this.setState({expanded:!this.state.expanded})},this.layerInMap=e=>{let t=this.props.app.getMap().getLayers().getArray().find((t=>t.get("name")===e.id));return!(!t||!t.getVisible())},this.areSubGroupsAndLayersSemiToggled=e=>{let t=!1;return this.hasLayers(e)&&(t=e.layers.some((e=>this.layerInMap(e)))),this.hasSubGroups(e)&&!t&&(t=e.groups.some((e=>this.areSubGroupsAndLayersSemiToggled(e)))),t},this.areAllGroupsAndSubGroupsToggled=e=>{let t=!0,s=!0;return this.hasSubGroups(e)&&(t=e.groups.every((e=>this.areAllGroupsAndSubGroupsToggled(e)))),this.hasLayers(e)&&(s=e.layers.every((e=>this.layerInMap(e)))),t&&s},this.hasLayers=e=>e.layers&&e.layers.length>0,this.hasSubGroups=e=>e.groups&&e.groups.length>0,this.getCheckbox=()=>this.isToggled()?(0,m.jsx)(d.Z,{sx:Z}):this.isSemiToggled()?(0,m.jsx)(d.Z,{sx:{...Z,color:"gray"}}):(0,m.jsx)(g.Z,{sx:Z}),this.model=this.props.model,this.bindVisibleChangeForLayersInGroup()}componentDidMount(){this.setState({...this.props.group})}componentWillUnmount(){this.unbindVisibleChangeForLayersInGroup()}renderLayerGroups(){let{expanded:e}=this.state;return 1===this.state.groups.length&&this.state.groups[0].expanded&&(e=this.state.groups[0].id),this.state.groups.map(((t,s)=>(0,m.jsx)(S,{expanded:e===t.id,group:t,model:this.props.model,handleChange:this.handleChange,app:this.props.app,child:!0,chapters:this.props.chapters,options:this.props.options},s)))}isToggled(){const{group:e}=this.props;return this.areAllGroupsAndSubGroupsToggled(e)}isSemiToggled(){const{group:e}=this.props;return this.areSubGroupsAndLayersSemiToggled(e)}toggleGroups(e,t){Array.isArray(t)&&t.forEach((t=>{t.groups.length&&t.groups.forEach((t=>{this.toggleGroups(e,t)})),this.toggleLayers(e,t.layers)})),"object"===typeof t&&null!==t&&t.hasOwnProperty("groups")&&this.toggleGroups(e,t.groups),"object"===typeof t&&null!==t&&t.hasOwnProperty("layers")&&this.toggleLayers(e,t.layers)}toggleLayers(e,t){this.props.app.getMap().getAllLayers().filter((e=>t.some((t=>t.id===e.get("name"))))).forEach((t=>{"group"===t.get("layerType")&&(!0===e?this.model.observer.publish("showLayer",t):this.model.observer.publish("hideLayer",t)),t.setVisible(e)}))}renderToggleAll(){return this.props.group.toggled?(0,m.jsxs)(f,{onClick:e=>{e.preventDefault(),e.stopPropagation(),this.isToggled()?(this.toggleGroups(!1,this.props.group.groups),this.toggleLayers(!1,this.props.group.layers)):(this.toggleGroups(!0,this.props.group.groups),this.toggleLayers(!0,this.props.group.layers))},children:[(0,m.jsx)("div",{children:this.getCheckbox()}),(0,m.jsx)(v,{children:this.state.name})]}):(0,m.jsx)(f,{children:(0,m.jsx)(v,{children:this.state.name})})}render(){const{expanded:e}=this.state;return(0,m.jsx)(p.Z,{sx:{marginLeft:this.props.child?"21px":"0px"},children:(0,m.jsxs)(y,{expanded:this.state.expanded,TransitionProps:{timeout:0},onChange:()=>{this.setState({expanded:!this.state.expanded})},children:[(0,m.jsxs)(x,{children:[(0,m.jsx)(j,{children:e?(0,m.jsx)(c.Z,{onClick:()=>this.toggleExpanded()}):(0,m.jsx)(u.Z,{onClick:()=>this.toggleExpanded()})}),this.renderToggleAll()]}),(0,m.jsx)(b,{children:(0,m.jsxs)("div",{children:[this.state.layers.map(((e,t)=>{const s=this.model.layerMap[e.id];return s?(0,m.jsx)(r.default,{layer:s,model:this.props.model,options:this.props.options,chapters:this.props.chapters,app:this.props.app,onOpenChapter:e=>{this.props.app.windows.find((e=>"informative"===e.type)).props.custom.open(e)}},s.get("name")):null})),this.renderLayerGroups()]})})]})})}}S.defaultProps={child:!1,expanded:!1},t.default=S},74390:(e,t,s)=>{s.r(t);var i=s(66274),r=s(99359),n=s(72791),o=s(98246),a=s(66934),l=s(20890),h=s(20068),p=s(24518),d=s(61889),g=s(91964),u=s(42618),c=s(25878),m=s(19924),y=s(77907),x=s(32791),b=s(16378),f=s(98937),v=s(2094),j=s(29823),Z=s(16788),S=s(43214),L=s(61611),k=s(4976),C=s(80184);const T=(0,a.ZP)("div")((e=>{let{theme:t}=e;return{paddingLeft:"0",borderBottom:"".concat(t.spacing(.2)," solid ").concat(t.palette.divider)}})),w=(0,a.ZP)("div")((e=>{let{theme:t}=e;return{display:"flex",justifyContent:"space-between",marginTop:"0"}})),I=(0,a.ZP)("div")((()=>({display:"flex",alignItems:"center",cursor:"pointer",float:"left",marginRight:"5px"}))),M=(0,a.ZP)("div")((e=>{let{theme:t}=e;return{margin:"10px 45px"}})),A=(0,a.ZP)(l.Z)((e=>{let{theme:t}=e;return{cursor:"pointer",fontSize:t.typography.pxToRem(15)}})),G=(0,a.ZP)("img")((e=>{let{theme:t}=e;return{width:t.typography.pxToRem(18),height:t.typography.pxToRem(18),marginRight:"5px"}})),V=(0,a.ZP)("div")((()=>({display:"flex",alignItems:"center"}))),O=(0,a.ZP)("div")((()=>({display:"flex",alignItems:"center",width:35,height:35,cursor:"pointer"}))),P=(0,a.ZP)("ul")((()=>({padding:0,margin:0,listStyle:"none"})));var B=(0,r.Z)("showAttributeTable");class F extends n.PureComponent{constructor(e){super(e),this.zoomEndHandler=e=>{const t=this.props.model.olMap.getView().getZoom(),s=this.props.layer.getProperties(),i=t>s.minZoom&&t<=s.maxZoom;let r=!1;return!0===this.minMaxZoomAlertOnToggleOnly?this.state.visible||i||"click"!==(null===e||void 0===e?void 0:e.type)||(r=!0):i||!this.state.zoomVisible&&this.state.visible||(r=!0),!0===r&&this.showZoomSnack(),this.setState({zoomVisible:i}),i},this.toggleVisible=e=>{const t=this.props.layer;if(this.isBackgroundLayer){if(document.getElementById("map").style.backgroundColor="#FFF",t.isFakeMapLayer)if("-2"===this.name)document.getElementById("map").style.backgroundColor="#000";else document.getElementById("map").style.backgroundColor="#FFF";else t.setVisible(!0);this.setState({visible:!0}),t.localObserver.publish("backgroundLayerChanged",this.name)}else{const t=!this.state.visible;this.setState({visible:t}),this.props.layer.setVisible(t),this.triggerZoomCheck(e,t)}},this.renderInfoButton=()=>this.isInfoEmpty()?null:(0,C.jsx)(h.Z,{title:"Mer information om lagret",children:(0,C.jsx)(O,{children:this.state.infoVisible?(0,C.jsx)(m.Z,{onClick:this.toggleInfo}):(0,C.jsx)(c.Z,{onClick:this.toggleInfo,sx:{boxShadow:this.state.infoVisible?"rgb(204, 204, 204) 2px 3px 1px":"inherit",borderRadius:"100%"}})})}),this.renderMoreButton=()=>(0,C.jsx)(h.Z,{title:"Fler inst\xe4llningar",children:(0,C.jsx)(O,{children:this.state.toggleSettings?(0,C.jsx)(j.Z,{onClick:this.toggleSettings}):(0,C.jsx)(v.Z,{onClick:this.toggleSettings})})}),this.openInformative=e=>t=>{this.props.onOpenChapter(e)},this.toggleSettings=()=>{this.setState({toggleSettings:!this.state.toggleSettings})},this.toggleInfo=()=>{this.setState({infoVisible:!this.state.infoVisible})},this.getLayerToggler=()=>{const{visible:e}=this.state,t=e?this.isBackgroundLayer?(0,C.jsx)(x.Z,{}):(0,C.jsx)(y.Z,{sx:{fill:e=>!this.state.zoomVisible&&this.state.visible?e.palette.warning.dark:""}}):this.isBackgroundLayer?(0,C.jsx)(b.Z,{}):(0,C.jsx)(f.Z,{});return(0,C.jsx)(I,{children:t})},Object.defineProperty(this,B,{writable:!0,value:async()=>{try{const e=this.props.layer.getSource().get("url").replace("wms","wfs"),{LAYERS:t}=this.props.layer.getSource().getParams(),s=e.includes("?")?"&":"?",i="".concat(e).concat(s,"service=WFS&version=1.0.0&request=GetFeature&typeName=").concat(t,"&maxFeatures=5000&outputFormat=application%2Fjson"),r="".concat(e).concat(s,"service=WFS&version=1.0.0&request=DescribeFeatureType&typeName=").concat(t,"&outputFormat=application%2Fjson"),n=await fetch(i),o=await n.json(),a=await fetch(r),l=(await a.json()).featureTypes.find((e=>e.typeName===t)).properties.filter((e=>!e.type.toLowerCase().includes("gml"))).map((e=>({field:e.name,headerName:e.name,type:"int"===e.localType?"number":e.localType,flex:1}))),h=o.features.map(((e,t)=>({...e.properties,id:t})));this.props.app.globalObserver.publish("core.showAttributeTable",{title:"".concat(this.caption," (").concat(t,")"),content:{columns:l,rows:h}})}catch(e){console.error(e),console.log(this),this.props.enqueueSnackbar('Serverfel: attributtabellen f\xf6r lagret "'.concat(this.caption,'" kunde inte visas'),{variant:"error"})}}});const{layer:t}=e,s=t.get("layerInfo");this.isBackgroundLayer="base"===s.layerType,this.caption=s.caption,this.name=t.get("name"),this.legend=s.legend,this.legendIcon=s.legendIcon,this.infoTitle=s.infoTitle,this.infoText=s.infoText,this.infoUrl=s.infoUrl,this.infoUrlText=s.infoUrlText,this.infoOwner=s.infoOwner,this.localObserver=t.localObserver,this.showAttributeTableButton=s.showAttributeTableButton||!1,this.usesMinMaxZoom=this.layerUsesMinMaxZoom(),this.minMaxZoomAlertOnToggleOnly=t.get("minMaxZoomAlertOnToggleOnly"),this.state={visible:t.get("visible"),status:"ok",zoomVisible:!0,open:!1,toggleSettings:!1,infoVisible:!1},this.isBackgroundLayer&&t.localObserver.subscribe("backgroundLayerChanged",(e=>{e!==this.name&&(t.isFakeMapLayer||t.setVisible(!1),this.setState({visible:!1}))}))}componentDidMount(){var e,t;null===(e=(t=this.props.layer).on)||void 0===e||e.call(t,"change:visible",(e=>{const t=!e.oldValue;this.setState({visible:t}),this.listenToZoomChange(t)})),this.state.visible&&this.triggerZoomCheck(null,this.state.visible),this.listenToZoomChange(this.state.visible),this.props.app.globalObserver.subscribe("layerswitcher.wmsLayerLoadStatus",(e=>{"loaderror"!==this.state.status&&this.name===e.id&&this.setState({status:e.status})}))}layerUsesMinMaxZoom(){var e,t;const s=this.props.layer.getProperties(),i=null!==(e=s.maxZoom)&&void 0!==e?e:0,r=null!==(t=s.minZoom)&&void 0!==t?t:0;return i>0&&i<1/0||r>0&&r<1/0}listenToZoomChange(e){if(!this.usesMinMaxZoom)return;const t="core.zoomEnd";e&&!this.zoomEndListener?this.zoomEndListener=this.props.app.globalObserver.subscribe(t,this.zoomEndHandler):this.zoomEndListener&&(this.props.app.globalObserver.unsubscribe(t,this.zoomEndListener),this.zoomEndListener=null)}showZoomSnack(){if(this.zoomWarningSnack)return;const e=this.props.layer.get("layerInfo"),t=e?e.layersInfo:void 0;t&&Object.keys(t).length>1||(this.zoomWarningSnack=this.props.enqueueSnackbar('Lagret "'.concat(this.caption,'"  \xe4r inte synligt vid aktuell zoomniv\xe5.'),{variant:"warning",preventDuplicate:!0,onClose:()=>{this.zoomWarningSnack=null}}))}triggerZoomCheck(e,t){if(this.usesMinMaxZoom&&(this.zoomEndHandler(e),!1===t)){if(!this.zoomWarningSnack)return;this.props.closeSnackbar(this.zoomWarningSnack),this.zoomWarningSnack=null}}renderStatusButton(){return"loaderror"===this.state.status&&(0,C.jsx)(h.Z,{disableInteractive:!0,title:"Lagret kunde inte laddas in. Kartservern svarar inte.",children:(0,C.jsx)(O,{children:(0,C.jsx)(g.Z,{})})})}renderLegendImage(){const e=this.legend&&this.legend[0]&&this.legend[0].url?this.legend[0].url:"";return e?(0,C.jsx)("img",{width:"30",alt:"legend",src:e}):null}isInfoEmpty(){let e=this.findChapters(this.name,this.props.chapters);return!(this.infoCaption||this.infoUrl||this.infoOwner||this.infoText||e.length>0)}findChapters(e,t){let s=[];return Array.isArray(t)&&(s=t.reduce(((t,s)=>(Array.isArray(s.layers)&&(s.layers.some((t=>t===e))&&(t=[...t,s]),s.chapters.length>0&&(t=[...t,...this.findChapters(e,s.chapters)])),t)),[])),s}renderChapterLinks(e){if(e&&e.length>0){let t=this.findChapters(this.name,e);return t.length>0?(0,C.jsxs)(M,{children:[(0,C.jsx)(l.Z,{children:"Inneh\xe5ll fr\xe5n denna kategori finns ben\xe4mnt i f\xf6ljande kapitel i \xf6versiktsplanen:"}),(0,C.jsx)(P,{children:t.map(((e,t)=>(0,C.jsx)("li",{children:(0,C.jsxs)(p.Z,{size:"small",onClick:this.openInformative(e),children:[e.header,(0,C.jsx)(u.Z,{sx:{marginLeft:1,fontSize:"16px"}})]})},t)))})]}):null}return null}toggle(){this.setState({open:!this.state.open})}renderInfo(){return this.infoText?(0,C.jsxs)(M,{children:[(0,C.jsx)(l.Z,{variant:"subtitle2",children:this.infoTitle}),(0,C.jsx)(l.Z,{variant:"body2",dangerouslySetInnerHTML:{__html:this.infoText}})]}):null}renderMetadataLink(){return this.infoUrl?(0,C.jsx)(M,{children:(0,C.jsx)("a",{href:this.infoUrl,target:"_blank",rel:"noopener noreferrer",children:this.infoUrlText||this.infoUrl})}):null}renderOwner(){return this.infoOwner?(0,C.jsx)(M,{children:(0,C.jsx)(l.Z,{variant:"body2",dangerouslySetInnerHTML:{__html:this.infoOwner}})}):null}renderDetails(){if(this.state.infoVisible)return(0,C.jsxs)("div",{children:[this.renderInfo(),this.renderMetadataLink(),this.renderOwner(),(0,C.jsx)("div",{children:this.renderChapterLinks(this.props.chapters||[])})]})}renderLegendIcon(){return(0,C.jsx)(G,{alt:"Teckenf\xf6rklaring",src:this.legendIcon})}render(){var e;const{layer:t,model:s,app:r,chapters:n}=this.props,o=(null===(e=this.props.app.config.mapConfig.map)||void 0===e?void 0:e.cqlFilterVisible)||!1;return this.caption?"group"===t.get("layerType")?(0,C.jsx)(S.default,{appConfig:r.config.appConfig,mapConfig:r.config.mapConfig,layer:t,model:s,options:this.props.options,chapters:n,cqlFilterVisible:o,onOpenChapter:e=>{r.windows.find((e=>"informative"===e.type)).props.custom.open(e)}}):(0,C.jsxs)(T,{sx:{marginLeft:this.isBackgroundLayer?"0px":"45px"},children:[(0,C.jsxs)(w,{children:[(0,C.jsxs)(d.ZP,{wrap:"nowrap",alignItems:"center",alignContent:"center",container:!0,onClick:this.toggleVisible.bind(this),children:[(0,C.jsx)(d.ZP,{item:!0,children:this.getLayerToggler()}),this.legendIcon&&this.renderLegendIcon(),(0,C.jsx)(A,{children:this.caption})]}),(0,C.jsxs)(V,{children:[t.isFakeMapLayer?null:(0,C.jsx)(k.default,{layer:this.props.layer,enableDownloadLink:this.props.app.config.mapConfig.map.enableDownloadLink}),this.renderStatusButton(),this.renderInfoButton(),this.showAttributeTableButton&&(0,C.jsx)(h.Z,{title:"Visa lagrets attributtabell",children:(0,C.jsx)(O,{children:(0,C.jsx)(Z.Z,{onClick:(0,i.Z)(this,B)[B]})})}),this.renderMoreButton()]})]}),(0,C.jsxs)("div",{children:[this.renderDetails(),this.state.toggleSettings&&this.state.infoVisible&&!this.isInfoEmpty()?(0,C.jsx)("hr",{}):null,t.isFakeMapLayer?null:(0,C.jsx)(L.default,{options:this.props.options,layer:t,toggled:this.state.toggleSettings,showOpacity:!0,showLegend:!0,cqlFilterVisible:o})]})]}):null}}t.default=(0,o.RM)(F)}}]);
//# sourceMappingURL=7816.4030b2ec.chunk.js.map