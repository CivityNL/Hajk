"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[9495,541,7749],{79495:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var r=a(72791),s=a(57749),n=a(94777),i=a(95392),o=a(25806),c=a(80184);class h{constructor(e){this.internalId=0,this.init=()=>this.getAllDocumentsContainedInMenu().then((e=>{this.allDocuments=e,this.documentSearchmodel=new i.default({allDocuments:e,globalSearchModel:this.app.searchModel,app:this.app,localObserver:this.localObserver}),this.settings.resolveSearchInterface(this.documentSearchmodel.implementSearchInterface())})).then((()=>this)),this.warnNoCustomThemeUrl=()=>{console.warn("Could not find valid url for custom theme in documenthandler, check customThemeUrl")},this.fetchCustomThemeJson=()=>this.options.customThemeUrl?(0,o.hfetch)(this.options.customThemeUrl).then((e=>e.json())).catch((()=>(this.warnNoCustomThemeUrl(),null))):(this.warnNoCustomThemeUrl(),Promise.resolve("")),this.flattenMenu=e=>e.reduce(((e,t)=>(t.menu&&t.menu.length>0&&(e=[...e,...this.flattenMenu(t.menu)]),[...e,t])),[]),this.findChapters=(e,t)=>e.reduce(((e,a)=>(a.chapters&&a.chapters.length>0&&(e=[...e,...this.findChapters(a.chapters,t)]),a.headerIdentifier===t?[...e,a]:e)),[]),this.getHeaderRef=(e,t)=>{const a=this.findChapters(e.chapters,t);if(a.length>1)throw new Error("Two chapters with same header identifier found");return a[0]},this.setScrollReferences=e=>{e.scrollRef=r.createRef(),e.chapters.length>0&&e.chapters.forEach((e=>{this.setScrollReferences(e)}))},this.getCustomLink=e=>(0,c.jsx)(n.CustomLink,{aTag:e,localObserver:this.localObserver,bottomMargin:!0}),this.getTagSpecificCallbacks=()=>{let e=[];return e.push({tagType:"br",callback:()=>(0,c.jsx)(n.LineBreak,{})}),e.push({tagType:"ul",callback:e=>(0,c.jsx)(n.ULComponent,{ulComponent:e})}),e.push({tagType:"ol",callback:e=>(0,c.jsx)(n.OLComponent,{olComponent:e})}),e.push({tagType:"li",callback:()=>{}}),e.push({tagType:"blockquote",callback:e=>{var t;return"true"===(null===(t=e.attributes["data-accordion"])||void 0===t?void 0:t.value)?(0,c.jsx)(n.AccordionSection,{blockQuoteTag:e,defaultColors:this.options.defaultDocumentColorSettings}):(0,c.jsx)(n.BlockQuote,{blockQuoteTag:e,defaultColors:this.options.defaultDocumentColorSettings})}}),e.push({tagType:"h1",callback:e=>(0,c.jsx)(n.Heading,{headingTag:e})}),e.push({tagType:"h2",callback:e=>(0,c.jsx)(n.Heading,{headingTag:e})}),e.push({tagType:"h3",callback:e=>(0,c.jsx)(n.Heading,{headingTag:e})}),e.push({tagType:"h4",callback:e=>(0,c.jsx)(n.Heading,{headingTag:e})}),e.push({tagType:"h5",callback:e=>(0,c.jsx)(n.Heading,{headingTag:e})}),e.push({tagType:"h6",callback:e=>(0,c.jsx)(n.Heading,{headingTag:e})}),e.push({tagType:"a",callback:e=>(this.getCustomLink.bind(this),this.getCustomLink(e))}),e.push({tagType:"img",callback:e=>{const t=e.dataset.type||"image";return"image"===t?(0,c.jsx)(n.Img,{componentId:e.componentId,imgTag:e,localObserver:this.localObserver,baseUrl:this.mapServiceUrl}):"video"===t?(0,c.jsx)(n.Video,{imgTag:e,componentId:e.componentId,baseUrl:this.mapServiceUrl}):"audio"===t?(0,c.jsx)(n.Audio,{imgTag:e,componentId:e.componentId,baseUrl:this.mapServiceUrl}):void 0}}),e.push({tagType:"source",callback:e=>(0,c.jsx)(n.Source,{sourceTag:e})}),e.push({tagType:"p",callback:e=>(0,c.jsx)(n.Paragraph,{pTag:e})}),e.push({tagType:"figure",callback:e=>(0,c.jsx)(n.Figure,{figureTag:e})}),e.push({tagType:"strong",callback:e=>(0,c.jsx)(n.Strong,{strongTag:e})}),e.push({tagType:"u",callback:e=>(0,c.jsx)(n.Underline,{uTag:e})}),e.push({tagType:"em",callback:e=>(0,c.jsx)(n.Italic,{emTag:e})}),e},this.getMaterialUIComponentsForChapter=e=>(0,s.default)(e.html,this.getTagSpecificCallbacks()).map(((e,t)=>(0,c.jsx)(r.Fragment,{children:e},t))),this.hasSubChapters=e=>e.chapters&&e.chapters.length>0,this.appendComponentsToChapter=e=>{this.hasSubChapters(e)&&e.chapters.forEach((e=>{e.components=this.getMaterialUIComponentsForChapter(e),this.hasSubChapters(e)&&this.appendComponentsToChapter(e)}));let t=this.getMaterialUIComponentsForChapter(e);e.components=t},this.appendParsedComponentsToDocument=()=>{const{activeDocument:e}=this.props;let t={...e};t.chapters.forEach(((e,t)=>{this.appendComponentsToChapter(e)})),this.setState({activeContent:t})},this.mapServiceUrl=e.app.config.appConfig.proxy+e.app.config.appConfig.mapserviceBase,this.settings=e,this.app=e.app,this.allDocuments=[],this.chaptersMatchSearch=[],this.chapterInfo=[],this.chapterNumber=0,this.localObserver=e.localObserver,this.options=e.options}getAllDocumentsContainedInMenu(){return new Promise(((e,t)=>{this.allDocuments.length>0&&e(this.allDocuments);const a=this.flattenMenu(this.settings.menu).filter((e=>e.document));Promise.all(a.map((e=>this.fetchJsonDocument(e.document).then((t=>(t.title||console.warn("The document ".concat(e.document," is missing a title")),{...t,documentColor:e.color,documentFileName:e.document,documentTitle:t.title,menuItemId:e.id})))))).then((t=>{e(t)})).catch((e=>{t(e)}))}))}getDocuments(e){let t=[];return e.forEach((e=>{let a=this.allDocuments.find((t=>t.documentFileName===e));t=[...t,a]})),t}getAllChapterInfo(){return 0===this.chapterInfo.length&&(this.allDocuments.forEach(((e,t)=>{e.chapters.forEach((t=>{this.setChapterInfo(t,0,e.documentColor,e.documentFileName)}))})),this.mergeChapterInfo()),this.chapterInfo}getParentIdentifier(e){if(e.parent)return e.parent.headerIdentifier?e.parent.headerIdentifier:this.getParentIdentifier(e.parent)}setChapterInfo(e,t,a,r){let s=this.getParentIdentifier(e),n={};n.documentFileName=r,n.id=++this.chapterNumber,n.level=t,n.html=e.html,n.parent=e.parent,n.color=a,n.header=e.header,n.headerIdentifier=e.headerIdentifier,n.chosenForPrint=!1,n.parent=s,e.chapters&&e.chapters.length>0?(n.hasSubChapters=!0,this.chapterInfo=[...this.chapterInfo,n],t+=1,e.chapters.forEach((e=>{e=this.setChapterInfo(e,t,a,r)}))):(n.hasSubChapters=!1,this.chapterInfo=[...this.chapterInfo,n])}mergeChapterInfo(){this.chapterInfo.forEach((e=>{e.hasSubChapters&&e.headerIdentifier&&(e.chapters=this.chapterInfo.filter((t=>t.parent===e.headerIdentifier)),this.chapterInfo=this.chapterInfo.filter((t=>t.parent!==e.headerIdentifier)))}))}getChapterById(e,t){for(let a=0;a<e.length;a++){if(e[a].id===t)return e[a];if(e[a].chapters&&e[a].chapters.length>0){let r=this.getChapterById(e[a].chapters,t);if(r)return r}}}async fetchJsonDocument(e){let t;try{t=await(0,o.hfetch)("".concat(this.mapServiceUrl,"/informative/load/").concat(e));const a=await t.text();if("File not found"===a)throw new Error("Could not find document with title ".concat(e," in folder with documents"));const r=await JSON.parse(a);return this.internalId=0,r.chapters.forEach((e=>{this.setParentChapter(e,void 0),this.setInternalId(e),this.setScrollReferences(e),this.appendComponentsToChapter(e),this.internalId=this.internalId+1})),r}catch(a){throw console.warn("Kunde inte parsa JSON-dokumentet ".concat(document,", kontrollera s\xe5 att filen finns och \xe4r en .json-fil ")),new Error(a)}}setInternalId(e){e.id=this.internalId,e.chapters.length>0&&e.chapters.forEach((e=>{this.internalId=this.internalId+1,this.setInternalId(e)}))}setParentChapter(e,t){e.parent=t,e.chapters.length>0&&e.chapters.forEach((t=>{this.setParentChapter(t,e)}))}}},95392:(e,t,a)=>{a.r(t),a.d(t,{default:()=>o});var r=a(30541),s=a(92810),n=a(21960),i=a(35077);class o{constructor(e){this.bindListenForSearchResultClick=()=>{this.app.globalObserver.subscribe("search.featureClicked.documentHandlerSearchResultClicked",(e=>{this.localObserver.publish("document-link-clicked",{documentName:e.properties.documentFileName,headerIdentifier:e.properties.headerIdentifier})}))},this.createDocumentCollectionsToSearch=e=>e.reduce(((e,t)=>[...e,{documentFileName:t.documentFileName,documentTitle:t.documentTitle,features:[...this.getFeatures(t.chapters,t),this.getSpecialTitleFeature(t)]}]),[]),this.getFeatures=(e,t)=>e.reduce(((e,a)=>(a.chapters&&(e=[...e,...this.getFeatures(a.chapters,t)]),e=[...e,this.createFeatureFromChapter(a,t)])),[]),this.getSpecialTitleFeature=e=>{let t={header:e.documentTitle,geoids:[],headerIdentifier:e.documentTitle,documentTitle:e.documentTitle,documentFileName:e.documentFileName};const a="".concat(e.documentTitle).concat(Math.floor(1e3*Math.random()));return{type:"Feature",isTitleFeature:!0,geometry:null,searchValues:[e.title],id:a,onClickName:"documentHandlerSearchResultClicked",properties:t,get:e=>t[e],getGeometry:()=>null,getId:()=>a,setStyle:()=>null}},this.createFeatureFromChapter=(e,t)=>{let a=[];e.header&&a.push(e.header),e.keywords&&e.keywords.length>0&&(a=[...a,...e.keywords]);const r={header:e.header,geoids:e.geoids,headerIdentifier:e.headerIdentifier,documentTitle:t.documentTitle,documentFileName:t.documentFileName},s="".concat(e.headerIdentifier).concat(Math.floor(1e3*Math.random()));return{type:"Feature",geometry:null,isTitleFeature:!1,searchValues:a,id:s,onClickName:"documentHandlerSearchResultClicked",properties:r,get:e=>r[e],getGeometry:()=>null,getId:()=>s,setStyle:()=>null}},this.implementSearchInterface=()=>({getResults:this.getResults,getFunctionality:this.getFunctionality}),this.getFunctionality=()=>null,this.getResults=(e,t)=>(this.matchSearch=new r.default(t),this.searchOptions=t,this.getDocumentHandlerResults(e)),this.getDocumentHandlerResults=e=>new Promise(((t,a)=>{""===e&&t({featureCollections:[],errors:[]});let r=this.searchOptions.getPossibleCombinations?this.globalSearchModel.getPossibleSearchCombinations(e):[(0,n.splitAndTrimOnCommas)(e)];r=this.decodePotentialSpecialCharsFromFeatureProps(r),t({featureCollections:this.getFeatureCollectionsForMatchingDocuments(r),errors:[]})})),this.decodePotentialSpecialCharsFromFeatureProps=e=>e.map((e=>e.map((e=>(0,i.decodeCommas)(e))))),this.getSearchFields=e=>e.reduce(((e,t)=>(t.matchedSearchValues.length>0&&(e=[...e,...this.getMockedSearchFieldForChapter(t)]),e)),[]),this.getMatchedFeatures=(e,t)=>{const{initiator:a}=this.searchOptions;return e.features.reduce(((r,s)=>{if("search"===a){if(s.isTitleFeature)return r;s.searchValues.push(e.documentTitle)}return"autocomplete"!==a||s.isTitleFeature||(s.searchValues=s.searchValues.filter((t=>t!==e.documentTitle))),s.matchedSearchValues=this.getMatchedSearchValues(t,s.searchValues),s.matchedSearchValues.length>0?[...r,s]:r}),[])},this.createFeatureCollection=(e,t,a)=>({value:{status:"fulfilled",type:"FeatureCollection",crs:{type:null,properties:{name:null}},features:e,numberMatched:e.length,numberReturned:e.length,timeStamp:(new Date).toISOString(),totalFeatures:e.length},source:{id:a.documentTitle||a.documentFileName,caption:a.documentTitle||a.documentFileName,displayFields:["header"],searchFields:[...t]},origin:"DOCUMENT"}),this.getFeatureCollectionsForMatchingDocuments=e=>this.documentCollections.reduce(((t,a)=>{const r=this.getMatchedFeatures(a,e),s=this.getSearchFields(r),n=this.createFeatureCollection(r,s,a);return n?[...t,n]:t}),[]),this.getMockedSearchFieldForChapter=e=>e.matchedSearchValues.reduce(((t,a)=>{const r=(0,s.Z)();return e.properties[r]=a,[...t,r]}),[]),this.getAllMatchedSearchValues=(e,t)=>{const a=new Set;return this.getMatched(e,t).forEach((e=>{a.add(e)})),a},this.getMatchedSearchValues=(e,t)=>{let a=new Set;return e.some((e=>e.every((e=>{let r=this.getAllMatchedSearchValues(e,t);return a=new Set([...a,...r]),r.size>0}))))?Array.from(a):[]},this.getMatched=(e,t)=>t.reduce(((t,a)=>this.matchSearch.compare(e,a)?[...t,a]:t),[]),this.globalSearchModel=e.globalSearchModel,this.documentCollections=this.createDocumentCollectionsToSearch(e.allDocuments),this.localObserver=e.localObserver,this.app=e.app,this.bindListenForSearchResultClick()}}},30541:(e,t,a)=>{a.r(t),a.d(t,{default:()=>r});class r{constructor(e){this.getMatchRegexp=e=>{const{wildcardAtEnd:t,wildcardAtStart:a,matchCase:r}=this.searchOptions;let s=r?"g":"gi";return a&&!t?new RegExp(".*".concat(e,"$"),s):!a&&t?new RegExp("^".concat(e,".*"),s):a&&t?new RegExp("".concat(e),s):new RegExp("^".concat(e,"$"),s)},this.escapeSpecialChars=e=>e.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1"),this.compare=(e,t)=>{const a=this.escapeSpecialChars(e);return this.getMatchRegexp(a).test(t)},this.searchOptions=e}}},57749:(e,t,a)=>{a.r(t);var r=a(92810);const s=(e,t)=>{let a=t.find((t=>t.tagType.toLowerCase()===e.tagName.toLowerCase()));if(e.callback=null===a||void 0===a?void 0:a.callback,e.componentId=(0,r.Z)(),e.children.length>0)for(const r of e.children)s(r,t)};t.default=(e,t)=>{let a=(new DOMParser).parseFromString(e,"text/html");for(const r of a.body.children)s(r,t);return[...a.body.children].map((e=>e.callback?e.callback(e):null))}},92810:(e,t,a)=>{var r;a.d(t,{Z:()=>u});var s=new Uint8Array(16);function n(){if(!r&&!(r="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(s)}var i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var o=function(e){return"string"===typeof e&&i.test(e)},c=[],h=0;h<256;++h)c.push((h+256).toString(16).substr(1));var l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase();if(!o(a))throw TypeError("Stringified UUID is invalid");return a};var u=function(e,t,a){var r=(e=e||{}).random||(e.rng||n)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){a=a||0;for(var s=0;s<16;++s)t[a+s]=r[s];return t}return l(r)}}}]);
//# sourceMappingURL=9495.14800b6d.chunk.js.map