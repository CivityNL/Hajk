(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[7646],{77646:(t,e,i)=>{"use strict";i.r(e);var o=i(64665),r=i(18029),n=i(90927),s=i(66233),a=i(5400),l=i(5426),d=i(9501),c=i(29409),h=i(62652),u=i(42708),g=i(67738);const p=i(96603);e.default=class{constructor(t){this.setTravelMode=t=>{this.travelMode=this.googleMapsApi.DirectionsTravelMode.hasOwnProperty(t)?this.googleMapsApi.DirectionsTravelMode[t]:"WALKING",this.travelModeLabel=this.travelModeLabels[this.travelMode],this.localObserver.publish("doneWithStep",3)},this.getCurrentPositionSuccess=t=>{this.position={latitude:t.coords.latitude,longitude:t.coords.longitude},this.setPosition()},this.getCurrentPositionError=t=>{console.error(t)},this.setPosition=()=>{if(this.layer_start.getSource().clear(),this.position.longitude&&this.position.latitude){var t=new c.Z([this.position.longitude,this.position.latitude]),e=(0,u.vs)(t.getCoordinates(),"EPSG:4326",this.olMap.getView().getProjection());t.setCoordinates(e);var i=new h.Z({geometry:t});i.setStyle(this.style_start),this.layer_start.getSource().addFeature(i),this.olMap.getView().setCenter(t.getCoordinates()),this.localObserver.publish("doneWithStep",1),this.localObserver.publish("startModeSelected","gps")}},this.getLocation=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(this.getCurrentPositionSuccess,this.getCurrentPositionError):window.alert("Kan inte f\xe5 position. Skriv startposition i rutan eller tryck position p\xe5 kartan.")},this.activateStartMode=()=>{this.olMap.once("singleclick",this.startPointSelection)},this.startPointSelection=t=>{var e=new h.Z;e.setGeometry(new c.Z(t.coordinate));var i=(0,u.vs)(e.getGeometry().getCoordinates(),this.projection,"EPSG:4326"),o=i[0],r=i[1];this.layer_start.getSource().clear(),this.layer_start.getSource().addFeature(e),e.setStyle(this.style_start);var n=this.position;n.latitude=r,n.longitude=o,this.position=n,this.localObserver.publish("doneWithStep",1),this.localObserver.publish("startModeSelected","manual")},this.activateEndMode=()=>{this.onEndKey=this.olMap.once("singleclick",this.endPointSelection)},this.endPointSelection=t=>{var e=new h.Z;e.setGeometry(new c.Z(t.coordinate));var i=(0,u.vs)(e.getGeometry().getCoordinates(),this.projection,"EPSG:4326"),o=i[0],r=i[1];this.layer_end.getSource().clear(),this.layer_end.getSource().addFeature(e),e.setStyle(this.style_end);var n=this.position;n.latitudeEnd=r,n.longitudeEnd=o,this.position=n,this.localObserver.publish("doneWithStep",2)},this.olMap=t.map,this.localObserver=t.localObserver,this.apiKey=t.options.apiKey,this.travelMode="WALKING",this.travelModeLabels={WALKING:"G\xe5",DRIVING:"K\xf6r",TRANSIT:"Kollektivtrafik",BICYCLING:"Cykla"},this.position={latitude:void 0,longitude:void 0,latitudeEnd:void 0,longitudeEnd:void 0},this.projection=t.app.config.mapConfig.map.projection,p({key:this.apiKey}).then((t=>{this.googleMapsApi=t})),this.initiateRoutingLayerInOpenLayersMap()}generatePinIcon(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000000",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"24";const i='<?xml version="1.0" encoding="UTF-8"?>\n    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"  width="'.concat(e,'" height="').concat(e,'" viewBox="0 0 ').concat(e," ").concat(e,'">\n    <path fill="').concat(t,'" d="M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z" />\n    </svg>');return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(i)}initiateRoutingLayerInOpenLayersMap(){this.style_start=new o.ZP({image:new r.Z({src:this.generatePinIcon("#00a83b","36")})}),this.style_end=new o.ZP({image:new r.Z({src:this.generatePinIcon("#ff4747")})}),this.style_route=new o.ZP({image:new r.Z({src:this.generatePinIcon("#6e6e6e")})}),this.style_route_normal=this.style_route,this.style_route_highlight=new o.ZP({image:new r.Z({src:this.generatePinIcon("#47ff87")})}),this.layer_drawing_style=new o.ZP({fill:new n.Z({color:"rgba(255, 255, 255, 0.5)"}),stroke:new s.Z({color:"rgba(0, 0, 255, 0.5)",width:4}),image:new a.Z({radius:6,fill:new n.Z({color:"rgba(0, 0, 0, 0.5)"}),stroke:new s.Z({color:"rgba(255, 255, 255, 0.5)",width:2})})});var t=new l.Z({}),e=new l.Z({}),i=new l.Z({}),c=new l.Z({});void 0===this.layer_start&&(this.layer_start=new d.Z({layerType:"system",zIndex:5e3,source:t,name:"pluginRoutingStart",content:"point",queryable:!1,style:this.style_start}),this.layer_end=new d.Z({layerType:"system",zIndex:5e3,source:e,name:"pluginRoutingEnd",content:"point",queryable:!1,style:this.style_end}),this.layer_route=new d.Z({layerType:"system",zIndex:5e3,source:i,name:"pluginRoutingRoute",content:"point",queryable:!0,style:this.style_route}),this.layer_drawing=new d.Z({layerType:"system",zIndex:5e3,source:c,name:"pluginRoutingDrawing",content:"line",queryable:!1,style:this.layer_drawing_style}),this.olMap.addLayer(this.layer_start),this.olMap.addLayer(this.layer_end),this.olMap.addLayer(this.layer_route),this.olMap.addLayer(this.layer_drawing))}activateRoutingMode(){this.searchTrip()}searchTrip(){var t=this.position;if(void 0===t.latitude||void 0===t.longitude||void 0===t.latitudeEnd||void 0===t.longitudeEnd)this.localObserver.publish("startStopPointsMissing");else{const e=new this.googleMapsApi.DirectionsService,i={origin:{lat:t.latitude,lng:t.longitude},destination:{lat:t.latitudeEnd,lng:t.longitudeEnd},travelMode:this.travelMode};e.route(i,(t=>{switch(t.status){case"REQUEST_DENIED":this.localObserver.publish("requestDenied");break;case"ZERO_RESULTS":this.localObserver.publish("zeroResults");break;case"OK":this.plotRoute(t,this.map,this.layer_route,this.layer_drawing);break;default:this.localObserver.publish("otherError",t.status)}}))}}plotRoute(t,e,i,o){i.getSource().clear();var r=t.routes[0].legs[0].steps;const n=document.createElement("div"),s=document.createElement("p"),a=document.createElement("ol");s.innerHTML='\n                    <table class="table table-condensed">\n                      <tbody>\n                        <tr><td><b>F\xe4rds\xe4tt</b></td><td>'.concat(this.travelModeLabel,"</td></tr>\n                        <tr><td><b>Avst\xe5nd</b></td><td>").concat(t.routes[0].legs[0].distance.text," (").concat(t.routes[0].legs[0].distance.value," m)</td></tr>\n                        <tr><td><b>Tid</b></td><td>").concat(t.routes[0].legs[0].duration.text,"</td></tr>\n                        <tr><td><b>Startadress</b></td><td>").concat(t.routes[0].legs[0].start_address,"</td></tr>\n                        <tr><td><b>Slutadress</b></td><td>").concat(t.routes[0].legs[0].end_address,"</td></tr>\n                      </tbody>\n                    </table>\n                    "),n.appendChild(s);for(var l=0;l<r.length;l++){var d=r[l].start_location.lat(),p=r[l].start_location.lng(),y=new c.Z([p,d]),v=(0,u.vs)(y.getCoordinates(),"EPSG:4326",this.projection);y.setCoordinates(v);var w=l+1,m=new h.Z({geometry:y,info:r[l].instructions});m.number=""+w,m.setStyle(this.style_route),i.getSource().addFeature(m);var b=document.createElement("li");b.onclick=this.highlightFeature.bind(this),b.id="step_number"+w,b.innerHTML=r[l].instructions,a.appendChild(b)}n.appendChild(a);for(var _=document.getElementById("resultList");_.firstChild;)_.removeChild(_.firstChild);document.getElementById("resultList").appendChild(n);const f=new g.ZP({}).readGeometry(t.routes[0].overview_polyline,{dataProjection:"EPSG:4326",featureProjection:this.projection});o.getSource().clear();var S=new h.Z({type:"routing",geometry:f});S.setStyle(this.layer_drawing_style),o.getSource().addFeature(S);var M=(this.position.latitude+this.position.latitudeEnd)/2,E=(this.position.longitude+this.position.longitudeEnd)/2;this.olMap.getView().setCenter((0,u.vs)([E,M],"EPSG:4326",this.projection)),this.olMap.getView().fit(o.getSource().getExtent(),this.olMap.getSize())}highlightFeature(t){var e=-1;e="B"===t.target.nodeName?t.target.parentNode.id.substring("step_number".length):t.target.id.substring("step_number".length);for(var i=this.layer_route.getSource().getFeatures(),o=0;o<i.length;o++)i[o].number===e?i[o].setStyle(this.style_route_highlight):i[o].setStyle(this.style_route_normal)}drawRoute(t){var e=new g.ZP({}).readGeometry(t),i=new h.Z({type:"routing",geometry:e});i.setStyle(this.style_route),this.get("layer_drawing").getSource().addFeature(i)}clearMap(){this.layer_start.getSource().clear(),this.layer_end.getSource().clear(),this.layer_route.getSource().clear(),this.layer_drawing.getSource().clear(),document.getElementById("resultList").innerHTML="",this.position={latitude:void 0,longitude:void 0,latitudeEnd:void 0,longitudeEnd:void 0}}}},96603:t=>{const e="https://maps.googleapis.com/maps/api/js",i="__googleMapsApiOnLoadCallback",o=["channel","client","key","language","region","v"];let r=null;t.exports=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r=r||new Promise((function(r,n){const s=setTimeout((function(){window[i]=function(){},n(new Error("Could not load the Google Maps API"))}),t.timeout||1e4);window[i]=function(){null!==s&&clearTimeout(s),r(window.google.maps),delete window[i]};const a=document.createElement("script"),l=["callback=".concat(i)];o.forEach((function(e){t[e]&&l.push("".concat(e,"=").concat(t[e]))})),t.libraries&&t.libraries.length&&l.push("libraries=".concat(t.libraries.join(","))),a.src="".concat(t.apiUrl||e,"?").concat(l.join("&")),document.body.appendChild(a)})),r}},67738:(t,e,i)=>{"use strict";i.d(e,{ZP:()=>p});var o=i(62652),r=i(35844),n=i(43017),s=i(16862);function a(t,e,i,o,r,n){void 0!==r?n=void 0!==n?n:0:(r=[],n=0);let s=e;for(;s<i;){const e=t[s++];r[n++]=t[s++],r[n++]=e;for(let i=2;i<o;++i)r[n++]=t[s++]}return r.length=n,r}var l=i(42708),d=i(52952),c=i(56861),h=i(49791);class u extends n.Z{constructor(t){super(),t=t||{},this.dataProjection=(0,l.U2)("EPSG:4326"),this.factor_=t.factor?t.factor:1e5,this.geometryLayout_=t.geometryLayout?t.geometryLayout:"XY"}readFeatureFromText(t,e){const i=this.readGeometryFromText(t,e);return new o.Z(i)}readFeaturesFromText(t,e){return[this.readFeatureFromText(t,e)]}readGeometryFromText(t,e){const i=(0,d.tP)(this.geometryLayout_),o=function(t,e,i){let o;i=i||1e5;const r=new Array(e);for(o=0;o<e;++o)r[o]=0;const n=function(t,e){e=e||1e5;const i=function(t){const e=function(t){const e=[];let i=0,o=0;for(let r=0,n=t.length;r<n;++r){const n=t.charCodeAt(r)-63;i|=(31&n)<<o,n<32?(e.push(i),i=0,o=0):o+=5}return e}(t);for(let i=0,o=e.length;i<o;++i){const t=e[i];e[i]=1&t?~(t>>1):t>>1}return e}(t);for(let o=0,r=i.length;o<r;++o)i[o]/=e;return i}(t,i);for(let s=0,a=n.length;s<a;)for(o=0;o<e;++o,++s)r[o]+=n[s],n[s]=r[o];return n}(t,i,this.factor_);a(o,0,o.length,i,o);const n=(0,c.Ml)(o,0,o.length,i),s=new r.Z(n,this.geometryLayout_);return(0,h.fI)(s,!1,this.adaptOptions(e))}writeFeatureText(t,e){const i=t.getGeometry();return i?this.writeGeometryText(i,e):((0,s.h)(!1,40),"")}writeFeaturesText(t,e){return this.writeFeatureText(t[0],e)}writeGeometryText(t,e){const i=(t=(0,h.fI)(t,!0,this.adaptOptions(e))).getFlatCoordinates(),o=t.getStride();return a(i,0,i.length,o,i),function(t,e,i){let o;i=i||1e5;const r=new Array(e);for(o=0;o<e;++o)r[o]=0;for(let n=0,s=t.length;n<s;)for(o=0;o<e;++o,++n){const e=t[n],i=e-r[o];r[o]=e,t[n]=i}return function(t,e){e=e||1e5;for(let i=0,o=t.length;i<o;++i)t[i]=Math.round(t[i]*e);return function(t){for(let e=0,i=t.length;e<i;++e){const i=t[e];t[e]=i<0?~(i<<1):i<<1}return function(t){let e="";for(let i=0,o=t.length;i<o;++i)e+=g(t[i]);return e}(t)}(t)}(t,i)}(i,o,this.factor_)}}function g(t){let e,i="";for(;t>=32;)e=63+(32|31&t),i+=String.fromCharCode(e),t>>=5;return e=t+63,i+=String.fromCharCode(e),i}var p=u}}]);
//# sourceMappingURL=7646.d4c2e198.chunk.js.map