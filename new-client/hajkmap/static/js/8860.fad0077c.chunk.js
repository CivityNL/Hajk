"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[8860],{28860:(e,t,r)=>{r.r(t);var i=r(9501),o=r(5426),g=r(64665),a=r(66233),n=r(90927),l=r(18029),s=r(5400),c=r(37130),u=r(56957),p=r(62652),y=r(57707),h=r(70328),S=r(2421),d=r(92245),f=r(24673),m=r(15678),x=r(81019),C=r(68789),F=r(25806),v=function(e){return/^#/.test(e)?e:"#"+e.match(/\d+(\.\d+)?/g).splice(0,3).map((e=>{var t=parseInt(e,10).toString(16);return parseInt(e)<16&&(t="0"+t),t})).join("")};t.default=class{constructor(e){this.map=e.map,this.app=e.app,this.localObserver=e.localObserver,this.exportUrl=e.options.exportUrl,this.scales=this.validateScales(e.options.scales),this.copyright="\xa9 Lantm\xe4teriverket i2009/00858",this.autoScale=!1,this.instruction="",this.addPreviewLayer()}validateScales(e){return"string"==typeof e&&/(\d+)(,\s*\d+)*/.test(e)?e.split(",").map((e=>Number(e))):[250,500,1e3,2500,5e3,1e4,25e3,5e4,1e5,25e4]}addPreviewLayer(){this.previewLayer=new i.Z({source:new o.Z,layerType:"system",zIndex:5e3,name:"pluginExport",caption:"Export plugin",style:new g.ZP({stroke:new a.Z({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new n.Z({color:"rgba(255, 145, 20, 0.4)"})})}),this.map.addLayer(this.previewLayer)}removePreview(){this.previewFeature=void 0,this.previewLayer.getSource().clear(),this.map.removeInteraction(this.translate)}getPreviewFeature(){return this.previewFeature}getPreviewCenter(){var e=this.getPreviewFeature().getGeometry().getExtent();return(0,c.getCenter)(e)}addPreview(e,t,r){var i=25.4/.28,o=t.width/i/39.37*e/2*1,g=t.height/i/39.37*e/2*1,a=[[[r[0]-o,r[1]-g],[r[0]-o,r[1]+g],[r[0]+o,r[1]+g],[r[0]+o,r[1]-g],[r[0]-o,r[1]-g]]],n=new p.Z({geometry:new u.ZP(a)});this.removePreview(),this.previewFeature=n,this.previewLayer.getSource().addFeature(n),this.translate=new f.Z({features:new C.Z([n])}),this.map.addInteraction(this.translate)}findWMS(){return this.map.getLayers().getArray().filter((e=>(e instanceof y.Z||e instanceof h.Z)&&(e.getSource()instanceof S.Z||e.getSource()instanceof d.Z)&&e.getVisible())).map(((e,t)=>{const r="string"===typeof e.getSource().getParams().LAYERS?e.getSource().getParams().LAYERS.split(","):e.getSource().getParams().LAYERS;return{url:e.getSource().get("url"),layers:r,zIndex:t,workspacePrefix:null,coordinateSystemId:this.map.getView().getProjection().getCode().split(":")[1]}}))}findVector(){function e(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function t(t){const r=/rgb(a)?\((\d+), (\d+), (\d+)(, [\d.]+)?\)/.exec(t);if(null!==r){let t=parseInt(r[2]),i=parseInt(r[3]),o=parseInt(r[4]);return parseInt(r[5])?null:"#"+e(t)+e(i)+e(o)}return null}function r(e){function r(e){var r=e.join(", ");return t("rgba(".concat(r,")"))}if(!e)return null;Array.isArray(e)&&(2===e.length&&(e=e[1]),1===e.length&&(e=e[0]));var i,o="#FC345C",g=.5,a="#FC345C",n=3,c="round",u="solid",p=10,y="#FC345C",h="",S="16",d="#FFFFFF",f="#000000";return e.getText&&e.getText()&&e.getText().getFont&&e.getText().getFont()&&(S=e.getText().getFont().match(/\d+/)[0]),e.getText&&e.getText()&&e.getText().getFill&&e.getText().getFill()&&("string"===typeof e.getText().getFill().getColor()?d=e.getText().getFill().getColor():Array.isArray(e.getText().getFill().getColor())&&(d=r(e.getText().getFill().getColor()))),e.getText&&e.getText()&&e.getText().getStroke&&e.getText().getStroke()&&("string"===typeof e.getText().getFill().getColor()?f=e.getText().getStroke().getColor():Array.isArray(e.getText().getStroke().getColor())&&(f=r(e.getText().getStroke().getColor()))),d&&/^rgb/.test(d)&&(d=t(d)),f&&(f=/^rgb\(/.test(f)?t(f):null),e.getFill&&e.getFill()&&e.getFill().getColor()&&(v(e.getFill().getColor())?(o=v(e.getFill().getColor()),i=e.getFill().getColor(),g=parseFloat(i.match(/\d+(\.\d+)?/g).splice(3,1)[0])):Array.isArray(e.getFill().getColor())&&(o=r(e.getFill().getColor()),g=e.getFill().getColor()[e.getFill().getColor().length-1])),e.getFill&&e.getStroke()&&(v(e.getStroke().getColor())?a=v(e.getStroke().getColor()):Array.isArray(e.getStroke().getColor())&&(a=r(e.getStroke().getColor())),n=e.getStroke().getWidth()||3,c=e.getStroke().getLineCap()||"round",u=e.getStroke().getLineDash()?12===e.getStroke().getLineDash()[0]?"dash":"dot":"solid"),e.getImage&&e.getImage()&&(e.getImage()instanceof l.Z&&(h=e.getImage().getSrc()),e.getImage()instanceof s.Z&&(p=e.getImage().getRadius(),y=v(e.getImage().getFill().getColor()))),{fillColor:o,fillOpacity:g,strokeColor:a,strokeOpacity:1,strokeWidth:n,strokeLinecap:c,strokeDashstyle:u,pointRadius:p,pointFillColor:y,pointSrc:h,labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3,fontSize:S,fontColor:d,fontBackColor:f}}function o(e,t){switch(t){case"Point":return[e];case"LineString":return e;case"Polygon":return e[0];case"MultiPolygon":return e[0][0];case"Circle":return[e[0],e[1]]}}var g=this.previewLayer.getSource().getFeatures()[0].getGeometry().getExtent();return this.map.getLayers().getArray().filter((e=>e instanceof i.Z&&e.getVisible()&&"pluginExport"!==e.get("name"))).map((e=>function(e,t){function i(e){var t="";return e.getProperties()&&"Text"===e.getProperties().type?t=e.getProperties().description?e.getProperties().description:e.getProperties().name?e.getProperties().name:"":(e.getStyle&&Array.isArray(e.getStyle())&&e.getStyle()[1]&&e.getStyle()[1].getText()&&e.getStyle()[1].getText().getText()&&(t=e.getStyle()[1].getText().getText()),e.getStyle&&e.getStyle()&&e.getStyle().getText&&e.getStyle().getText()&&(t=e.getStyle().getText().getText()),t)}return{features:e.map((e=>{var g,a=e.getGeometry().getType(),n=e.getGeometry(),l=null;if(!e.getStyle()&&t){let r=t.getStyle()(e)[0];e.setStyle(r)}return g="Circle"===a?o([n.getCenter(),[n.getRadius(),0]],"Circle"):o(n.getCoordinates(),a),"MultiPolygon"===a&&(l=n.getCoordinates()[0].slice(1,n.getCoordinates()[0].length)),{type:a,attributes:{text:i(e),style:r(e.getStyle())},coordinates:g,holes:l}}))}}(e.getSource().getFeaturesInExtent(g),e))).filter((e=>e.features.length>0))}findWMTS(){return this.map.getLayers().getArray().filter((e=>e.getSource()instanceof m.Z&&e.getVisible())).map((e=>{var t=e.getSource();return{url:Array.isArray(t.getUrls())?t.getUrls()[0]:t.get("url"),axisMode:"natural"}}))}findArcGIS(){return this.map.getLayers().getArray().filter((function(e){return e.getSource()instanceof x.Z&&e.getVisible()})).map((function(e){var t=e.getSource().get("url"),r=e.get("extent")||[],i=[],o=e.get("projection");return"string"===typeof e.getSource().getParams("params").LAYERS&&(i=e.getSource().getParams("params").LAYERS.replace("show:","").split(",")),"string"===typeof o&&(o=o.replace("EPSG:","")),{url:t,layers:i,spatialReference:o,extent:{left:r[0],bottom:r[1],right:r[2],top:r[3]}}}))}exportPDF(e,t){var r=this.previewLayer.getSource().getFeatures()[0].getGeometry().getExtent(),i=r[0],o=r[2],g=r[1],a=r[3],n=this.exportUrl,l={wmsLayers:[],vectorLayers:[],size:null,resolution:e.resolution,bbox:null};l.vectorLayers=this.findVector()||[],l.wmsLayers=this.findWMS()||[],l.wmtsLayers=this.findWMTS()||[],l.arcgisLayers=this.findArcGIS()||[],l.size=[parseInt(e.size.width*e.resolution),parseInt(e.size.height*e.resolution)],l.bbox=[i,o,g,a],l.orientation=e.orientation,l.format=e.format,l.scale=e.scale,(0,F.hfetch)(n,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:JSON.stringify(l)})}).then((e=>{e.text().then((e=>{t&&t(e)}))})).catch((e=>{alert("Det gick inte att exportera kartan. "+e),console.error(e)}))}resolutionToScale(e,t){return t*e*39.37}getMap(){return this.map}}}}]);
//# sourceMappingURL=8860.fad0077c.chunk.js.map