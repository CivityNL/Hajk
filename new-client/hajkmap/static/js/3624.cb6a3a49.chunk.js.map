{"version":3,"file":"static/js/3624.cb6a3a49.chunk.js","mappings":"4SA6bA,UAlbA,MACEA,YAAYC,GAAW,IAAD,OA2BtBC,wBAA0B,KACpBC,KAAKC,cACPD,KAAKE,WAAaF,KAAKC,cAAcE,eAAeC,QAClD,CAACC,EAAKC,KACJD,EAAIC,EAAMC,MAAQP,KAAKQ,gBAAgBF,GAChCD,IAET,CAAC,GAGHL,KAAKE,WAAa,CAAC,CACpB,EArCDF,KAAKS,IAAMX,EAASW,IACpBT,KAAKU,IAAMZ,EAASY,IACpBV,KAAKW,SAAWb,EAASa,SACzBX,KAAKY,eAAiBd,EAASc,eAC/BZ,KAAKa,eAAiB,CAACf,EAASgB,QAAQC,WACxCf,KAAKgB,QAAU,CAAClB,EAASgB,QAAQb,eACjCD,KAAKiB,kBAAeC,EACpBlB,KAAKmB,WAAQD,EACblB,KAAKoB,YAASF,EACdlB,KAAKqB,YAASH,EACdlB,KAAKsB,SAAMJ,EACXlB,KAAKuB,iBAAcL,EACnBlB,KAAKwB,gBAAaN,EAClBlB,KAAKyB,OAAQ,EACbzB,KAAK0B,QAAS,EACd1B,KAAK2B,aAAe,OACpB3B,KAAK4B,IAAL,UAAW9B,EAASgB,QAAQc,WAA5B,SACA5B,KAAKC,cAAgBH,EAASgB,QAAQb,cAClCD,KAAKC,eACPD,KAAKD,0BACLC,KAAK6B,SAAS/B,EAASgB,QAAQb,gBAE/B6B,QAAQC,KAAK,sDAEhB,CAgBDvB,gBAAgBF,GACd,OAAQA,EAAM0B,UACZ,IAAK,YACH,OAAO,IAAIC,MAAOC,UACpB,IAAK,MACL,IAAK,SACH,OAAO,EACT,IAAK,SACH,MAAuB,YAAnB5B,EAAM6B,SACD7B,EAAM8B,OAAO1B,KAAK2B,IAAD,CAAUC,SAAS,EAAOC,MAAOF,MAEpD,GACT,QACE,MAAO,GAEZ,CAEDG,MAAMC,GACJ,IAAIC,EAAS,IAAIC,EAAAA,EACfC,EAAK5C,KAAKwB,WAAWqB,OAAO,GAAGC,MAAM,KACrCC,EAAmB,IAAdH,EAAGI,OAAeJ,EAAG,GAAK,GAC/BK,EAAmB,IAAdL,EAAGI,OAAeJ,EAAG,GAAKA,EAAG,GAClC9B,EAAU,CACRoC,UAAWlD,KAAKwB,WAAW2B,IAC3BC,cAAeL,EACfM,YAAaJ,EACbK,MAAM,EACNC,QAAS,QACTC,QAASxD,KAAKwB,WAAWiC,YAG7B,OAAOf,EAAOgB,iBACZjB,EAASkB,QACTlB,EAASmB,QACTnB,EAASoB,QACT/C,EAEH,CAEDgD,aAAaC,GACX,IAAIC,EACFC,EAAajE,KAAKU,IACfwD,YACAC,WACAC,MAAMjD,IACL,IAAIkD,GAAQ,EACZ,GAAIlD,EAAMmD,YAAYC,UAAW,CAC/B,IAAIC,EAASrD,EAAMmD,YAAYC,YAC/B,GAAsB,kBAAXC,EAAqB,CAC9B,IAAIC,EAAYD,EAAOE,OAAO5B,MAAM,KAChC6B,EAAaZ,EAAUjB,MAAM,KACR,IAArB2B,EAAUzB,QAAsC,IAAtB2B,EAAW3B,SACvCqB,EAAQN,IAAcS,EAAOE,QAEN,IAArBD,EAAUzB,SACZqB,EAAQM,EAAW,KAAOH,EAAOE,OAEpC,CACF,CACD,OAAOL,CAAP,IAGFJ,KACFD,EAASC,EAAWK,aACbM,UACPZ,EAAOa,aAAa,CAAEC,KAAM7C,KAAK8C,QACjC/E,KAAKU,IAAIsE,aAEZ,CAEDC,kBAAkBC,GAChB,IAAIC,EACkB,kBAAbD,GACH,IAAIE,eAAgBC,kBAAkBH,GACtCA,EACN,OAAO,IAAII,MAAOC,OAAOJ,EAC1B,CAEDK,SAAS/C,EAAUgD,GACjB,IAAIC,EAAO1F,KAAKwC,MAAMC,GACpBkD,EAAa,IAAIP,cACjBQ,EAAM5F,KAAKwB,WACXqE,EAAUH,EAAOC,EAAWN,kBAAkBK,QAAQxE,EAEpD2E,IAA2B,IAAhB7F,KAAK0B,SAClB1B,KAAK0B,QAAS,GACdoE,EAAAA,EAAAA,QAAOF,EAAIG,IAAK,CACdC,OAAQ,OACRC,KAAMJ,EACNK,YAAa,cACbC,QAAS,CACP,eAAgB,cAGjBC,MAAMlB,IACLlF,KAAK0B,QAAS,EACdwD,EAASmB,OAAOD,MAAME,IACpBtG,KAAK8D,aAAa8B,EAAI/C,OAAO,IAC7B7C,KAAKiB,aACFsF,cACAC,QAAQnE,QAAyBnB,IAAnBmB,EAAEoE,eAChBC,SAASrE,GAAOA,EAAEoE,kBAAevF,IACpCuE,EAAKzF,KAAKiF,kBAAkBqB,GAA5B,GANF,IASDK,OAAOzB,IACNlF,KAAK0B,QAAS,EACdwD,EAASmB,OAAOD,MAAMQ,IACpBnB,EAAKmB,EAAL,GADF,IAKP,CAEDC,KAAKpB,GACH,IAAI9B,EAAU3D,KAAKiB,aAAasF,cAChC,MAAMrG,EAAa,IAAKF,KAAKE,YAC7B4G,OAAOC,KAAK7G,GAAYwG,SAASpF,IAC3B0F,MAAMC,QAAQ/G,EAAWoB,MAC3BpB,EAAWoB,GAAOpB,EAAWoB,GAC1BkF,QAAQU,GAAMA,EAAE5E,UAChB5B,KAAKwG,GAAMA,EAAE3E,QACb4E,KAAK,MACT,IAGoB,IAAnBxD,EAAQX,QACVW,EAAQyD,KAAK,IAAIC,EAAAA,GAGf1D,EAAQX,OAAS,IACnBW,EAAQ,GAAG2D,cAAcpH,GACzBF,KAAKwF,SAAS,CAAE7B,QAASA,GAAW8B,GAEvC,CAED8B,eAAeC,GACb,MAAO,CACL,IAAIC,EAAAA,GAAM,CACRC,OAAQ,IAAIC,EAAAA,EAAO,CACjBC,MAAO,uBACPC,MAAO,IAETC,KAAM,IAAIC,EAAAA,EAAK,CACbH,MAAO,uBAETI,MAAO,IAAIC,EAAAA,EAAO,CAChBH,KAAM,IAAIC,EAAAA,EAAK,CACbH,MAAO,uBAETF,OAAQ,IAAIC,EAAAA,EAAO,CACjBC,MAAO,uBACPC,MAAO,IAETK,OAAQ,MAGZ,IAAIT,EAAAA,GAAM,CACRO,MAAO,IAAIG,EAAAA,EAAa,CACtBL,KAAM,IAAIC,EAAAA,EAAK,CACbH,MAAO,uBAETF,OAAQ,IAAIC,EAAAA,EAAO,CACjBC,MAAO,mBACPC,MAAO,IAETO,OAAQ,EACRF,OAAQ,EACRG,MAAOC,KAAKC,GAAK,IAEnBC,SAAWhB,IACT,IAAIiB,EACFjB,EAAQkB,wBAAyBC,EAAAA,GAC7BnB,EAAQkB,cAAcE,iBAAiB,GACvCpB,EAAQkB,cAAcE,iBAC5B,OAAO,IAAIC,EAAAA,EAAWJ,EAAtB,IAIP,CAEDK,eAAetB,GACb,MAAO,CACL,IAAIC,EAAAA,GAAM,CACRC,OAAQ,IAAIC,EAAAA,EAAO,CACjBC,MAAO,wBACPC,MAAO,IAETC,KAAM,IAAIC,EAAAA,EAAK,CACbH,MAAO,4BAETI,MAAO,IAAIe,EAAAA,EAAK,CACdC,MAAO,GACPC,OAAQ,CAAC,GAAK,GACdC,aAAc,WACdC,aAAc,WACdvD,IAAK,oBAIZ,CAEDwD,eAAe5B,GACb,MAAO,CACL,IAAIC,EAAAA,GAAM,CACRC,OAAQ,IAAIC,EAAAA,EAAO,CACjBC,MAAO,mBACPC,MAAO,IAETC,KAAM,IAAIC,EAAAA,EAAK,CACbH,MAAO,qBAETI,MAAO,IAAIC,EAAAA,EAAO,CAChBH,KAAM,IAAIC,EAAAA,EAAK,CACbH,MAAO,qBAETF,OAAQ,IAAIC,EAAAA,EAAO,CACjBC,MAAO,mBACPC,MAAO,IAETK,OAAQ,MAIf,CAEDmB,iBACE,MAAO,CACL,IAAI5B,EAAAA,GAAM,CACRK,KAAM,IAAIC,EAAAA,EAAK,CACbH,MAAO,6BAETF,OAAQ,IAAIC,EAAAA,EAAO,CACjBC,MAAO,qBACPC,MAAO,IAETG,MAAO,IAAIC,EAAAA,EAAO,CAChBC,OAAQ,EACRJ,KAAM,IAAIC,EAAAA,EAAK,CACbH,MAAO,uBAETF,OAAQ,IAAIC,EAAAA,EAAO,CACjBC,MAAO,2BACPC,MAAO,QAKhB,CAEDyB,sBACkBtJ,KAAKU,IAClBwD,YACAC,WACAqC,QACErF,GAAUA,EAAMoI,gBAAgBC,UAAYxJ,KAAKwB,WAAWgI,UAGvD9C,SAAS+C,IACjB,GAAIA,EAASnF,UAAW,CACtB,IAAIoF,EAAID,EAASnF,YAIjB,GAHIoF,EAAEC,OACJD,EAAEC,QAEAD,EAAEnF,UAAW,CACf,IAAIC,EAASkF,EAAEnF,YACfC,EAAOoF,GAAI,IAAI3H,MAAO4H,kBACtBH,EAAE7E,aAAaL,EAChB,CACGkF,EAAE9E,SACJ8E,EAAE9E,SAEL,IAEJ,CAED/C,SAAS5B,GACPD,KAAKgE,OAAS/D,EACdD,KAAKyB,OAAQ,EACbzB,KAAKiB,aAAe,IAAI6I,EAAAA,EAAa,CACnCC,SAAUC,EAAAA,GACVvG,WAAYzD,KAAKgE,OAAOP,aAG1BzD,KAAKmB,MAAQ,IAAI8I,EAAAA,EAAO,CACtBC,UAAW,SACXC,OAAQ,IACR5J,KAAM,kBACNiJ,QAAS,kBACTxF,OAAQhE,KAAKiB,aACbmJ,MAAOpK,KAAK8I,mBAGV9I,KAAKmB,OACPnB,KAAKU,IAAI2J,YAAYrK,KAAKmB,OAG5BnB,KAAKU,IAAI4J,SAAStK,KAAKmB,OACvBnB,KAAKwB,WAAaxB,KAAKgE,OACvBhE,KAAKuB,YAAc,KACnBvB,KAAKW,SAAS4J,QAAQ,aAAcvK,KAAKgE,QACzChE,KAAKW,SAAS4J,QAAQ,cAAe,MACrCvK,KAAKW,SAAS4J,QAAQ,eAAgBvK,KAAKmB,MAC5C,CAEDqJ,YAAYC,GACVzK,KAAK0K,KAAO,IAAIC,EAAAA,GAAK,CACnB3G,OAAQhE,KAAKiB,aACbmJ,MAAOpK,KAAKqJ,iBACZuB,KAAMH,EACN9I,aAAc3B,KAAK2B,eAGrB3B,KAAK0K,KAAKG,GAAG,WAAYC,IAGlB9K,KAAK4B,KACR5B,KAAKiB,aAAa0I,QAEpBmB,EAAMtD,QAAQf,aAAe,OAA7B,IAEFzG,KAAKU,IAAIqK,eAAe/K,KAAK0K,MAC7B1K,KAAKU,IAAIsK,UAAUC,IAAI,YACxB,CAEDC,oBAAoBN,EAAMH,GACX,QAATG,GACF5K,KAAKwK,YAAYC,GAEN,SAATG,GACF5K,KAAKmL,eAEM,WAATP,GACF5K,KAAKoL,iBAEM,WAATR,IACF5K,KAAKU,IAAIsK,UAAUC,IAAI,aACvBjL,KAAKqL,kBAEPrL,KAAKU,IAAI4K,WAAWL,IAAI,YACzB,CAEDM,wBACEvL,KAAKU,IAAI4K,WAAWE,OAAO,aACvBxL,KAAKoB,QACPpB,KAAKU,IAAI+K,kBAAkBzL,KAAKoB,QAE9BpB,KAAKqB,QACPrB,KAAKU,IAAI+K,kBAAkBzL,KAAKqB,QAE9BrB,KAAK0K,MACP1K,KAAKU,IAAI+K,kBAAkBzL,KAAK0K,MAE9B1K,KAAK0L,MACP1L,KAAKU,IAAI+K,kBAAkBzL,KAAK0L,MAE9B1L,KAAK2L,MACP3L,KAAKU,IAAI+K,kBAAkBzL,KAAK2L,MAE9B3L,KAAK4L,SACP5L,KAAK4L,QAAS,EACd5L,KAAKU,IAAIsK,UAAUQ,OAAO,aAE1BxL,KAAKU,IAAImL,GAAG,cAAe7L,KAAK8L,gBAEnC,CAEDC,QACM/L,KAAKiB,cACPjB,KAAKiB,aAAa0I,QAEpB3J,KAAKU,IAAIsK,UAAUQ,OAAO,aAE1BxL,KAAKuL,wBACLvL,KAAKD,0BACLC,KAAKW,SAAS4J,QAAQ,QACvB,CAEDyB,aACEhM,KAAK+L,QACL/L,KAAKW,SAAS4J,QAAQ,cAAevK,KAAKuB,aAC1CvB,KAAKW,SAAS4J,QAAQ,aAAcvK,KAAKwB,YACzCxB,KAAKW,SAAS4J,QAAQ,aACvB,CAED0B,aACE,OAAOjM,KAAKgB,QAAQwF,QAAQxC,GACnBhE,KAAKa,eAAeqL,MAAMnL,GAAcA,IAAciD,EAAOmI,MAEvE,E","sources":["plugins/Collector/CollectorModel.js"],"sourcesContent":["import { WFS } from \"ol/format\";\nimport { Style, Stroke, Fill, Circle, RegularShape, Icon } from \"ol/style\";\nimport { MultiPoint, Polygon } from \"ol/geom\";\nimport Feature from \"ol/Feature\";\nimport Vector from \"ol/layer/Vector\";\nimport VectorSource from \"ol/source/Vector\";\nimport { all as strategyAll } from \"ol/loadingstrategy\";\nimport { Draw } from \"ol/interaction\";\nimport X2JS from \"x2js\";\nimport { hfetch } from \"utils/FetchWrapper\";\n\nclass CollectorModel {\n  constructor(settings) {\n    this.app = settings.app;\n    this.map = settings.map;\n    this.observer = settings.observer;\n    this.globalObserver = settings.globalObserver;\n    this.activeServices = [settings.options.serviceId];\n    this.sources = [settings.options.serviceConfig];\n    this.vectorSource = undefined;\n    this.layer = undefined;\n    this.select = undefined;\n    this.modify = undefined;\n    this.key = undefined;\n    this.editFeature = undefined;\n    this.editSource = undefined;\n    this.filty = false;\n    this.saving = false;\n    this.geometryName = \"geom\";\n    this.wkt = settings.options.wkt ?? false;\n    this.serviceConfig = settings.options.serviceConfig;\n    if (this.serviceConfig) {\n      this.setFormValuesFromConfig();\n      this.setLayer(settings.options.serviceConfig);\n    } else {\n      console.warn(\"Edit service is missing or not properly configured.\");\n    }\n  }\n\n  setFormValuesFromConfig = () => {\n    if (this.serviceConfig) {\n      this.formValues = this.serviceConfig.editableFields.reduce(\n        (obj, field) => {\n          obj[field.name] = this.valueByDataType(field);\n          return obj;\n        },\n        {}\n      );\n    } else {\n      this.formValues = {};\n    }\n  };\n\n  valueByDataType(field) {\n    switch (field.dataType) {\n      case \"date-time\":\n        return new Date().getTime();\n      case \"int\":\n      case \"number\":\n        return 0;\n      case \"string\":\n        if (field.textType === \"flerval\") {\n          return field.values.map((f) => ({ checked: false, value: f }));\n        }\n        return \"\";\n      default:\n        return \"\";\n    }\n  }\n\n  write(features) {\n    var format = new WFS(),\n      lr = this.editSource.layers[0].split(\":\"),\n      fp = lr.length === 2 ? lr[0] : \"\",\n      ft = lr.length === 2 ? lr[1] : lr[0],\n      options = {\n        featureNS: this.editSource.uri,\n        featurePrefix: fp,\n        featureType: ft,\n        hasZ: false,\n        version: \"1.1.0\", // or \"1.0.0\"\n        srsName: this.editSource.projection,\n      };\n\n    return format.writeTransaction(\n      features.inserts,\n      features.updates,\n      features.deletes,\n      options\n    );\n  }\n\n  refreshLayer(layerName) {\n    var source,\n      foundLayer = this.map\n        .getLayers()\n        .getArray()\n        .find((layer) => {\n          var match = false;\n          if (layer.getSource().getParams) {\n            let params = layer.getSource().getParams();\n            if (typeof params === \"object\") {\n              let paramName = params.LAYERS.split(\":\");\n              let layerSplit = layerName.split(\":\");\n              if (paramName.length === 2 && layerSplit.length === 2) {\n                match = layerName === params.LAYERS;\n              }\n              if (paramName.length === 1) {\n                match = layerSplit[1] === params.LAYERS;\n              }\n            }\n          }\n          return match;\n        });\n\n    if (foundLayer) {\n      source = foundLayer.getSource();\n      source.changed();\n      source.updateParams({ time: Date.now() });\n      this.map.updateSize();\n    }\n  }\n\n  parseWFSTresponse(response) {\n    var str =\n      typeof response !== \"string\"\n        ? new XMLSerializer().serializeToString(response)\n        : response;\n    return new X2JS().xml2js(str);\n  }\n\n  transact(features, done) {\n    var node = this.write(features),\n      serializer = new XMLSerializer(),\n      src = this.editSource,\n      payload = node ? serializer.serializeToString(node) : undefined;\n\n    if (payload && this.saving === false) {\n      this.saving = true;\n      hfetch(src.url, {\n        method: \"POST\",\n        body: payload,\n        credentials: \"same-origin\",\n        headers: {\n          \"Content-Type\": \"text/xml\",\n        },\n      })\n        .then((response) => {\n          this.saving = false;\n          response.text().then((wfsResponseText) => {\n            this.refreshLayer(src.layers[0]);\n            this.vectorSource\n              .getFeatures()\n              .filter((f) => f.modification !== undefined)\n              .forEach((f) => (f.modification = undefined));\n            done(this.parseWFSTresponse(wfsResponseText));\n          });\n        })\n        .catch((response) => {\n          this.saving = false;\n          response.text().then((errorMessage) => {\n            done(errorMessage);\n          });\n        });\n    }\n  }\n\n  save(done) {\n    var inserts = this.vectorSource.getFeatures();\n    const formValues = { ...this.formValues };\n    Object.keys(formValues).forEach((key) => {\n      if (Array.isArray(formValues[key])) {\n        formValues[key] = formValues[key]\n          .filter((v) => v.checked)\n          .map((v) => v.value)\n          .join(\", \");\n      }\n    });\n\n    if (inserts.length === 0) {\n      inserts.push(new Feature());\n    }\n\n    if (inserts.length > 0) {\n      inserts[0].setProperties(formValues);\n      this.transact({ inserts: inserts }, done);\n    }\n  }\n\n  getSelectStyle(feature) {\n    return [\n      new Style({\n        stroke: new Stroke({\n          color: \"rgba(0, 255, 255, 1)\",\n          width: 3,\n        }),\n        fill: new Fill({\n          color: \"rgba(0, 0, 0, 0.5)\",\n        }),\n        image: new Circle({\n          fill: new Fill({\n            color: \"rgba(0, 0, 0, 0.5)\",\n          }),\n          stroke: new Stroke({\n            color: \"rgba(0, 255, 255, 1)\",\n            width: 2,\n          }),\n          radius: 3,\n        }),\n      }),\n      new Style({\n        image: new RegularShape({\n          fill: new Fill({\n            color: \"rgba(0, 0, 0, 0.2)\",\n          }),\n          stroke: new Stroke({\n            color: \"rgba(0, 0, 0, 1)\",\n            width: 2,\n          }),\n          points: 4,\n          radius: 8,\n          angle: Math.PI / 4,\n        }),\n        geometry: (feature) => {\n          var coordinates =\n            feature.getGeometry() instanceof Polygon\n              ? feature.getGeometry().getCoordinates()[0]\n              : feature.getGeometry().getCoordinates();\n          return new MultiPoint(coordinates);\n        },\n      }),\n    ];\n  }\n\n  getVectorStyle(feature) {\n    return [\n      new Style({\n        stroke: new Stroke({\n          color: \"rgba(255, 165, 20, 1)\",\n          width: 3,\n        }),\n        fill: new Fill({\n          color: \"rgba(255, 165, 20, 0.5)\",\n        }),\n        image: new Icon({\n          scale: 1 / 2,\n          anchor: [0.5, 1],\n          anchorXUnits: \"fraction\",\n          anchorYUnits: \"fraction\",\n          src: \"marker_x2.png\",\n        }),\n      }),\n    ];\n  }\n\n  getHiddenStyle(feature) {\n    return [\n      new Style({\n        stroke: new Stroke({\n          color: \"rgba(0, 0, 0, 0)\",\n          width: 0,\n        }),\n        fill: new Fill({\n          color: \"rgba(1, 2, 3, 0)\",\n        }),\n        image: new Circle({\n          fill: new Fill({\n            color: \"rgba(0, 0, 0, 0)\",\n          }),\n          stroke: new Stroke({\n            color: \"rgba(0, 0, 0, 0)\",\n            width: 0,\n          }),\n          radius: 0,\n        }),\n      }),\n    ];\n  }\n\n  getSketchStyle() {\n    return [\n      new Style({\n        fill: new Fill({\n          color: \"rgba(255, 255, 255, 0.5)\",\n        }),\n        stroke: new Stroke({\n          color: \"rgba(0, 0, 0, 0.5)\",\n          width: 4,\n        }),\n        image: new Circle({\n          radius: 6,\n          fill: new Fill({\n            color: \"rgba(0, 0, 0, 0.5)\",\n          }),\n          stroke: new Stroke({\n            color: \"rgba(255, 255, 255, 0.5)\",\n            width: 2,\n          }),\n        }),\n      }),\n    ];\n  }\n\n  refreshEditingLayer() {\n    var mapLayers = this.map\n      .getLayers()\n      .getArray()\n      .filter(\n        (layer) => layer.getProperties().caption === this.editSource.caption\n      );\n\n    mapLayers.forEach((mapLayer) => {\n      if (mapLayer.getSource) {\n        let s = mapLayer.getSource();\n        if (s.clear) {\n          s.clear();\n        }\n        if (s.getParams) {\n          var params = s.getParams();\n          params.t = new Date().getMilliseconds();\n          s.updateParams(params);\n        }\n        if (s.changed) {\n          s.changed();\n        }\n      }\n    });\n  }\n\n  setLayer(serviceConfig) {\n    this.source = serviceConfig;\n    this.filty = true;\n    this.vectorSource = new VectorSource({\n      strategy: strategyAll,\n      projection: this.source.projection,\n    });\n\n    this.layer = new Vector({\n      layerType: \"system\",\n      zIndex: 5000,\n      name: \"pluginCollector\",\n      caption: \"Collector layer\",\n      source: this.vectorSource,\n      style: this.getVectorStyle(),\n    });\n\n    if (this.layer) {\n      this.map.removeLayer(this.layer);\n    }\n\n    this.map.addLayer(this.layer);\n    this.editSource = this.source;\n    this.editFeature = null;\n    this.observer.publish(\"editSource\", this.source);\n    this.observer.publish(\"editFeature\", null);\n    this.observer.publish(\"layerChanged\", this.layer);\n  }\n\n  activateAdd(geometryType) {\n    this.draw = new Draw({\n      source: this.vectorSource,\n      style: this.getSketchStyle(),\n      type: geometryType,\n      geometryName: this.geometryName,\n    });\n\n    this.draw.on(\"drawend\", (event) => {\n      // WKT supports insertion of multiple features and clear should therefore\n      // not be executed in this case\n      if (!this.wkt) {\n        this.vectorSource.clear();\n      }\n      event.feature.modification = \"added\";\n    });\n    this.map.addInteraction(this.draw);\n    this.map.clickLock.add(\"collector\");\n  }\n\n  activateInteraction(type, geometryType) {\n    if (type === \"add\") {\n      this.activateAdd(geometryType);\n    }\n    if (type === \"move\") {\n      this.activateMove();\n    }\n    if (type === \"modify\") {\n      this.activateModify();\n    }\n    if (type === \"remove\") {\n      this.map.clickLock.add(\"collector\");\n      this.activateRemove();\n    }\n    this.map.snapHelper.add(\"collector\");\n  }\n\n  deactivateInteraction() {\n    this.map.snapHelper.delete(\"collector\");\n    if (this.select) {\n      this.map.removeInteraction(this.select);\n    }\n    if (this.modify) {\n      this.map.removeInteraction(this.modify);\n    }\n    if (this.draw) {\n      this.map.removeInteraction(this.draw);\n    }\n    if (this.move) {\n      this.map.removeInteraction(this.move);\n    }\n    if (this.snap) {\n      this.map.removeInteraction(this.snap);\n    }\n    if (this.remove) {\n      this.remove = false;\n      this.map.clickLock.delete(\"collector\");\n\n      this.map.un(\"singleclick\", this.removeSelected);\n    }\n  }\n\n  reset() {\n    if (this.vectorSource) {\n      this.vectorSource.clear();\n    }\n    this.map.clickLock.delete(\"collector\");\n\n    this.deactivateInteraction();\n    this.setFormValuesFromConfig();\n    this.observer.publish(\"reset\");\n  }\n\n  deactivate() {\n    this.reset();\n    this.observer.publish(\"editFeature\", this.editFeature);\n    this.observer.publish(\"editSource\", this.editSource);\n    this.observer.publish(\"deactivate\");\n  }\n\n  getSources() {\n    return this.sources.filter((source) => {\n      return this.activeServices.some((serviceId) => serviceId === source.id);\n    });\n  }\n}\n\nexport default CollectorModel;\n"],"names":["constructor","settings","setFormValuesFromConfig","this","serviceConfig","formValues","editableFields","reduce","obj","field","name","valueByDataType","app","map","observer","globalObserver","activeServices","options","serviceId","sources","vectorSource","undefined","layer","select","modify","key","editFeature","editSource","filty","saving","geometryName","wkt","setLayer","console","warn","dataType","Date","getTime","textType","values","f","checked","value","write","features","format","WFS","lr","layers","split","fp","length","ft","featureNS","uri","featurePrefix","featureType","hasZ","version","srsName","projection","writeTransaction","inserts","updates","deletes","refreshLayer","layerName","source","foundLayer","getLayers","getArray","find","match","getSource","getParams","params","paramName","LAYERS","layerSplit","changed","updateParams","time","now","updateSize","parseWFSTresponse","response","str","XMLSerializer","serializeToString","X2JS","xml2js","transact","done","node","serializer","src","payload","hfetch","url","method","body","credentials","headers","then","text","wfsResponseText","getFeatures","filter","modification","forEach","catch","errorMessage","save","Object","keys","Array","isArray","v","join","push","Feature","setProperties","getSelectStyle","feature","Style","stroke","Stroke","color","width","fill","Fill","image","Circle","radius","RegularShape","points","angle","Math","PI","geometry","coordinates","getGeometry","Polygon","getCoordinates","MultiPoint","getVectorStyle","Icon","scale","anchor","anchorXUnits","anchorYUnits","getHiddenStyle","getSketchStyle","refreshEditingLayer","getProperties","caption","mapLayer","s","clear","t","getMilliseconds","VectorSource","strategy","strategyAll","Vector","layerType","zIndex","style","removeLayer","addLayer","publish","activateAdd","geometryType","draw","Draw","type","on","event","addInteraction","clickLock","add","activateInteraction","activateMove","activateModify","activateRemove","snapHelper","deactivateInteraction","delete","removeInteraction","move","snap","remove","un","removeSelected","reset","deactivate","getSources","some","id"],"sourceRoot":""}