"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[9008,9044],{49008:(e,t,s)=>{s.r(t);var r=s(72791),i=s(54164),a=s(66934),n=s(84395),o=s(39124),p=s(43896),l=s(15080),h=s(57816),d=s(29044),c=s(92171),u=s(80184);const m=(0,a.ZP)("div")((()=>({margin:-10}))),y=(0,a.ZP)(n.Z)((()=>({top:-10}))),b=(0,a.ZP)("div")((()=>({padding:10})));class g extends r.PureComponent{constructor(e){var t;super(e),t=this,this.handleChangeTabs=(e,t)=>{this.setState({activeTab:t})},this.handleTabsMounted=e=>{setTimeout((()=>{null!==e&&e.updateIndicator()}),1)},this.renderLayerGroups=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return(0,u.jsx)("div",{style:{display:!0===e?"block":"none"},children:t.options.groups.map(((e,s)=>(0,u.jsx)(h.default,{group:e,model:t.props.model,chapters:t.state.chapters,app:t.props.app,options:t.props.options},s)))})},this.renderBreadCrumbs=()=>this.options.showBreadcrumbs&&(0,i.createPortal)((0,u.jsx)("div",{onMouseDown:e=>e.stopPropagation(),children:(0,u.jsx)(d.default,{map:this.props.map,model:this.props.model,app:this.props.app})}),document.getElementById("breadcrumbs-container")),this.options=e.options,this.state={chapters:[],baseLayers:e.model.getBaseLayers(),activeTab:0},e.app.globalObserver.subscribe("informativeLoaded",(e=>{Array.isArray(e)&&this.setState({chapters:e})}))}render(){const{windowVisible:e}=this.props;return(0,u.jsxs)(m,{sx:{display:e?"block":"none"},children:[(0,u.jsx)(y,{position:"sticky",color:"default",children:(0,u.jsxs)(o.Z,{action:this.handleTabsMounted,onChange:this.handleChangeTabs,value:!!e&&this.state.activeTab,variant:"fullWidth",textColor:"inherit",children:[(0,u.jsx)(p.Z,{label:"Kartlager"}),(0,u.jsx)(p.Z,{label:"Bakgrund"}),!0===this.options.showActiveLayersView&&(0,u.jsx)(p.Z,{label:"Aktiva lager"})]})}),(0,u.jsxs)(b,{children:[this.renderLayerGroups(0===this.state.activeTab),(0,u.jsx)(l.default,{display:1===this.state.activeTab,layers:this.state.baseLayers,layerMap:this.props.model.layerMap,backgroundSwitcherBlack:this.options.backgroundSwitcherBlack,backgroundSwitcherWhite:this.options.backgroundSwitcherWhite,enableOSM:this.options.enableOSM,map:this.props.map,app:this.props.app}),!0===this.options.showActiveLayersView&&2===this.state.activeTab&&(0,u.jsx)(c.default,{map:this.props.map,app:this.props.app})]}),this.renderBreadCrumbs()]})}}t.default=g},15080:(e,t,s)=>{s.r(t);var r=s(72791),i=s(10736),a=s(36192),n=s(57707),o=s(74390),p=s(85194),l=s.n(p),h=s(68870),d=s(80184);const c="-1",u="-2",m="-3",y={[c]:"#fff",[u]:"#000"};class b extends r.PureComponent{constructor(e){super(e),this.state={selectedLayerId:null},this.isSpecialBackgroundLayer=e=>[c,u,m].includes(e),this.setSpecialBackground=e=>{document.getElementById("map").style.backgroundColor=y[e]},this.onChange=e=>{const t=e.target.value,{selectedLayerId:s}=this.state,{layerMap:r}=this.props;this.isSpecialBackgroundLayer(t)?this.setSpecialBackground(t):r[t].setVisible(!0),!this.isSpecialBackgroundLayer(s)&&r[s].setVisible(!1),this.osmLayer&&this.osmLayer.setVisible(t===m),this.setState({selectedLayerId:t})},this.localObserver=l()(),e.enableOSM&&(this.osmSource=new a.Z({reprojectionErrorThreshold:5}),this.osmLayer=new n.Z({visible:!1,source:this.osmSource,zIndex:-1,layerType:"base",name:"osm-layer",caption:"OpenStreetMap",layerInfo:{caption:"OpenStreetMap",layerType:"base"}}))}componentDidMount(){const e=this.props.layers.find((e=>e.visible));e&&this.setState({selectedLayerId:e.name}),this.props.enableOSM&&this.props.map.addLayer(this.osmLayer),this.props.app.globalObserver.subscribe("core.layerVisibilityChanged",(e=>{let{target:t}=e;const s=t.get("name");-1!==this.props.layers.findIndex((e=>s===e.name))&&!1!==t.get("visible")&&this.setState({selectedLayerId:t.get("name")})}))}renderRadioButton(e,t){const s=this.state.selectedLayerId===e.name;let r=this.props.layerMap[e.name];return e.name===m&&(r=this.osmLayer,r.set("foo","bar")),r||(r={isFakeMapLayer:!0,properties:{name:e.name,visible:s,layerInfo:{caption:e.caption,name:e.name,layerType:"base"},opacity:1},get(e){return this.properties[e]},set(e,t){this.properties[e]=t},getProperties(){return Object.keys(this.properties)}}),r.localObserver=this.localObserver,(0,d.jsx)(o.default,{layer:r,model:this.props.model,options:this.props.options,app:this.props.app},t)}renderBaseLayerComponents(){const{backgroundSwitcherWhite:e,backgroundSwitcherBlack:t,enableOSM:s}=this.props;let r=[],a=[];return e&&a.push(this.renderRadioButton({name:c,caption:"Vit"},Number(c))),t&&a.push(this.renderRadioButton({name:u,caption:"Svart"},Number(u))),s&&a.push(this.renderRadioButton({name:m,caption:"OpenStreetMap"},Number(m))),r=[...a,...this.props.layers.filter((e=>{const t=(0,i.isValidLayerId)(e.name);return t||console.warn("Backgroundlayer with id ".concat(e.name," has a non-valid id")),t})).map(((e,t)=>this.renderRadioButton(e,t)))],r}render(){return(0,d.jsx)(h.Z,{sx:{display:this.props.display?"block":"none"},children:this.renderBaseLayerComponents()})}}t.default=b},3190:(e,t,s)=>{s.r(t);var r=s(72791),i=s(29823),a=s(3746),n=s(20165),o=s(5536),p=s(35527),l=s(61889),h=s(24518),d=s(13400),c=s(20890),u=s(42618),m=s(66934),y=s(15473),b=s(80184);const g=(0,m.ZP)(p.Z)((e=>{let{theme:t}=e;return{marginRight:t.spacing(.5),border:"".concat(t.spacing(.1)," solid ").concat(t.palette.divider)}})),v=(0,m.ZP)(l.ZP)((e=>{let{theme:t}=e;return{padding:t.spacing(1)}})),f=(0,m.ZP)(l.ZP)((e=>{let{theme:t}=e;return{paddingLeft:t.spacing(.5)}})),x=(0,m.ZP)("div")((e=>{let{theme:t}=e;return{padding:t.spacing(.5)}}));class j extends r.Component{constructor(e){super(e),this.setHidden=e=>{var t=e.target.getOpacity();this.setState({hidden:0===t})},this.setLayerOpacity=e=>t=>{this.setState({hidden:!this.state.hidden},(()=>{e.setOpacity(this.state.hidden?0:1)}))},this.setLayerVisibility=e=>t=>{e.get("visible")&&(e.setOpacity(1),this.props.app.globalObserver.publish("layerswitcher.hideLayer",e)),e.set("visible",!e.get("visible"))},this.openInformative=e=>{this.props.app.windows.find((e=>"informative"===e.type)).props.custom.open(e)},this.handleClose=()=>{this.setState({anchorEl:null,popoverOpen:!1})},this.state={hidden:0===e.layer.getOpacity(),anchorEl:null,popoverOpen:!1},this.chapters=this.findChapters(this.props.layer.get("name"),this.props.chapters)}componentDidMount(){this.props.layer.on("change:opacity",this.setHidden)}componentWillUnmount(){this.props.layer.un("change:opacity",this.setHidden)}isOverflow(e){if(!e)return!1;let t=e.scrollLeft++;return e.scrollLeft-- >t}findChapters(e,t){return t?t.reduce(((t,s)=>(Array.isArray(s.layers)&&(s.layers.some((t=>t===e))&&(t=[...t,s]),s.chapters.length>0&&(t=[...t,...this.findChapters(e,s.chapters)])),t)),[]):[]}renderChapterLinks(){return this.chapters&&this.chapters.length>0&&this.chapters.length>0?(0,b.jsx)(x,{children:this.chapters.map(((e,t)=>(0,b.jsx)("div",{children:(0,b.jsxs)(h.Z,{size:"small",onClick:()=>{this.setState({popoverOpen:!1}),this.openInformative(e)},children:[e.header,(0,b.jsx)(u.Z,{})]})},t)))}):null}renderChaptersPopover(e){this.setState({anchorEl:e,popoverOpen:!0})}renderInformativeIcon(){return this.props.chapters&&this.chapters&&this.chapters.length>0?(0,b.jsx)(d.Z,{size:"small",onClick:e=>{1===this.chapters.length?this.openInformative(this.chapters[0]):this.renderChaptersPopover(e.target)},children:(0,b.jsx)(o.Z,{})}):null}render(){const{layer:e,title:t,type:s}=this.props,{hidden:r}=this.state;return(0,b.jsxs)(g,{square:"flat"===s,elevation:0,children:[(0,b.jsxs)(v,{container:!0,"data-type":"bread-crumb",justifyContent:"space-between",alignItems:"center",children:[(0,b.jsx)(l.ZP,{item:!0,children:(0,b.jsx)(d.Z,{size:"small",onClick:this.setLayerOpacity(e),"aria-label":"Visa/d\xf6lj lagret tillf\xe4lligt",children:r?(0,b.jsx)(n.Z,{}):(0,b.jsx)(a.Z,{})})}),this.renderInformativeIcon(),(0,b.jsx)(f,{item:!0,children:(0,b.jsx)(c.Z,{variant:"body2",noWrap:!0,children:t})}),(0,b.jsx)(l.ZP,{item:!0,children:(0,b.jsx)(d.Z,{size:"small",onClick:this.setLayerVisibility(e),"aria-label":"Verwijder de laag van de kaart",children:(0,b.jsx)(i.Z,{})})})]}),(0,b.jsx)(y.ZP,{id:"simple-popper",open:this.state.popoverOpen,anchorEl:this.state.anchorEl,onClose:this.handleClose,anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:this.renderChapterLinks()})]})}}t.default=j},29044:(e,t,s)=>{s.r(t);var r=s(66274),i=s(99359),a=s(72791),n=s(3190),o=s(66934),p=s(13967),l=s(95193),h=s(61889),d=s(94721),c=s(20890),u=s(24518),m=s(13400),y=s(68439),b=s(19924),g=s(20165),v=s(67728),f=s.n(v),x=s(80184);const j=(0,o.ZP)("div")((e=>{let{theme:t}=e;return{background:t.palette.background.paper,boxShadow:t.shadows[24],left:0,bottom:0,right:0,width:"auto",zIndex:2}})),L=(0,o.ZP)("div")((e=>{let{theme:t}=e;return{padding:"6px ".concat(t.spacing(2)),display:"flex",alignItems:"center",justifyContent:"space-between"}})),k=(0,o.ZP)("div")((e=>{let{theme:t}=e;return{maxHeight:"300px",overflow:"auto",[t.breakpoints.down("sm")]:{maxHeight:"110px"}}})),Z=(0,o.ZP)("div")((()=>({position:"absolute",left:0,right:0,bottom:0,zIndex:2}))),C=(0,o.ZP)("div")((e=>{let{theme:t}=e;return{width:"100%",paddingLeft:t.spacing(.5),paddingBottom:t.spacing(.5)}}));var S,w=(0,i.Z)("resetLayerBuffers");class B extends a.Component{constructor(e){super(e),Object.defineProperty(this,w,{writable:!0,value:()=>{this.addedLayerBuffer=[],this.removedLayerBuffer=[]}}),this.bindLayerEvents=e=>t=>{t.get("visible")&&e.push(t),this.setState({visibleLayers:e}),this.addedLayerBuffer=[],this.removedLayerBuffer=[],t.on("change:visible",(e=>{const t=e.target;clearTimeout(this.timer),this.timer=setTimeout((()=>{const e=[...this.state.visibleLayers,...this.addedLayerBuffer].filter((e=>!this.removedLayerBuffer.some((t=>e===t))));this.setState({visibleLayers:e}),(0,r.Z)(this,w)[w]()}),0),this.props.model.clearing?this.setState({visibleLayers:[]}):t.get("visible")?this.addedLayerBuffer.push(t):this.removedLayerBuffer.push(t)}))},this.clear=()=>{this.props.app.clear()},this.getBreadCrumbCompatibleLayers=()=>this.state.visibleLayers.filter((e=>["layer","group"].includes(e.get("layerType")))),this.toggle=()=>{this.setState({open:!this.state.open})},this.state={chapters:null,visibleLayers:[],open:!1},this.timer=null,e.app.globalObserver.subscribe("informativeLoaded",(e=>{this.setState({chapters:e})}))}getVisibleLayers(){return this.props.map.getLayers().getArray().filter((e=>e.getVisible()))}componentDidMount(){this.props.map&&this.props.map.getLayers().getArray().forEach(this.bindLayerEvents([]))}renderMobile(e){const{open:t}=this.state;return(0,x.jsxs)(j,{children:[(0,x.jsxs)(L,{children:[(0,x.jsx)(c.Z,{children:"Inneh\xe5ll i kartan"}),(0,x.jsx)(m.Z,{onClick:this.toggle,size:"small",children:t?(0,x.jsx)(b.Z,{}):(0,x.jsx)(y.Z,{})})]}),t&&(0,x.jsx)(d.Z,{}),t?(0,x.jsxs)(k,{children:[e.length>0?(0,x.jsx)(h.ZP,{container:!0,item:!0,xs:12,justifyContent:"center",sx:{marginTop:1,marginBottom:1},children:(0,x.jsxs)(u.Z,{variant:"contained",onClick:this.clear,children:["Verwijder alle inhoud",(0,x.jsx)(g.Z,{sx:{marginLeft:2}})]})}):(0,x.jsx)(c.Z,{children:"Anv\xe4nd s\xf6kfunktionen eller inneh\xe5llsmenyn f\xf6r att visa information i kartan."}),e.map(((e,t)=>(0,x.jsx)(C,{children:(0,x.jsx)(n.default,{title:e.get("caption"),layer:e,chapters:this.state.chapters,app:this.props.app})},"".concat(e.get("caption"),"-").concat(t))))]}):null]})}renderDesktop(e){const t=e.map(((e,t)=>(0,x.jsx)(n.default,{title:e.get("caption"),layer:e,chapters:this.state.chapters,app:this.props.app},"".concat(e.get("caption"),"-").concat(t))));return(0,x.jsx)(Z,{children:(0,x.jsx)(f(),{ref:"scrollMenu",data:t,alignCenter:!1})})}render(){const e=this.getBreadCrumbCompatibleLayers();return this.props.isMobile?e.length>0?this.renderMobile(e):null:this.renderDesktop(e)}}t.default=(S=B,e=>{const t=(0,p.Z)(),s=(0,l.Z)(t.breakpoints.down("sm"));return(0,x.jsx)(S,{...e,isMobile:s})})}}]);
//# sourceMappingURL=9008.dafb72c8.chunk.js.map