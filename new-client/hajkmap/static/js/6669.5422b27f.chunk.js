"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[6669],{28619:(t,e,i)=>{i.r(e);var s=i(72791),o=i(66934),n=i(57621),r=i(93044),a=i(66647),l=i(9585),d=i(80184);const c=(0,o.ZP)(n.Z)((t=>{let{theme:e}=t;return{marginBottom:e.spacing(1),width:"210px",[e.breakpoints.down("sm")]:{boxShadow:"none",borderBottom:"1px solid #ccc",borderRadius:0,margin:0,width:"100%",justifyContent:"left"}}})),h=(0,o.ZP)(r.Z)((t=>{let{theme:e}=t;return{background:e.palette.text.primary}}));class p extends s.PureComponent{constructor(){super(...arguments),this.state={open:!1,text:""}}render(){const{abstract:t,icon:e,onClick:i,title:s}=this.props;return(0,d.jsx)(c,{onClick:i,children:(0,d.jsx)(a.Z,{children:(0,d.jsx)(l.Z,{avatar:(0,d.jsx)(h,{children:e}),title:s,subheader:t})})})}}p.defaultProps={abstract:"Beskrivning saknas",title:"Titel saknas"},e.default=p},73151:(t,e,i)=>{i.r(e);var s=i(72791),o=i(85286),n=i(54164),r=i(19538),a=i(45484),l=i(57064),d=i(49900),c=i(26191),h=i(28619),p=i(74599),u=i(80184);class g extends s.PureComponent{constructor(t){var e;super(t),e=this,this.handleButtonClick=t=>{this.showWindow({hideOtherPluginWindows:!0,runCallback:!0}),this.props.app.globalObserver.publish("core.onlyHideDrawerIfNeeded")},this.showWindow=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=t.hideOtherPluginWindows||!0,s=t.runCallback||!0;if(e.props.app.activeTool=e.type,e.props.app.globalObserver.publish("analytics.trackEvent",{eventName:"pluginShown",pluginName:e.type,activeMap:e.props.app.config.activeMap}),e.props.app.pushPluginIntoHistory({type:e.type,icon:e.props.custom.icon,title:e.title,description:e.description}),!0===e.state.windowVisible)return null;!0===i&&e.props.app.onWindowOpen(e),e.setState({windowVisible:!0},(()=>{e.props.app.globalObserver.publish("core.pluginVisibilityChanged"),!0===s&&"function"===typeof e.props.custom.onWindowShow&&e.props.custom.onWindowShow()}))},this.closeWindow=()=>{this.type===this.props.app.activeTool&&(this.props.app.activeTool=void 0),this.setState({windowVisible:!1},(()=>{this.props.app.globalObserver.publish("core.pluginVisibilityChanged"),"function"===typeof this.props.custom.onWindowHide&&this.props.custom.onWindowHide()}))},this.type=t.type.toLowerCase()||void 0,this.description=t.options.description||t.custom.description;const i=!1===this.props.app.config.mapConfig.map.clean&&(o.isMobile?t.options.visibleAtStartMobile:t.options.visibleAtStart)||!1;i&&this.props.app.globalObserver.publish("analytics.trackEvent",{eventName:"pluginShown",pluginName:this.type,activeMap:this.props.app.config.activeMap}),this.state={title:t.options.title||t.custom.title||"Unnamed plugin",color:t.options.color||t.custom.color||null,windowVisible:i},this.title=t.options.title||t.custom.title||"Unnamed plugin",this.width=t.options.width||t.custom.width||400,this.height=t.options.height||t.custom.height||"auto",this.position=t.options.position||t.custom.position||"left",t.app.registerWindowPlugin(this);const s="".concat(this.type,".showWindow");t.app.globalObserver.subscribe(s,(t=>{this.showWindow(t)}));const n="".concat(this.type,".closeWindow");t.app.globalObserver.subscribe(n,(()=>{this.closeWindow()}))}componentDidUpdate(t){t.custom.title!==this.props.custom.title&&this.setState({title:this.props.custom.title}),t.custom.color!==this.props.custom.color&&this.setState({color:this.props.custom.color})}pluginIsWidget(t){return["left","right"].includes(t)}renderWindow(t){const{target:e}=this.props.options;return"function"===typeof(null===t||void 0===t?void 0:t.render)?t.render():(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(c.default,{globalObserver:this.props.app.globalObserver,title:this.state.title,color:this.state.color,onClose:this.closeWindow,open:this.state.windowVisible,onResize:this.props.custom.onResize,onMaximize:this.props.custom.onMaximize,onMinimize:this.props.custom.onMinimize,draggingEnabled:this.props.custom.draggingEnabled,customPanelHeaderButtons:this.props.custom.customPanelHeaderButtons,resizingEnabled:this.props.custom.resizingEnabled,scrollable:this.props.custom.scrollable,allowMaximizedWindow:this.props.custom.allowMaximizedWindow,disablePadding:this.props.custom.disablePadding,width:this.width,height:this.height,position:this.position,mode:"window",layerswitcherConfig:this.props.app.config.mapConfig.tools.find((t=>"layerswitcher"===t.type)),children:s.cloneElement(this.props.children,{windowVisible:this.state.windowVisible})}),"hidden"!==e&&this.renderDrawerButton(),this.pluginIsWidget(e)&&this.renderWidgetButton("".concat(e,"-column")),"control"===e&&this.renderControlButton()]})}renderDrawerButton(){return(0,n.createPortal)((0,u.jsx)(r.Z,{mdUp:this.pluginIsWidget(this.props.options.target)||"control"===this.props.options.target,children:(0,u.jsxs)(a.ZP,{button:!0,divider:!0,selected:this.state.windowVisible,onClick:this.handleButtonClick,children:[(0,u.jsx)(l.Z,{children:this.props.custom.icon}),(0,u.jsx)(d.Z,{primary:this.title})]})}),document.getElementById("plugin-buttons"))}renderWidgetButton(t){return(0,n.createPortal)((0,u.jsx)(r.Z,{mdDown:!0,children:(0,u.jsx)(h.default,{icon:this.props.custom.icon,onClick:this.handleButtonClick,title:this.title,abstract:this.description})}),document.getElementById(t))}renderControlButton(){return(0,n.createPortal)((0,u.jsx)(r.Z,{mdDown:!0,children:(0,u.jsx)(p.default,{icon:this.props.custom.icon,onClick:this.handleButtonClick,title:this.title,abstract:this.description})}),document.getElementById("plugin-control-buttons"))}render(){return!0!==this.props.app.config.mapConfig.map.clean&&this.renderWindow(this.props.custom)}}e.default=g},66669:(t,e,i)=>{i.r(e);var s=i(72791),o=i(73151),n=i(13684),r=i(77646),a=i(13016),l=i(85194),d=i.n(l),c=i(80184);class h extends s.PureComponent{constructor(t){super(t),this.localObserver=d()(),this.routingModel=new r.default({map:t.map,app:t.app,options:t.options,localObserver:this.localObserver})}render(){return(0,c.jsx)(o.default,{...this.props,type:"Routing",custom:{icon:(0,c.jsx)(n.Z,{}),title:"Navigation",description:"Hitta r\xe4tt v\xe4g till din destination",height:"auto",width:400},children:(0,c.jsx)(a.default,{model:this.routingModel,app:this.props.app,localObserver:this.localObserver})})}}e.default=h},77646:(t,e,i)=>{i.r(e);var s=i(64665),o=i(18029),n=i(90927),r=i(66233),a=i(5400),l=i(5426),d=i(9501),c=i(29409),h=i(62652),p=i(42708),u=i(67738);const g=i(96603);e.default=class{constructor(t){this.setTravelMode=t=>{this.travelMode=this.googleMapsApi.DirectionsTravelMode.hasOwnProperty(t)?this.googleMapsApi.DirectionsTravelMode[t]:"WALKING",this.travelModeLabel=this.travelModeLabels[this.travelMode],this.localObserver.publish("doneWithStep",3)},this.getCurrentPositionSuccess=t=>{this.position={latitude:t.coords.latitude,longitude:t.coords.longitude},this.setPosition()},this.getCurrentPositionError=t=>{console.error(t)},this.setPosition=()=>{if(this.layer_start.getSource().clear(),this.position.longitude&&this.position.latitude){var t=new c.Z([this.position.longitude,this.position.latitude]),e=(0,p.vs)(t.getCoordinates(),"EPSG:4326",this.olMap.getView().getProjection());t.setCoordinates(e);var i=new h.Z({geometry:t});i.setStyle(this.style_start),this.layer_start.getSource().addFeature(i),this.olMap.getView().setCenter(t.getCoordinates()),this.localObserver.publish("doneWithStep",1),this.localObserver.publish("startModeSelected","gps")}},this.getLocation=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(this.getCurrentPositionSuccess,this.getCurrentPositionError):window.alert("Kan inte f\xe5 position. Skriv startposition i rutan eller tryck position p\xe5 kartan.")},this.activateStartMode=()=>{this.olMap.once("singleclick",this.startPointSelection)},this.startPointSelection=t=>{var e=new h.Z;e.setGeometry(new c.Z(t.coordinate));var i=(0,p.vs)(e.getGeometry().getCoordinates(),this.projection,"EPSG:4326"),s=i[0],o=i[1];this.layer_start.getSource().clear(),this.layer_start.getSource().addFeature(e),e.setStyle(this.style_start);var n=this.position;n.latitude=o,n.longitude=s,this.position=n,this.localObserver.publish("doneWithStep",1),this.localObserver.publish("startModeSelected","manual")},this.activateEndMode=()=>{this.onEndKey=this.olMap.once("singleclick",this.endPointSelection)},this.endPointSelection=t=>{var e=new h.Z;e.setGeometry(new c.Z(t.coordinate));var i=(0,p.vs)(e.getGeometry().getCoordinates(),this.projection,"EPSG:4326"),s=i[0],o=i[1];this.layer_end.getSource().clear(),this.layer_end.getSource().addFeature(e),e.setStyle(this.style_end);var n=this.position;n.latitudeEnd=o,n.longitudeEnd=s,this.position=n,this.localObserver.publish("doneWithStep",2)},this.olMap=t.map,this.localObserver=t.localObserver,this.apiKey=t.options.apiKey,this.travelMode="WALKING",this.travelModeLabels={WALKING:"G\xe5",DRIVING:"K\xf6r",TRANSIT:"Kollektivtrafik",BICYCLING:"Cykla"},this.position={latitude:void 0,longitude:void 0,latitudeEnd:void 0,longitudeEnd:void 0},this.projection=t.app.config.mapConfig.map.projection,g({key:this.apiKey}).then((t=>{this.googleMapsApi=t})),this.initiateRoutingLayerInOpenLayersMap()}generatePinIcon(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000000",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"24";const i='<?xml version="1.0" encoding="UTF-8"?>\n    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"  width="'.concat(e,'" height="').concat(e,'" viewBox="0 0 ').concat(e," ").concat(e,'">\n    <path fill="').concat(t,'" d="M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z" />\n    </svg>');return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(i)}initiateRoutingLayerInOpenLayersMap(){this.style_start=new s.ZP({image:new o.Z({src:this.generatePinIcon("#00a83b","36")})}),this.style_end=new s.ZP({image:new o.Z({src:this.generatePinIcon("#ff4747")})}),this.style_route=new s.ZP({image:new o.Z({src:this.generatePinIcon("#6e6e6e")})}),this.style_route_normal=this.style_route,this.style_route_highlight=new s.ZP({image:new o.Z({src:this.generatePinIcon("#47ff87")})}),this.layer_drawing_style=new s.ZP({fill:new n.Z({color:"rgba(255, 255, 255, 0.5)"}),stroke:new r.Z({color:"rgba(0, 0, 255, 0.5)",width:4}),image:new a.Z({radius:6,fill:new n.Z({color:"rgba(0, 0, 0, 0.5)"}),stroke:new r.Z({color:"rgba(255, 255, 255, 0.5)",width:2})})});var t=new l.Z({}),e=new l.Z({}),i=new l.Z({}),c=new l.Z({});void 0===this.layer_start&&(this.layer_start=new d.Z({layerType:"system",zIndex:5e3,source:t,name:"pluginRoutingStart",content:"point",queryable:!1,style:this.style_start}),this.layer_end=new d.Z({layerType:"system",zIndex:5e3,source:e,name:"pluginRoutingEnd",content:"point",queryable:!1,style:this.style_end}),this.layer_route=new d.Z({layerType:"system",zIndex:5e3,source:i,name:"pluginRoutingRoute",content:"point",queryable:!0,style:this.style_route}),this.layer_drawing=new d.Z({layerType:"system",zIndex:5e3,source:c,name:"pluginRoutingDrawing",content:"line",queryable:!1,style:this.layer_drawing_style}),this.olMap.addLayer(this.layer_start),this.olMap.addLayer(this.layer_end),this.olMap.addLayer(this.layer_route),this.olMap.addLayer(this.layer_drawing))}activateRoutingMode(){this.searchTrip()}searchTrip(){var t=this.position;if(void 0===t.latitude||void 0===t.longitude||void 0===t.latitudeEnd||void 0===t.longitudeEnd)this.localObserver.publish("startStopPointsMissing");else{const e=new this.googleMapsApi.DirectionsService,i={origin:{lat:t.latitude,lng:t.longitude},destination:{lat:t.latitudeEnd,lng:t.longitudeEnd},travelMode:this.travelMode};e.route(i,(t=>{switch(t.status){case"REQUEST_DENIED":this.localObserver.publish("requestDenied");break;case"ZERO_RESULTS":this.localObserver.publish("zeroResults");break;case"OK":this.plotRoute(t,this.map,this.layer_route,this.layer_drawing);break;default:this.localObserver.publish("otherError",t.status)}}))}}plotRoute(t,e,i,s){i.getSource().clear();var o=t.routes[0].legs[0].steps;const n=document.createElement("div"),r=document.createElement("p"),a=document.createElement("ol");r.innerHTML='\n                    <table class="table table-condensed">\n                      <tbody>\n                        <tr><td><b>F\xe4rds\xe4tt</b></td><td>'.concat(this.travelModeLabel,"</td></tr>\n                        <tr><td><b>Avst\xe5nd</b></td><td>").concat(t.routes[0].legs[0].distance.text," (").concat(t.routes[0].legs[0].distance.value," m)</td></tr>\n                        <tr><td><b>Tid</b></td><td>").concat(t.routes[0].legs[0].duration.text,"</td></tr>\n                        <tr><td><b>Startadress</b></td><td>").concat(t.routes[0].legs[0].start_address,"</td></tr>\n                        <tr><td><b>Slutadress</b></td><td>").concat(t.routes[0].legs[0].end_address,"</td></tr>\n                      </tbody>\n                    </table>\n                    "),n.appendChild(r);for(var l=0;l<o.length;l++){var d=o[l].start_location.lat(),g=o[l].start_location.lng(),v=new c.Z([g,d]),b=(0,p.vs)(v.getCoordinates(),"EPSG:4326",this.projection);v.setCoordinates(b);var m=l+1,w=new h.Z({geometry:v,info:o[l].instructions});w.number=""+m,w.setStyle(this.style_route),i.getSource().addFeature(w);var y=document.createElement("li");y.onclick=this.highlightFeature.bind(this),y.id="step_number"+m,y.innerHTML=o[l].instructions,a.appendChild(y)}n.appendChild(a);for(var S=document.getElementById("resultList");S.firstChild;)S.removeChild(S.firstChild);document.getElementById("resultList").appendChild(n);const k=new u.ZP({}).readGeometry(t.routes[0].overview_polyline,{dataProjection:"EPSG:4326",featureProjection:this.projection});s.getSource().clear();var x=new h.Z({type:"routing",geometry:k});x.setStyle(this.layer_drawing_style),s.getSource().addFeature(x);var M=(this.position.latitude+this.position.latitudeEnd)/2,Z=(this.position.longitude+this.position.longitudeEnd)/2;this.olMap.getView().setCenter((0,p.vs)([Z,M],"EPSG:4326",this.projection)),this.olMap.getView().fit(s.getSource().getExtent(),this.olMap.getSize())}highlightFeature(t){var e=-1;e="B"===t.target.nodeName?t.target.parentNode.id.substring("step_number".length):t.target.id.substring("step_number".length);for(var i=this.layer_route.getSource().getFeatures(),s=0;s<i.length;s++)i[s].number===e?i[s].setStyle(this.style_route_highlight):i[s].setStyle(this.style_route_normal)}drawRoute(t){var e=new u.ZP({}).readGeometry(t),i=new h.Z({type:"routing",geometry:e});i.setStyle(this.style_route),this.get("layer_drawing").getSource().addFeature(i)}clearMap(){this.layer_start.getSource().clear(),this.layer_end.getSource().clear(),this.layer_route.getSource().clear(),this.layer_drawing.getSource().clear(),document.getElementById("resultList").innerHTML="",this.position={latitude:void 0,longitude:void 0,latitudeEnd:void 0,longitudeEnd:void 0}}}},13016:(t,e,i)=>{i.r(e);var s=i(72791),o=i(24518),n=i(70242),r=i(74512),a=i(15825),l=i(29145),d=i(68870),c=i(2199),h=i(90388),p=i(72466),u=i(48235),g=i(35465),v=i(88945),b=i(57670),m=i(63939),w=i(12017),y=i(98246),S=i(80184);class k extends s.PureComponent{constructor(t){super(),this.state={activeStep:0,startMode:void 0,endSelectionInProgress:!1,travelMode:void 0},this.selectStartSnackbar=void 0,this.selectEndSnackbar=void 0,this.handleTravelModeChange=(t,e)=>{this.setState({travelMode:e}),this.props.model.setTravelMode(e)},this.handleClickOnStartMode=(t,e)=>{switch(this.setState({startMode:void 0}),e){case"gps":this.props.model.getLocation();break;case"manual":this.selectStartSnackbar=this.props.enqueueSnackbar("Klicka i kartan f\xf6r att v\xe4lja startpunkt.",{variant:"info",persist:!0}),this.props.model.activateStartMode()}},this.handleClickOnEndSelection=()=>{!0!==this.state.endSelectionInProgress&&this.setState({endSelectionInProgress:!0},(t=>{this.selectEndSnackbar=this.props.enqueueSnackbar("Klicka i kartan f\xf6r att v\xe4lja din destination.",{variant:"info",persist:!0}),this.props.model.activateEndMode()}))},t.localObserver.subscribe("doneWithStep",(e=>{switch(e){case 1:this.selectStartSnackbar&&t.closeSnackbar(this.selectStartSnackbar),this.handleClickOnEndSelection();break;case 2:this.selectEndSnackbar&&t.closeSnackbar(this.selectEndSnackbar),this.setState({endSelectionInProgress:!1});break;case 3:t.model.activateRoutingMode()}this.setState({activeStep:e})})),t.localObserver.subscribe("startModeSelected",(t=>{this.setState({startMode:t})})),t.localObserver.subscribe("startStopPointsMissing",(()=>{this.props.enqueueSnackbar("V\xe4lj start- och stoppunkt f\xf6r att kunna navigera.",{variant:"error"})})),t.localObserver.subscribe("requestDenied",(()=>{this.props.enqueueSnackbar("Kunde inte navigera. Kontakta systemadministrat\xf6r och p\xe5tala att giltig licens f\xf6r Google Maps API saknas.",{variant:"error"})})),t.localObserver.subscribe("zeroResults",(()=>{this.props.enqueueSnackbar("Kunde inte hitta v\xe4gbeskrivning mellan valda punkter och f\xf6r det valda transportslaget. Prova att byta f\xe4rds\xe4tt och s\xf6k igen.",{variant:"warning"})})),t.localObserver.subscribe("otherError",(t=>{console.error(t),this.props.enqueueSnackbar("Ett fel har intr\xe4ffat. V\xe4nligen f\xf6rs\xf6k igen.",{variant:"warning"})}))}render(){return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(n.Z,{activeStep:this.state.activeStep,orientation:"vertical",sx:{padding:2},children:[(0,S.jsxs)(r.Z,{children:[(0,S.jsx)(a.Z,{children:"V\xe4lj startpunkt"}),(0,S.jsx)(l.Z,{children:(0,S.jsxs)(p.Z,{value:this.state.startMode,exclusive:!0,onChange:this.handleClickOnStartMode,size:"small",children:[(0,S.jsx)(h.Z,{value:"gps",children:"Min position"},1),(0,S.jsx)(h.Z,{value:"manual",children:"V\xe4lj i kartan"},2)]})})]},"pickStart"),(0,S.jsxs)(r.Z,{children:[(0,S.jsx)(a.Z,{children:"V\xe4lj destination"}),(0,S.jsx)(l.Z,{children:(0,S.jsx)(o.Z,{variant:"contained",onClick:this.handleClickOnEndSelection,disabled:!0===this.state.endSelectionInProgress,children:"V\xe4lj i kartan"})})]},"pickEnd"),(0,S.jsxs)(r.Z,{children:[(0,S.jsx)(a.Z,{children:"V\xe4lj f\xe4rds\xe4tt"}),(0,S.jsx)(l.Z,{children:(0,S.jsxs)(p.Z,{value:this.state.travelMode,exclusive:!0,onChange:this.handleTravelModeChange,children:[(0,S.jsx)(h.Z,{value:"WALKING",children:(0,S.jsx)(u.Z,{})},1),(0,S.jsx)(h.Z,{value:"DRIVING",children:(0,S.jsx)(g.Z,{})},2),(0,S.jsx)(h.Z,{value:"TRANSIT",children:(0,S.jsx)(b.Z,{})},3),(0,S.jsx)(h.Z,{value:"BICYCLING",children:(0,S.jsx)(v.Z,{})},4)]})})]},"pickTravelMode")]}),this.renderStepperButtons(),(0,S.jsx)(d.Z,{id:"resultList",sx:{padding:2}})]})}renderStepperButtons(){return(0,S.jsxs)(c.Z,{fullWidth:!0,sx:{padding:2},children:[(0,S.jsx)(o.Z,{sx:{marginRight:1},variant:"contained",disabled:0===this.state.activeStep,startIcon:(0,S.jsx)(w.Z,{}),onClick:()=>{this.setState({activeStep:this.state.activeStep-1})},children:"F\xf6reg\xe5ende"}),(0,S.jsx)(o.Z,{variant:"contained",startIcon:(0,S.jsx)(m.Z,{}),onClick:()=>{this.setState({activeStep:0,startMode:void 0,travelMode:void 0}),this.props.model.clearMap()},children:"Nollst\xe4ll"})]})}}e.default=(0,y.RM)(k)}}]);
//# sourceMappingURL=6669.5422b27f.chunk.js.map