"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[5215,4906],{28619:(e,t,i)=>{i.r(t);var o=i(72791),s=i(66934),r=i(57621),a=i(93044),n=i(66647),l=i(9585),d=i(80184);const c=(0,s.ZP)(r.Z)((e=>{let{theme:t}=e;return{marginBottom:t.spacing(1),width:"210px",[t.breakpoints.down("sm")]:{boxShadow:"none",borderBottom:"1px solid #ccc",borderRadius:0,margin:0,width:"100%",justifyContent:"left"}}})),h=(0,s.ZP)(a.Z)((e=>{let{theme:t}=e;return{background:t.palette.text.primary}}));class p extends o.PureComponent{constructor(){super(...arguments),this.state={open:!1,text:""}}render(){const{abstract:e,icon:t,onClick:i,title:o}=this.props;return(0,d.jsx)(c,{onClick:i,children:(0,d.jsx)(n.Z,{children:(0,d.jsx)(l.Z,{avatar:(0,d.jsx)(h,{children:t}),title:o,subheader:e})})})}}p.defaultProps={abstract:"Beskrivning saknas",title:"Titel saknas"},t.default=p},73151:(e,t,i)=>{i.r(t);var o=i(72791),s=i(85286),r=i(54164),a=i(19538),n=i(45484),l=i(57064),d=i(49900),c=i(26191),h=i(28619),p=i(74599),u=i(80184);class m extends o.PureComponent{constructor(e){var t;super(e),t=this,this.handleButtonClick=e=>{this.showWindow({hideOtherPluginWindows:!0,runCallback:!0}),this.props.app.globalObserver.publish("core.onlyHideDrawerIfNeeded")},this.showWindow=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=e.hideOtherPluginWindows||!0,o=e.runCallback||!0;if(t.props.app.activeTool=t.type,t.props.app.globalObserver.publish("analytics.trackEvent",{eventName:"pluginShown",pluginName:t.type,activeMap:t.props.app.config.activeMap}),t.props.app.pushPluginIntoHistory({type:t.type,icon:t.props.custom.icon,title:t.title,description:t.description}),!0===t.state.windowVisible)return null;!0===i&&t.props.app.onWindowOpen(t),t.setState({windowVisible:!0},(()=>{t.props.app.globalObserver.publish("core.pluginVisibilityChanged"),!0===o&&"function"===typeof t.props.custom.onWindowShow&&t.props.custom.onWindowShow()}))},this.closeWindow=()=>{this.type===this.props.app.activeTool&&(this.props.app.activeTool=void 0),this.setState({windowVisible:!1},(()=>{this.props.app.globalObserver.publish("core.pluginVisibilityChanged"),"function"===typeof this.props.custom.onWindowHide&&this.props.custom.onWindowHide()}))},this.type=e.type.toLowerCase()||void 0,this.description=e.options.description||e.custom.description;const i=!1===this.props.app.config.mapConfig.map.clean&&(s.isMobile?e.options.visibleAtStartMobile:e.options.visibleAtStart)||!1;i&&this.props.app.globalObserver.publish("analytics.trackEvent",{eventName:"pluginShown",pluginName:this.type,activeMap:this.props.app.config.activeMap}),this.state={title:e.options.title||e.custom.title||"Unnamed plugin",color:e.options.color||e.custom.color||null,windowVisible:i},this.title=e.options.title||e.custom.title||"Unnamed plugin",this.width=e.options.width||e.custom.width||400,this.height=e.options.height||e.custom.height||"auto",this.position=e.options.position||e.custom.position||"left",e.app.registerWindowPlugin(this);const o="".concat(this.type,".showWindow");e.app.globalObserver.subscribe(o,(e=>{this.showWindow(e)}));const r="".concat(this.type,".closeWindow");e.app.globalObserver.subscribe(r,(()=>{this.closeWindow()}))}componentDidUpdate(e){e.custom.title!==this.props.custom.title&&this.setState({title:this.props.custom.title}),e.custom.color!==this.props.custom.color&&this.setState({color:this.props.custom.color})}pluginIsWidget(e){return["left","right"].includes(e)}renderWindow(e){const{target:t}=this.props.options;return"function"===typeof(null===e||void 0===e?void 0:e.render)?e.render():(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(c.default,{globalObserver:this.props.app.globalObserver,title:this.state.title,color:this.state.color,onClose:this.closeWindow,open:this.state.windowVisible,onResize:this.props.custom.onResize,onMaximize:this.props.custom.onMaximize,onMinimize:this.props.custom.onMinimize,draggingEnabled:this.props.custom.draggingEnabled,customPanelHeaderButtons:this.props.custom.customPanelHeaderButtons,resizingEnabled:this.props.custom.resizingEnabled,scrollable:this.props.custom.scrollable,allowMaximizedWindow:this.props.custom.allowMaximizedWindow,disablePadding:this.props.custom.disablePadding,width:this.width,height:this.height,position:this.position,mode:"window",layerswitcherConfig:this.props.app.config.mapConfig.tools.find((e=>"layerswitcher"===e.type)),children:o.cloneElement(this.props.children,{windowVisible:this.state.windowVisible})}),"hidden"!==t&&this.renderDrawerButton(),this.pluginIsWidget(t)&&this.renderWidgetButton("".concat(t,"-column")),"control"===t&&this.renderControlButton()]})}renderDrawerButton(){return(0,r.createPortal)((0,u.jsx)(a.Z,{mdUp:this.pluginIsWidget(this.props.options.target)||"control"===this.props.options.target,children:(0,u.jsxs)(n.ZP,{button:!0,divider:!0,selected:this.state.windowVisible,onClick:this.handleButtonClick,children:[(0,u.jsx)(l.Z,{children:this.props.custom.icon}),(0,u.jsx)(d.Z,{primary:this.title})]})}),document.getElementById("plugin-buttons"))}renderWidgetButton(e){return(0,r.createPortal)((0,u.jsx)(a.Z,{mdDown:!0,children:(0,u.jsx)(h.default,{icon:this.props.custom.icon,onClick:this.handleButtonClick,title:this.title,abstract:this.description})}),document.getElementById(e))}renderControlButton(){return(0,r.createPortal)((0,u.jsx)(a.Z,{mdDown:!0,children:(0,u.jsx)(p.default,{icon:this.props.custom.icon,onClick:this.handleButtonClick,title:this.title,abstract:this.description})}),document.getElementById("plugin-control-buttons"))}render(){return!0!==this.props.app.config.mapConfig.map.clean&&this.renderWindow(this.props.custom)}}t.default=m},75215:(e,t,i)=>{i.r(t);var o=i(72791),s=i(73151),r=i(34311),a=i(99900),n=i(64906),l=i(85194),d=i.n(l),c=i(80184);class h extends o.PureComponent{constructor(e){super(e),this.onWindowHide=()=>{this.localObserver.publish("resetView"),this.editModel.reset()},e.options.sources?console.log("Huh?"):console.log("F*ckin hell "+e.options.title),this.localObserver=d()(),this.editModel=new n.default({map:e.map,app:e.app,observer:this.localObserver,options:e.options})}render(){return(0,c.jsx)(s.default,{...this.props,type:"Edit",custom:{icon:(0,c.jsx)(r.Z,{}),title:"Redigera",description:"Redigera objekt i kartan (WFS)",height:500,width:500,top:void 0,left:void 0,onWindowHide:this.onWindowHide},children:(0,c.jsx)(a.default,{app:this.props.app,model:this.editModel,observer:this.localObserver})})}}t.default=h},64906:(e,t,i)=>{i.r(t);var o=i(63252),s=i(64665),r=i(66233),a=i(90927),n=i(5400),l=i(50315),d=i(56957),c=i(95881),h=i(9501),p=i(5426),u=i(28562),m=i(489),g=i(79717),w=i(56134),v=i(24673),b=i(2177),f=i(50007),y=i.n(f),S=i(25806);t.default=class{constructor(e){this.loadDataSuccess=e=>{var t,i=new o.Z;try{t=i.readFeatures(e)}catch(s){alert("Fel: data kan inte l\xe4sas in. Kontrollera koordinatsystem.")}this.geometryName=t.length>0?t[0].getGeometryName():"geom",this.editSource.editableFields.some((e=>e.hidden))&&(t=this.filterByDefaultValue(t)),this.vectorSource.addFeatures(t),this.vectorSource.getFeatures().forEach((e=>{e.on("propertychange",(t=>{"removed"!==e.modification&&"added"!==e.modification&&(e.modification="updated")})),e.on("change",(t=>{"removed"!==e.modification&&"added"!==e.modification&&(e.modification="updated")}))}))},this.removeSelected=e=>{this.map.forEachFeatureAtPixel(e.pixel,(e=>{this.vectorSource.getFeatures().some((t=>t===e))&&("added"===e.modification?e.modification=void 0:e.modification="removed",e.setStyle(this.getHiddenStyle()))}))},this.resetEditFeature=()=>{this.editFeatureBackup=this.editFeature,this.editFeature=void 0,this.observer.publish("editFeature",this.editFeature)},console.log("Hello from EditModel: "+e.options.title),this.map=e.map,this.app=e.app,this.observer=e.observer,this.options=e.options,this.activeServices=this.options.activeServices,this.sources=this.options.sources,this.vectorSource=void 0,this.layer=void 0,this.select=void 0,this.modify=void 0,this.key=void 0,this.editFeature=void 0,this.editFeatureBackup=void 0,this.editSource=void 0,this.removeFeature=void 0,this.shell=void 0,this.instruction="",this.filty=!1,this.removalToolMode="off",this.options.sources&&0!==this.options.sources.length?console.log("Blub"):(console.log("Fucking hell! Waarom?"),this.options.sources=[{id:"wat-een-ongelofelijke-klerezooi",url:"http://localhost:81/geoserver/workspace_datastore_ckan_dataplatform_sandbox/ckan_geboorde-putten/ows",layers:["workspace_datastore_ckan_dataplatform_sandbox:ckan_geboorde-putten"],projection:"EPSG:28992",caption:"Geboorde putten",uri:"http://www.opengis.net/wfs"}]),this.options.sources=this.options.sources.map((e=>{console.log("Godverdomme "+e.caption),0===e.uri.trim().length&&(e.uri="http://www.opengis.net/wfs");const t=new URL(e.url);return t.searchParams.delete("service"),e.url=t.href,e}))}write(e){var t=new o.Z,i=this.editSource.layers[0].split(":"),s=2===i.length?i[0]:"",r=2===i.length?i[1]:i[0],a={featureNS:this.editSource.uri,featurePrefix:s,featureType:r,hasZ:!1,version:"1.1.0",srsName:this.editSource.projection};return t.writeTransaction(e.inserts,e.updates,e.deletes,a)}refreshLayer(e){var t,i=this.map.getLayers().getArray().find((t=>{var i=!1;if(t.getSource().getParams){let o=t.getSource().getParams();if("object"===typeof o){let t=Array.isArray(o.LAYERS)?o.LAYERS[0].split(":"):o.LAYERS.split(":"),s=e.split(":");2===t.length&&2===s.length&&(i=e===o.LAYERS),1===t.length&&(i=s[1]===o.LAYERS)}}return i}));i&&((t=i.getSource()).changed(),t.updateParams({time:Date.now()}),this.map.updateSize())}parseWFSTresponse(e){var t="string"!==typeof e?(new XMLSerializer).serializeToString(e):e;return(new(y())).xml2js(t)}transact(e,t){var i=this.write(e),o=new XMLSerializer,s=this.editSource,r=i?o.serializeToString(i):void 0;r&&(0,S.hfetch)(s.url,{method:"POST",body:r,credentials:"same-origin",headers:{"Content-Type":"text/xml"}}).then((e=>{e.text().then((e=>{const i=this.parseWFSTresponse(e);i.ExceptionReport||!i.TransactionResponse||(this.refreshLayer(s.layers[0]),this.vectorSource.getFeatures().filter((e=>void 0!==e.modification)).forEach((e=>e.modification=void 0))),t(i)}))})).catch((e=>{e.text().then((e=>{t(e)}))}))}save(e){const t=e=>this.vectorSource.getFeatures().filter((t=>t.modification===e)),i={updates:t("updated").map((e=>(e.unset("boundedBy"),e))),inserts:t("added"),deletes:t("removed")};if(0===i.updates.length&&0===i.inserts.length&&0===i.deletes.length)return e();this.transact(i,e)}getSelectStyle(e){return[new s.ZP({stroke:new r.Z({color:"rgba(0, 255, 255, 1)",width:3}),fill:new a.Z({color:"rgba(0, 0, 0, 0.5)"}),image:new n.Z({fill:new a.Z({color:"rgba(0, 0, 0, 0.5)"}),stroke:new r.Z({color:"rgba(0, 255, 255, 1)",width:2}),radius:3})}),new s.ZP({image:new l.Z({fill:new a.Z({color:"rgba(0, 0, 0, 0.2)"}),stroke:new r.Z({color:"rgba(0, 0, 0, 1)",width:2}),points:4,radius:8,angle:Math.PI/4}),geometry:e=>{var t=e.getGeometry()instanceof d.ZP?e.getGeometry().getCoordinates()[0]:e.getGeometry().getCoordinates();return new c.Z(t)}})]}getVectorStyle(e){return[new s.ZP({stroke:new r.Z({color:"rgba(0, 0, 0, 1)",width:3}),fill:new a.Z({color:"rgba(0, 0, 0, 0.5)"}),image:new n.Z({fill:new a.Z({color:"rgba(0, 0, 0, 0.5)"}),stroke:new r.Z({color:"rgba(0, 0, 0, 1)",width:3}),radius:4})})]}getHiddenStyle(e){return[new s.ZP({stroke:new r.Z({color:"rgba(0, 0, 0, 0)",width:0}),fill:new a.Z({color:"rgba(1, 2, 3, 0)"}),image:new n.Z({fill:new a.Z({color:"rgba(0, 0, 0, 0)"}),stroke:new r.Z({color:"rgba(0, 0, 0, 0)",width:0}),radius:0})})]}getSketchStyle(){return[new s.ZP({fill:new a.Z({color:"rgba(255, 255, 255, 0.5)"}),stroke:new r.Z({color:"rgba(0, 0, 0, 0.5)",width:4}),image:new n.Z({radius:6,fill:new a.Z({color:"rgba(0, 0, 0, 0.5)"}),stroke:new r.Z({color:"rgba(255, 255, 255, 0.5)",width:2})})})]}filterByDefaultValue(e){return e.filter((e=>this.editSource.editableFields.some((t=>{var i=e.getProperties()[t.name];return!(!t.hidden||i!==t.defaultValue)}))))}loadData(e,t,i){const o=new URL(e.url),s={};for(const[n,l]of o.searchParams.entries())s[n.toUpperCase()]=l;const r={...s,SERVICE:"WFS",VERSION:"1.1.0",REQUEST:"GetFeature",TYPENAME:e.layers[0],SRSNAME:e.projection},a=new URLSearchParams(r);o.search=a.toString(),(0,S.hfetch)(o.toString()).then((e=>{if(200!==e.status)return i("data-load-error");e.text().then((e=>e.includes("ows:ExceptionReport")?i("data-load-error"):(this.loadDataSuccess(e),i("data-load-success"))))})).catch((e=>(console.warn("Error loading vectorsource... ".concat(e)),i("data-load-error"))))}editAttributes(e){this.editFeature=e,this.observer.publish("editFeature",e)}featureSelected(e){0===e.selected.length&&this.editAttributes(null,null),e.selected.forEach((t=>{!t.getId()&&t.getProperties().user&&this.select.getFeatures().remove(t),e.mapBrowserEvent.filty=!0,this.editAttributes(t)}))}refreshEditingLayer(){this.map.getLayers().getArray().filter((e=>e.getProperties().caption===this.editSource.caption)).forEach((e=>{if(e.getSource){let i=e.getSource();if(i.clear&&i.clear(),i.getParams){var t=i.getParams();t.t=(new Date).getMilliseconds(),i.updateParams(t)}i.changed&&i.changed()}}))}setLayer(e,t){this.source=this.sources.find((t=>t.id===e)),this.source||(this.source={id:e,url:"http://localhost:81/geoserver/workspace_datastore_ckan_dataplatform_sandbox/ckan_geboorde-putten/ows",layers:["workspace_datastore_ckan_dataplatform_sandbox:ckan_geboorde-putten"],editPoint:!0,projection:"EPSG:28992",caption:"Geboorde putten",uri:"http://workspace_datastore_ckan_dataplatform_sandbox",editableFields:[{alias:"x_coordinaat",name:"http://workspace_datastore_ckan_dataplatform_sandbox:x_coordinaat",dataType:"text",textType:""}]}),this.filty=!0,this.vectorSource=new p.Z({loader:e=>this.loadData(this.source,e,t),strategy:u.$6,projection:this.source.projection}),this.layer=new h.Z({layerType:"system",zIndex:5e3,name:"pluginEdit",caption:"Edit layer",source:this.vectorSource,style:this.getVectorStyle()}),this.layer&&this.map.removeLayer(this.layer),this.map.addLayer(this.layer),this.editSource=this.source,this.editFeature=null,this.observer.publish("editSource",this.source),this.observer.publish("editFeature",null),this.observer.publish("layerChanged",this.layer)}activateModify(){this.select=new m.Z({style:this.getSelectStyle(),toggleCondition:b.Fi,layers:[this.layer]}),this.select.on("select",(e=>{this.featureSelected(e,this.source)})),this.modify=new g.Z({features:this.select.getFeatures()}),this.map.addInteraction(this.select),this.map.addInteraction(this.modify)}activateAdd(e){this.draw=new w.ZP({source:this.vectorSource,style:this.getSketchStyle(),type:e,stopClick:!0,geometryName:this.geometryName}),this.draw.on("drawend",(e=>{e.feature.modification="added",this.editAttributes(e.feature),setTimeout((()=>{this.deactivateInteraction()}),1)})),this.map.addInteraction(this.draw),this.map.clickLock.add("edit")}activateRemove(){this.remove=!0,this.map.on("singleclick",this.removeSelected)}activateMove(){this.move=new v.Z({layers:[this.layer]}),this.map.addInteraction(this.move)}activateInteraction(e,t){"add"===e&&this.activateAdd(t),"move"===e&&this.activateMove(),"modify"===e&&this.activateModify(),"remove"===e&&(this.map.clickLock.add("edit"),this.activateRemove()),this.map.snapHelper.add("measure")}deactivateInteraction(){this.map.snapHelper.delete("measure"),this.select&&this.map.removeInteraction(this.select),this.modify&&this.map.removeInteraction(this.modify),this.draw&&this.map.removeInteraction(this.draw),this.move&&this.map.removeInteraction(this.move),this.remove&&(this.remove=!1,this.map.clickLock.delete("edit"),this.map.un("singleclick",this.removeSelected))}reset(){this.editSource=void 0,this.editFeature=void 0,this.removeFeature=void 0,this.removalToolMode="off",this.filty=!1,this.map.clickLock.delete("edit"),this.layer&&(this.map.removeLayer(this.layer),this.layer=void 0),this.deactivateInteraction()}deactivate(){this.reset(),this.observer.publish("editFeature",this.editFeature),this.observer.publish("editSource",this.editSource),this.observer.publish("deactivate")}getSources(){return this.options.sources}}}}]);
//# sourceMappingURL=5215.8224d2fe.chunk.js.map
