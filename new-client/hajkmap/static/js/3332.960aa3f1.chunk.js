"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[3332,647],{43332:(e,t,s)=>{s.r(t);var i=s(72791),r=s(54164),a=s(29472),n=s(24518),l=s(61889),h=s(20431),d=s(20068),o=s(9501),c=s(647),u=s(49392),g=s(24137),m=s(88264),S=s(67394),p=s(2325),x=s(4606),y=s(66120),j=s(80184);class T extends i.PureComponent{constructor(e){super(e),this.bindSubscriptions=()=>{this.localObserver.subscribe("initiateTimeSliderView",(()=>{this.initiateTimeSliderView()})),this.localObserver.subscribe("resetTimeSliderView",(()=>{this.resetTimeSliderView()})),this.localObserver.subscribe("resetTimeSlider",(()=>{this.resetTimeSlider()})),this.localObserver.subscribe("toggleSlider",(e=>{this.toggleSlider(e)}))},this.validateLayers=()=>{const{layers:e}=this.props,t={error:!1,errorType:"",faultyLayers:[]};return 0===e.length&&(t.error=!0,t.errorType="layers_missing"),e.forEach((e=>{e.get("timeSliderStart")&&e.get("timeSliderEnd")||(t.error=!0,t.errorType="layer_error",t.faultyLayers.push({layerId:e.get("name"),layerError:"date_missing"})),e.get("timeSliderStart")===e.get("timeSliderEnd")&&(t.error=!0,t.errorType="layer_error",t.faultyLayers.push({layerId:e.get("name"),layerError:"date_start_equals_end"}))})),t},this.initiateTimeSliderView=()=>{this.setState({currentUnixTime:this.startTime},(()=>{this.initiateTimeLineLayers(),this.refreshLayers()}))},this.resetTimeSliderView=()=>{this.resetTimeSlider(),this.resetTimeLineLayers()},this.resetTimeSlider=()=>{this.toggleSlider(!1),this.localObserver.publish("updateHeaderTitle",""),this.setState({currentUnixTime:this.startTime},(()=>{this.refreshLayers()}))},this.initiateTimeLineLayers=()=>{this.layers.forEach((e=>{const t=e.getSource();e instanceof o.Z?(t.originalStyleFunction=e.getStyleFunction(),t.on("addfeature",this.handleFeatureAdded),e.setStyle(null)):t.updateParams({TIME:new Date(this.state.currentUnixTime).toISOString()}),e.setVisible(!0)}))},this.resetTimeLineLayers=()=>{this.layers.forEach((e=>{const t=e.getSource();e instanceof o.Z?(t.un("addfeature",this.handleFeatureAdded),e.setStyle(t.originalStyleFunction),e.setVisible(!1)):(t.updateParams({TIME:void 0}),e.setVisible(!1))}))},this.handleFeatureAdded=e=>{const t=e.target,s=e.feature;this.getTimeSliderLayerStyle(s,t.originalStyleFunction)},this.refreshLayers=()=>{this.layers.forEach((e=>{e instanceof o.Z?e.getSource().refresh():e.getSource().updateParams({TIME:new Date(this.startTime).toISOString()})}))},this.getUnixTimeFromString=e=>{const t=e.substr(0,4),s=e.substr(4,2),i=e.substr(6,2);return new Date("".concat(t,"-").concat(s,"-").concat(i)).getTime()},this.getTime=e=>{let t;return this.layers.forEach((s=>{const i=s.get(e);if(i){let s=this.getUnixTimeFromString(i);t||(t=s),("timeSliderStart"===e&&t>s||"timeSliderEnd"===e&&t<s)&&(t=s)}})),t},this.shouldFeatureShow=e=>{const{currentUnixTime:t}=this.state,s=e.get("start"),i=e.get("end");if(!s||!i)return!1;let r=new Date(s),a=new Date(i);return(!r.getTime()>0||!a.getTime()>0)&&(r=this.getUnixTimeFromString(s),a=this.getUnixTimeFromString(i)),r<=t&&a>=t},this.toggleSlider=e=>{this.setState({playing:e}),this.localObserver.publish("toggleHeaderPlayButton",e),e?(clearInterval(this.sliderTimer),this.sliderTimer=null,this.sliderTimer=setInterval((()=>{let e=this.state.currentUnixTime+this.state.stepSize;e>=this.endTime&&(e=this.endTime,clearInterval(this.sliderTimer),this.localObserver.publish("toggleHeaderPlayButton",!1),this.setState({playing:!1})),this.handleSliderChange(e)}),this.state.sliderSpeed)):clearInterval(this.sliderTimer)},this.getStepSize=e=>{const t=864e5;switch(e){case"years":return 365*t;case"quarters":return 92*t;case"months":return 31*t;default:return t}},this.stepOnesForward=()=>{let e=this.state.currentUnixTime+this.state.stepSize;e>=this.endTime&&(e=this.startTime),this.handleSliderChange(e)},this.stepOnesBackward=()=>{let e=this.state.currentUnixTime-this.state.stepSize;e<=this.startTime&&(e=this.endTime),this.handleSliderChange(e)},this.setNextDate=e=>{const{currentUnixTime:t,resolution:s}=this.state,i=new Date(t);let r=new Date(e);if("years"===s)i.getFullYear()===r.getFullYear()&&(t<=e?r.setFullYear(i.getFullYear()+1):r.setFullYear(i.getFullYear()-1));else if("quarters"===s){const e=[0,3,6,9];if(!e.includes(r.getMonth())){const t=e.reduce(((e,t)=>Math.abs(t-r.getMonth())<Math.abs(e-r.getMonth())?t:e));r.setMonth(t),r.setDate(1)}}else"months"===s?i.getMonth()===r.getMonth()&&(t<=e?r.setMonth(i.getMonth()+1):r.setMonth(i.getMonth()-1)):i.getDay()===r.getDay()&&(t<=e?r.setDate(i.getDate()+1):r.setDate(i.getDate()-1));return r},this.handleSliderChange=e=>{const t=this.setNextDate(e);this.setState({currentUnixTime:t.getTime()},(()=>{this.updateLayers(),this.updateHeader()}))},this.updateHeader=()=>{const{currentUnixTime:e,resolution:t}=this.state;this.localObserver.publish("updateHeaderTitle",this.getDateLabel(e,t))},this.getDateLabel=(e,t)=>{let s={};const i=new Date(e);switch(t){case"years":s={year:"numeric"};break;case"quarters":case"months":s={month:"long",year:"numeric"};break;default:s={day:"numeric",month:"long",year:"numeric"}}return i.toLocaleString("default",s)},this.getShortDateLabel=(e,t)=>{let s={};const i=new Date(e);switch(t){case"years":s={year:"numeric"};break;case"months":s={month:"short",year:"numeric"};break;default:s={day:"numeric",month:"short"}}return i.toLocaleString("default",s)},this.updateLayers=()=>{const e=this.map.getView().calculateExtent();this.layers.map((t=>{const s=t.getSource();return t instanceof o.Z?s.forEachFeatureInExtent(e,(e=>{this.getTimeSliderLayerStyle(e,s.originalStyleFunction)})):s.updateParams({TIME:new Date(this.state.currentUnixTime).toISOString()})}))},this.createMarks=(e,t,s)=>{let i=[];const r=Math.floor(e/(s-1));for(let a=0;a<s;a++){const e=this.startTime+r*a;i.push({value:e,label:this.getShortDateLabel(e,t)})}return i},this.getMarks=e=>{const t=this.endTime-this.startTime,s=Math.floor(t/2592e6);return this.markResolution=s>=12*e?"years":s>=e?"months":"days",this.createMarks(t,this.markResolution,e)},this.handleResolutionChange=e=>{this.setState({resolution:e,stepSize:this.getStepSize(e)})},this.handleSliderSpeedChange=e=>{this.setState({sliderSpeed:e},(()=>{this.toggleSlider(this.state.playing)}))},this.renderSettingsDialog=()=>{const{settingsDialog:e,resolution:t,sliderSpeed:s,layerStatus:i}=this.state;return e?(0,r.createPortal)((0,j.jsx)(u.default,{options:{text:(0,j.jsx)(c.default,{layers:this.layers,layerStatus:i,resolution:t,sliderSpeed:s,handleResolutionChange:this.handleResolutionChange,handleSliderSpeedChange:this.handleSliderSpeedChange}),headerText:"Tidslinjeinst\xe4llningar",buttonText:"OK",useLegacyNonMarkdownRenderer:!0},open:e,onClose:()=>{this.setState({settingsDialog:!1})}}),document.getElementById("windows-container")):null},this.renderSettingsButton=()=>{const{layerStatus:e}=this.state;return(0,j.jsx)(a.Z,{color:"error",invisible:!e.error,badgeContent:"".concat(e.faultyLayers.length>0?e.faultyLayers.length:1),children:(0,j.jsx)(n.Z,{variant:"contained",onClick:()=>{this.setState({settingsDialog:!this.state.settingsDialog})},children:(0,j.jsx)(y.Z,{})})})},this.state={playing:!1,resolution:this.props.defaultResolution||"years",stepSize:this.getStepSize(this.props.defaultResolution||"years"),loadingError:!0,layerStatus:this.validateLayers(),settingsDialog:!1,sliderSpeed:1e3},this.map=e.map,this.layers=e.layers,this.startTime=this.getTime("timeSliderStart"),this.endTime=this.getTime("timeSliderEnd"),this.marks=this.getMarks(5),this.markResolution="",this.localObserver=e.localObserver,this.bindSubscriptions()}componentDidMount(){!0===this.props.visibleAtStart&&this.initiateTimeSliderView()}getTimeSliderLayerStyle(e,t){this.shouldFeatureShow(e)?e.setStyle(t):e.setStyle(null)}render(){const{currentUnixTime:e,stepSize:t,playing:s}=this.state;return e?(0,j.jsxs)(l.ZP,{container:!0,sx:{padding:2},children:[(0,j.jsx)(j.Fragment,{children:this.renderSettingsDialog()}),(0,j.jsx)(l.ZP,{item:!0,xs:12,sx:{paddingLeft:"years"===this.markResolution?2:"months"===this.markResolution?4:6,paddingRight:"years"===this.markResolution?2:"months"===this.markResolution?4:6},children:(0,j.jsx)(h.ZP,{size:"small",value:e,min:this.startTime,max:this.endTime,step:t,marks:this.marks,onChange:(t,s)=>{s!==e&&this.handleSliderChange(s)}})}),(0,j.jsxs)(l.ZP,{container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:2,children:[(0,j.jsx)(l.ZP,{item:!0,align:"center",xs:2,children:(0,j.jsx)(d.Z,{disableInteractive:!0,title:"\xc5terst\xe4ll tidslinjen",children:(0,j.jsx)(n.Z,{variant:"contained",onClick:this.resetTimeSlider,children:(0,j.jsx)(x.Z,{})})})}),(0,j.jsx)(l.ZP,{item:!0,align:"center",xs:2,children:(0,j.jsx)(d.Z,{disableInteractive:!0,title:s?"Du kan inte hoppa bak\xe5t n\xe4r spelaren \xe4r aktiv.":"Hoppa ett steg bak\xe5t",children:(0,j.jsx)("span",{children:(0,j.jsx)(n.Z,{variant:"contained",onClick:()=>{this.stepOnesBackward()},disabled:s,children:(0,j.jsx)(S.Z,{})})})})}),(0,j.jsx)(l.ZP,{item:!0,align:"center",xs:2,children:(0,j.jsx)(d.Z,{disableInteractive:!0,title:s?"Stoppa tidslinjen":"Starta tidslinjen",children:(0,j.jsx)(n.Z,{variant:"contained",onClick:()=>{this.toggleSlider(!s)},children:s?(0,j.jsx)(p.Z,{}):(0,j.jsx)(g.Z,{})})})}),(0,j.jsx)(l.ZP,{item:!0,align:"center",xs:2,children:(0,j.jsx)(d.Z,{disableInteractive:!0,title:s?"Du kan inte hoppa fram\xe5t n\xe4r spelaren \xe4r aktiv.":"Hoppa ett steg fram\xe5t",children:(0,j.jsx)("span",{children:(0,j.jsx)(n.Z,{variant:"contained",onClick:()=>{this.stepOnesForward()},disabled:s,children:(0,j.jsx)(m.Z,{})})})})}),(0,j.jsx)(l.ZP,{item:!0,align:"center",xs:2,children:(0,j.jsx)(d.Z,{disableInteractive:!0,title:"Inst\xe4llningar",children:this.renderSettingsButton()})})]})]}):(0,j.jsxs)(l.ZP,{container:!0,alignItems:"center",justifyContent:"center",sx:{width:"100%",height:"100%"},children:[(0,j.jsx)(j.Fragment,{children:this.renderSettingsDialog()}),(0,j.jsx)(l.ZP,{item:!0,children:this.renderSettingsButton()})]})}}t.default=T},647:(e,t,s)=>{s.r(t);var i=s(72791),r=s(20068),a=s(89891),n=s(61889),l=s(20890),h=s(68096),d=s(76384),o=s(23786),c=s(47071),u=s(90493),g=s(45484),m=s(57064),S=s(49900),p=s(46112),x=s(91964),y=s(80184);class j extends i.PureComponent{constructor(e){super(e),this.renderLayerList=()=>{const{layers:e,layerStatus:t}=this.props;return(0,y.jsx)(u.Z,{children:e.map(((e,s)=>{const i=e.get("name"),n=e.get("visible");let l=!1,h="";return t.faultyLayers.filter((e=>e.layerId===i)).forEach((e=>{l=!0,h=e.layerError})),(0,y.jsxs)(g.ZP,{sx:{borderLeft:e=>"".concat(e.spacing(.5)," solid ").concat(l?e.palette.error.main:e.palette.success.main)},disabled:!n,children:[l&&(0,y.jsx)(r.Z,{disableInteractive:!0,title:"".concat(l?"date_start_equals_end"===h?"Start- och slutdatumet p\xe5 lagret har samma v\xe4rde!":"Start- eller slutdatumet p\xe5 lagret saknas!":"Lagret ser okej ut!"),children:(0,y.jsx)(m.Z,{children:(0,y.jsx)(x.Z,{})})},"tt_".concat(s)),(0,y.jsx)(S.Z,{primary:e.get("caption")}),(0,y.jsx)(p.Z,{children:(0,y.jsx)(r.Z,{disableInteractive:!0,title:n?"D\xf6lj lager":"Visa lager",children:(0,y.jsx)(a.Z,{checked:n,onChange:()=>{e.setVisible(!n),this.setState({time:new Date})},name:"checkedA",inputProps:{"aria-label":"secondary checkbox"}})})})]},s)}))})},this.renderSettingsContainer=()=>{const{sliderSpeed:e,resolution:t,handleResolutionChange:s,handleSliderSpeedChange:i}=this.props;return(0,y.jsxs)(n.ZP,{container:!0,spacing:2,children:[(0,y.jsx)(n.ZP,{item:!0,xs:6,children:(0,y.jsxs)(h.Z,{fullWidth:!0,children:[(0,y.jsxs)(d.Z,{variant:"standard",labelId:"select-stepSize-label",id:"select-stepSize",value:e,onChange:e=>{i(e.target.value)},children:[(0,y.jsx)(o.Z,{value:2e3,children:"L\xe5ngsam (0.5 Hz)"}),(0,y.jsx)(o.Z,{value:1e3,children:"Medium (1 Hz)"}),(0,y.jsx)(o.Z,{value:500,children:"Snabb (2 Hz)"})]}),(0,y.jsx)(c.Z,{children:"\xc4ndra tidslinjens hastighet"})]})}),(0,y.jsxs)(n.ZP,{item:!0,xs:6,children:[(0,y.jsx)(h.Z,{fullWidth:!0,children:(0,y.jsxs)(d.Z,{variant:"standard",labelId:"select-resolution-label",id:"select-resolution",value:t,onChange:e=>{s(e.target.value)},children:[(0,y.jsx)(o.Z,{value:"days",children:"Dag"}),(0,y.jsx)(o.Z,{value:"months",children:"M\xe5nad"}),(0,y.jsx)(o.Z,{value:"quarters",children:"Kvartal"}),(0,y.jsx)(o.Z,{value:"years",children:"\xc5r"})]})}),(0,y.jsx)(c.Z,{children:"\xc4ndra tidslinjens uppl\xf6sning"})]})]})},this.layerStatus=e.layerStatus}render(){const{layerStatus:e}=this.props;return"layers_missing"===e.errorType?(0,y.jsx)(n.ZP,{container:!0,children:(0,y.jsx)(l.Z,{children:"Inga tidslinje-lager kunde hittas. Kontakta systemadministrat\xf6ren."})}):(0,y.jsxs)(n.ZP,{container:!0,children:[(0,y.jsx)(n.ZP,{item:!0,xs:12,children:(0,y.jsx)(l.Z,{children:"Lagerstatus: "})}),(0,y.jsx)(n.ZP,{item:!0,xs:12,children:this.renderLayerList()}),(0,y.jsx)(n.ZP,{item:!0,xs:12,children:(0,y.jsx)(l.Z,{children:"Inst\xe4llningar: "})}),(0,y.jsx)(n.ZP,{item:!0,xs:12,children:this.renderSettingsContainer()})]})}}t.default=j},88264:(e,t,s)=>{var i=s(64836);t.Z=void 0;var r=i(s(45649)),a=s(80184),n=(0,r.default)((0,a.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");t.Z=n},2325:(e,t,s)=>{var i=s(64836);t.Z=void 0;var r=i(s(45649)),a=s(80184),n=(0,r.default)((0,a.jsx)("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"}),"Pause");t.Z=n},24137:(e,t,s)=>{var i=s(64836);t.Z=void 0;var r=i(s(45649)),a=s(80184),n=(0,r.default)((0,a.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow");t.Z=n},4606:(e,t,s)=>{var i=s(64836);t.Z=void 0;var r=i(s(45649)),a=s(80184),n=(0,r.default)((0,a.jsx)("path",{d:"M7.11 8.53 5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z"}),"RotateLeftOutlined");t.Z=n},66120:(e,t,s)=>{var i=s(64836);t.Z=void 0;var r=i(s(45649)),a=s(80184),n=(0,r.default)((0,a.jsx)("path",{d:"M19.43 12.98c.04-.32.07-.64.07-.98 0-.34-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.09-.16-.26-.25-.44-.25-.06 0-.12.01-.17.03l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.06-.02-.12-.03-.18-.03-.17 0-.34.09-.43.25l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98 0 .33.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.09.16.26.25.44.25.06 0 .12-.01.17-.03l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.06.02.12.03.18.03.17 0 .34-.09.43-.25l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zm-1.98-1.71c.04.31.05.52.05.73 0 .21-.02.43-.05.73l-.14 1.13.89.7 1.08.84-.7 1.21-1.27-.51-1.04-.42-.9.68c-.43.32-.84.56-1.25.73l-1.06.43-.16 1.13-.2 1.35h-1.4l-.19-1.35-.16-1.13-1.06-.43c-.43-.18-.83-.41-1.23-.71l-.91-.7-1.06.43-1.27.51-.7-1.21 1.08-.84.89-.7-.14-1.13c-.03-.31-.05-.54-.05-.74s.02-.43.05-.73l.14-1.13-.89-.7-1.08-.84.7-1.21 1.27.51 1.04.42.9-.68c.43-.32.84-.56 1.25-.73l1.06-.43.16-1.13.2-1.35h1.39l.19 1.35.16 1.13 1.06.43c.43.18.83.41 1.23.71l.91.7 1.06-.43 1.27-.51.7 1.21-1.07.85-.89.7.14 1.13zM12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"}),"SettingsOutlined");t.Z=n}}]);
//# sourceMappingURL=3332.960aa3f1.chunk.js.map