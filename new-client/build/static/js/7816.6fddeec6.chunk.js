"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[7816],{57816:function(e,n,t){t.r(n);var r=t(1413),i=t(93433),o=t(15671),s=t(43144),a=t(60136),l=t(29388),u=t(72791),p=t(74390),c=t(76863),d=t(13609),g=t(43671),h=t(91267),f=t(4565),m=t(50228),y=t(77907),x=t(98937),v=t(5397),b=t(85172),k=t(80184),Z=(0,c.ZP)(d.Z)((function(){return{borderRadius:0,boxShadow:"none",backgroundImage:"none"}})),j=(0,c.ZP)(g.Z)((function(){return{minHeight:35,padding:"0px",overflow:"hidden","&.MuiAccordionSummary-root.Mui-expanded":{minHeight:35},"& .MuiAccordionSummary-content":{transition:"inherit",marginTop:0,marginBottom:0,"&.Mui-expanded":{marginTop:0,marginBottom:0}}}})),S=(0,c.ZP)(h.Z)((function(){return{width:"100%",display:"block",padding:"0"}})),L=(0,c.ZP)("div")((function(e){var n=e.theme;return{display:"flex",flexBasis:"100%",borderBottom:"".concat(n.spacing(.2)," solid ").concat(n.palette.divider)}})),C=(0,c.ZP)(f.Z)((function(e){return{fontSize:e.theme.typography.pxToRem(15),flexBasis:"100%"}})),T=(0,c.ZP)("div")((function(){return{float:"left"}})),w={cursor:"pointer",float:"left",marginRight:"5px",padding:"0"},I=function(e){(0,a.Z)(t,e);var n=(0,l.Z)(t);function t(e){var s;return(0,o.Z)(this,t),(s=n.call(this,e)).state={expanded:!1,groups:[],layers:[],name:"",parent:"-1",toggled:!1,chapters:[]},s.layerVisibilityChanged=function(e){s.forceUpdate()},s.getAllLayersInGroupAndSubGroups=function(e){return e.reduce((function(e,n){return s.hasSubGroups(n)&&(e=[].concat((0,i.Z)(e),(0,i.Z)(s.getAllLayersInGroupAndSubGroups(n.groups)))),[].concat((0,i.Z)(e),(0,i.Z)(n.layers))}),[])},s.getAllMapLayersReferencedByGroup=function(){var e=s.props,n=e.app,t=e.group,r=s.getAllLayersInGroupAndSubGroups([t]);return n.getMap().getLayers().getArray().filter((function(e){return r.find((function(n){return n.id===e.get("name")}))}))},s.bindVisibleChangeForLayersInGroup=function(){s.getAllMapLayersReferencedByGroup().forEach((function(e){e.on("change:visible",s.layerVisibilityChanged)}))},s.unbindVisibleChangeForLayersInGroup=function(){s.getAllMapLayersReferencedByGroup().forEach((function(e){e.un("change:visible",s.layerVisibilityChanged)}))},s.handleChange=function(e){return function(n,t){s.setState({expanded:!!t&&e})}},s.toggleExpanded=function(){s.setState({expanded:!s.state.expanded})},s.layerInMap=function(e){var n=s.props.app.getMap().getLayers().getArray().find((function(n){return n.get("name")===e.id}));return!(!n||!n.getVisible())},s.areSubGroupsAndLayersSemiToggled=function(e){var n=!1;return s.hasLayers(e)&&(n=e.layers.some((function(e){return s.layerInMap(e)}))),s.hasSubGroups(e)&&!n&&(n=e.groups.some((function(e){return s.areSubGroupsAndLayersSemiToggled(e)}))),n},s.areAllGroupsAndSubGroupsToggled=function(e){var n=!0,t=!0;return s.hasSubGroups(e)&&(n=e.groups.every((function(e){return s.areAllGroupsAndSubGroupsToggled(e)}))),s.hasLayers(e)&&(t=e.layers.every((function(e){return s.layerInMap(e)}))),n&&t},s.hasLayers=function(e){return e.layers&&e.layers.length>0},s.hasSubGroups=function(e){return e.groups&&e.groups.length>0},s.getCheckbox=function(){return s.isToggled()?(0,k.jsx)(y.Z,{sx:w}):s.isSemiToggled()?(0,k.jsx)(y.Z,{sx:(0,r.Z)((0,r.Z)({},w),{},{color:"gray"})}):(0,k.jsx)(x.Z,{sx:w})},s.model=s.props.model,s.bindVisibleChangeForLayersInGroup(),s}return(0,s.Z)(t,[{key:"componentDidMount",value:function(){this.setState((0,r.Z)({},this.props.group))}},{key:"componentWillUnmount",value:function(){this.unbindVisibleChangeForLayersInGroup()}},{key:"renderLayerGroups",value:function(){var e=this,n=this.state.expanded;return 1===this.state.groups.length&&this.state.groups[0].expanded&&(n=this.state.groups[0].id),this.state.groups.map((function(r,i){return(0,k.jsx)(t,{expanded:n===r.id,group:r,model:e.props.model,handleChange:e.handleChange,app:e.props.app,child:!0,chapters:e.props.chapters,options:e.props.options},i)}))}},{key:"isToggled",value:function(){var e=this.props.group;return this.areAllGroupsAndSubGroupsToggled(e)}},{key:"isSemiToggled",value:function(){var e=this.props.group;return this.areSubGroupsAndLayersSemiToggled(e)}},{key:"toggleGroups",value:function(e,n){var t=this;Array.isArray(n)&&n.forEach((function(n){n.groups.length&&n.groups.forEach((function(n){t.toggleGroups(e,n)})),t.toggleLayers(e,n.layers)})),"object"===typeof n&&null!==n&&n.hasOwnProperty("groups")&&this.toggleGroups(e,n.groups),"object"===typeof n&&null!==n&&n.hasOwnProperty("layers")&&this.toggleLayers(e,n.layers)}},{key:"toggleLayers",value:function(e,n){var t=this;this.props.app.getMap().getAllLayers().filter((function(e){return n.some((function(n){return n.id===e.get("name")}))})).forEach((function(n){"group"===n.get("layerType")&&(!0===e?t.model.observer.publish("showLayer",n):t.model.observer.publish("hideLayer",n)),n.setVisible(e)}))}},{key:"renderToggleAll",value:function(){var e=this;return this.props.group.toggled?(0,k.jsxs)(L,{onClick:function(n){n.preventDefault(),n.stopPropagation(),e.isToggled()?(e.toggleGroups(!1,e.props.group.groups),e.toggleLayers(!1,e.props.group.layers)):(e.toggleGroups(!0,e.props.group.groups),e.toggleLayers(!0,e.props.group.layers))},children:[(0,k.jsx)("div",{children:this.getCheckbox()}),(0,k.jsx)(C,{children:this.state.name})]}):(0,k.jsx)(L,{children:(0,k.jsx)(C,{children:this.state.name})})}},{key:"render",value:function(){var e=this,n=this.state.expanded;return(0,k.jsx)(m.Z,{sx:{marginLeft:this.props.child?"21px":"0px"},children:(0,k.jsxs)(Z,{expanded:this.state.expanded,TransitionProps:{timeout:0},onChange:function(){e.setState({expanded:!e.state.expanded})},children:[(0,k.jsxs)(j,{children:[(0,k.jsx)(T,{children:n?(0,k.jsx)(b.Z,{onClick:function(){return e.toggleExpanded()}}):(0,k.jsx)(v.Z,{onClick:function(){return e.toggleExpanded()}})}),this.renderToggleAll()]}),(0,k.jsx)(S,{children:(0,k.jsxs)("div",{children:[this.state.layers.map((function(n,t){var r=e.model.layerMap[n.id];return r?(0,k.jsx)(p.default,{layer:r,model:e.props.model,options:e.props.options,chapters:e.props.chapters,app:e.props.app,onOpenChapter:function(n){e.props.app.windows.find((function(e){return"informative"===e.type})).props.custom.open(n)}},r.get("name")):null})),this.renderLayerGroups()]})})]})})}}]),t}(u.PureComponent);I.defaultProps={child:!1,expanded:!1},n.default=I},74390:function(e,n,t){t.r(n);var r=t(93433),i=t(1413),o=t(15861),s=t(15671),a=t(43144),l=t(97326),u=t(60136),p=t(29388),c=t(66274),d=t(99359),g=t(64687),h=t.n(g),f=t(72791),m=t(98246),y=t(76863),x=t(4565),v=t(75814),b=t(61091),k=t(45953),Z=t(91964),j=t(42618),S=t(25878),L=t(19924),C=t(77907),T=t(32791),w=t(16378),I=t(98937),M=t(2094),A=t(29823),G=t(16788),V=t(43214),O=t(61611),P=t(4976),B=t(80184),F=(0,y.ZP)("div")((function(e){var n=e.theme;return{paddingLeft:"0",borderBottom:"".concat(n.spacing(.2)," solid ").concat(n.palette.divider)}})),E=(0,y.ZP)("div")((function(e){e.theme;return{display:"flex",justifyContent:"space-between",marginTop:"0"}})),z=(0,y.ZP)("div")((function(){return{display:"flex",alignItems:"center",cursor:"pointer",float:"left",marginRight:"5px"}})),R=(0,y.ZP)("div")((function(e){e.theme;return{margin:"10px 45px"}})),U=(0,y.ZP)(x.Z)((function(e){return{cursor:"pointer",fontSize:e.theme.typography.pxToRem(15)}})),D=(0,y.ZP)("img")((function(e){var n=e.theme;return{width:n.typography.pxToRem(18),height:n.typography.pxToRem(18),marginRight:"5px"}})),W=(0,y.ZP)("div")((function(){return{display:"flex",alignItems:"center"}})),q=(0,y.ZP)("div")((function(){return{display:"flex",alignItems:"center",width:35,height:35,cursor:"pointer"}})),H=(0,y.ZP)("ul")((function(){return{padding:0,margin:0,listStyle:"none"}})),_=(0,d.Z)("showAttributeTable"),N=function(e){(0,u.Z)(t,e);var n=(0,p.Z)(t);function t(e){var r;(0,s.Z)(this,t),(r=n.call(this,e)).zoomEndHandler=function(e){var n=r.props.model.olMap.getView().getZoom(),t=r.props.layer.getProperties(),i=n>t.minZoom&&n<=t.maxZoom,o=!1;return!0===r.minMaxZoomAlertOnToggleOnly?r.state.visible||i||"click"!==(null===e||void 0===e?void 0:e.type)||(o=!0):i||!r.state.zoomVisible&&r.state.visible||(o=!0),!0===o&&r.showZoomSnack(),r.setState({zoomVisible:i}),i},r.toggleVisible=function(e){var n=r.props.layer;if(r.isBackgroundLayer){if(document.getElementById("map").style.backgroundColor="#FFF",n.isFakeMapLayer)if("-2"===r.name)document.getElementById("map").style.backgroundColor="#000";else document.getElementById("map").style.backgroundColor="#FFF";else n.setVisible(!0);r.setState({visible:!0}),n.localObserver.publish("backgroundLayerChanged",r.name)}else{var t=!r.state.visible;r.setState({visible:t}),r.props.layer.setVisible(t),r.triggerZoomCheck(e,t)}},r.renderInfoButton=function(){return r.isInfoEmpty()?null:(0,B.jsx)(v.Z,{title:"Mer information om lagret",children:(0,B.jsx)(q,{children:r.state.infoVisible?(0,B.jsx)(L.Z,{onClick:r.toggleInfo}):(0,B.jsx)(S.Z,{onClick:r.toggleInfo,sx:{boxShadow:r.state.infoVisible?"rgb(204, 204, 204) 2px 3px 1px":"inherit",borderRadius:"100%"}})})})},r.renderMoreButton=function(){return(0,B.jsx)(v.Z,{title:"Fler inst\xe4llningar",children:(0,B.jsx)(q,{children:r.state.toggleSettings?(0,B.jsx)(A.Z,{onClick:r.toggleSettings}):(0,B.jsx)(M.Z,{onClick:r.toggleSettings})})})},r.openInformative=function(e){return function(n){r.props.onOpenChapter(e)}},r.toggleSettings=function(){r.setState({toggleSettings:!r.state.toggleSettings})},r.toggleInfo=function(){r.setState({infoVisible:!r.state.infoVisible})},r.getLayerToggler=function(){var e=r.state.visible?r.isBackgroundLayer?(0,B.jsx)(T.Z,{}):(0,B.jsx)(C.Z,{sx:{fill:function(e){return!r.state.zoomVisible&&r.state.visible?e.palette.warning.dark:""}}}):r.isBackgroundLayer?(0,B.jsx)(w.Z,{}):(0,B.jsx)(I.Z,{});return(0,B.jsx)(z,{children:e})},Object.defineProperty((0,l.Z)(r),_,{writable:!0,value:function(){var e=(0,o.Z)(h().mark((function e(){var n,t,o,s,a,u,p,c,d,g,f,m;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=r.props.layer.getSource().get("url").replace("wms","wfs"),t=r.props.layer.getSource().getParams(),o=t.LAYERS,s=n.includes("?")?"&":"?",a="".concat(n).concat(s,"service=WFS&version=1.0.0&request=GetFeature&typeName=").concat(o,"&maxFeatures=5000&outputFormat=application%2Fjson"),u="".concat(n).concat(s,"service=WFS&version=1.0.0&request=DescribeFeatureType&typeName=").concat(o,"&outputFormat=application%2Fjson"),e.next=8,fetch(a);case 8:return p=e.sent,e.next=11,p.json();case 11:return c=e.sent,e.next=14,fetch(u);case 14:return d=e.sent,e.next=17,d.json();case 17:g=e.sent,f=g.featureTypes.find((function(e){return e.typeName===o})).properties.filter((function(e){return!e.type.toLowerCase().includes("gml")})).map((function(e){return{field:e.name,headerName:e.name,type:"int"===e.localType?"number":e.localType,flex:1}})),m=c.features.map((function(e,n){return(0,i.Z)((0,i.Z)({},e.properties),{},{id:n})})),r.props.app.globalObserver.publish("core.showAttributeTable",{title:"".concat(r.caption," (").concat(o,")"),content:{columns:f,rows:m}}),e.next=28;break;case 23:e.prev=23,e.t0=e.catch(0),console.error(e.t0),console.log((0,l.Z)(r)),r.props.enqueueSnackbar('Serverfel: attributtabellen f\xf6r lagret "'.concat(r.caption,'" kunde inte visas'),{variant:"error"});case 28:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(){return e.apply(this,arguments)}}()});var a=e.layer,u=a.get("layerInfo");return r.isBackgroundLayer="base"===u.layerType,r.caption=u.caption,r.name=a.get("name"),r.legend=u.legend,r.legendIcon=u.legendIcon,r.infoTitle=u.infoTitle,r.infoText=u.infoText,r.infoUrl=u.infoUrl,r.infoUrlText=u.infoUrlText,r.infoOwner=u.infoOwner,r.localObserver=a.localObserver,r.showAttributeTableButton=u.showAttributeTableButton||!1,r.usesMinMaxZoom=r.layerUsesMinMaxZoom(),r.minMaxZoomAlertOnToggleOnly=a.get("minMaxZoomAlertOnToggleOnly"),r.state={visible:a.get("visible"),status:"ok",zoomVisible:!0,open:!1,toggleSettings:!1,infoVisible:!1},r.isBackgroundLayer&&a.localObserver.subscribe("backgroundLayerChanged",(function(e){e!==r.name&&(a.isFakeMapLayer||a.setVisible(!1),r.setState({visible:!1}))})),r}return(0,a.Z)(t,[{key:"componentDidMount",value:function(){var e,n,t=this;null===(e=(n=this.props.layer).on)||void 0===e||e.call(n,"change:visible",(function(e){var n=!e.oldValue;t.setState({visible:n}),t.listenToZoomChange(n)})),this.state.visible&&this.triggerZoomCheck(null,this.state.visible),this.listenToZoomChange(this.state.visible),this.props.app.globalObserver.subscribe("layerswitcher.wmsLayerLoadStatus",(function(e){"loaderror"!==t.state.status&&t.name===e.id&&t.setState({status:e.status})}))}},{key:"layerUsesMinMaxZoom",value:function(){var e,n,t=this.props.layer.getProperties(),r=null!==(e=t.maxZoom)&&void 0!==e?e:0,i=null!==(n=t.minZoom)&&void 0!==n?n:0;return r>0&&r<1/0||i>0&&i<1/0}},{key:"listenToZoomChange",value:function(e){if(this.usesMinMaxZoom){var n="core.zoomEnd";e&&!this.zoomEndListener?this.zoomEndListener=this.props.app.globalObserver.subscribe(n,this.zoomEndHandler):this.zoomEndListener&&(this.props.app.globalObserver.unsubscribe(n,this.zoomEndListener),this.zoomEndListener=null)}}},{key:"showZoomSnack",value:function(){var e=this;this.zoomWarningSnack||(this.zoomWarningSnack=this.props.enqueueSnackbar('Lagret "'.concat(this.caption,'" visas endast vid specifika skalor.'),{variant:"warning",preventDuplicate:!0,onClose:function(){e.zoomWarningSnack=null}}))}},{key:"triggerZoomCheck",value:function(e,n){if(this.usesMinMaxZoom&&(this.zoomEndHandler(e),!1===n)){if(!this.zoomWarningSnack)return;this.props.closeSnackbar(this.zoomWarningSnack),this.zoomWarningSnack=null}}},{key:"renderStatusButton",value:function(){return"loaderror"===this.state.status&&(0,B.jsx)(v.Z,{disableInteractive:!0,title:"Lagret kunde inte laddas in. Kartservern svarar inte.",children:(0,B.jsx)(q,{children:(0,B.jsx)(Z.Z,{})})})}},{key:"renderLegendImage",value:function(){var e=this.legend&&this.legend[0]&&this.legend[0].url?this.legend[0].url:"";return e?(0,B.jsx)("img",{width:"30",alt:"legend",src:e}):null}},{key:"isInfoEmpty",value:function(){var e=this.findChapters(this.name,this.props.chapters);return!(this.infoCaption||this.infoUrl||this.infoOwner||this.infoText||e.length>0)}},{key:"findChapters",value:function(e,n){var t=this,i=[];return Array.isArray(n)&&(i=n.reduce((function(n,i){return Array.isArray(i.layers)&&(i.layers.some((function(n){return n===e}))&&(n=[].concat((0,r.Z)(n),[i])),i.chapters.length>0&&(n=[].concat((0,r.Z)(n),(0,r.Z)(t.findChapters(e,i.chapters))))),n}),[])),i}},{key:"renderChapterLinks",value:function(e){var n=this;if(e&&e.length>0){var t=this.findChapters(this.name,e);return t.length>0?(0,B.jsxs)(R,{children:[(0,B.jsx)(x.Z,{children:"Inneh\xe5ll fr\xe5n denna kategori finns ben\xe4mnt i f\xf6ljande kapitel i \xf6versiktsplanen:"}),(0,B.jsx)(H,{children:t.map((function(e,t){return(0,B.jsx)("li",{children:(0,B.jsxs)(b.Z,{size:"small",onClick:n.openInformative(e),children:[e.header,(0,B.jsx)(j.Z,{sx:{marginLeft:1,fontSize:"16px"}})]})},t)}))})]}):null}return null}},{key:"toggle",value:function(){this.setState({open:!this.state.open})}},{key:"renderInfo",value:function(){return this.infoText?(0,B.jsxs)(R,{children:[(0,B.jsx)(x.Z,{variant:"subtitle2",children:this.infoTitle}),(0,B.jsx)(x.Z,{variant:"body2",dangerouslySetInnerHTML:{__html:this.infoText}})]}):null}},{key:"renderMetadataLink",value:function(){return this.infoUrl?(0,B.jsx)(R,{children:(0,B.jsx)("a",{href:this.infoUrl,target:"_blank",rel:"noopener noreferrer",children:this.infoUrlText||this.infoUrl})}):null}},{key:"renderOwner",value:function(){return this.infoOwner?(0,B.jsx)(R,{children:(0,B.jsx)(x.Z,{variant:"body2",dangerouslySetInnerHTML:{__html:this.infoOwner}})}):null}},{key:"renderDetails",value:function(){if(this.state.infoVisible)return(0,B.jsxs)("div",{children:[this.renderInfo(),this.renderMetadataLink(),this.renderOwner(),(0,B.jsx)("div",{children:this.renderChapterLinks(this.props.chapters||[])})]})}},{key:"renderLegendIcon",value:function(){return(0,B.jsx)(D,{alt:"Teckenf\xf6rklaring",src:this.legendIcon})}},{key:"render",value:function(){var e,n=this.props,t=n.layer,r=n.model,i=n.app,o=n.chapters,s=(null===(e=this.props.app.config.mapConfig.map)||void 0===e?void 0:e.cqlFilterVisible)||!1;return this.caption?"group"===t.get("layerType")?(0,B.jsx)(V.default,{appConfig:i.config.appConfig,mapConfig:i.config.mapConfig,layer:t,model:r,options:this.props.options,chapters:o,cqlFilterVisible:s,onOpenChapter:function(e){i.windows.find((function(e){return"informative"===e.type})).props.custom.open(e)}}):(0,B.jsxs)(F,{sx:{marginLeft:this.isBackgroundLayer?"0px":"45px"},children:[(0,B.jsxs)(E,{children:[(0,B.jsxs)(k.ZP,{wrap:"nowrap",alignItems:"center",alignContent:"center",container:!0,onClick:this.toggleVisible.bind(this),children:[(0,B.jsx)(k.ZP,{item:!0,children:this.getLayerToggler()}),this.legendIcon&&this.renderLegendIcon(),(0,B.jsx)(U,{children:this.caption})]}),(0,B.jsxs)(W,{children:[t.isFakeMapLayer?null:(0,B.jsx)(P.default,{layer:this.props.layer,enableDownloadLink:this.props.app.config.mapConfig.map.enableDownloadLink}),this.renderStatusButton(),this.renderInfoButton(),this.showAttributeTableButton&&(0,B.jsx)(v.Z,{title:"Visa lagrets attributtabell",children:(0,B.jsx)(q,{children:(0,B.jsx)(G.Z,{onClick:(0,c.Z)(this,_)[_]})})}),this.renderMoreButton()]})]}),(0,B.jsxs)("div",{children:[this.renderDetails(),this.state.toggleSettings&&this.state.infoVisible&&!this.isInfoEmpty()?(0,B.jsx)("hr",{}):null,t.isFakeMapLayer?null:(0,B.jsx)(O.default,{options:this.props.options,layer:t,toggled:this.state.toggleSettings,showOpacity:!0,showLegend:!0,cqlFilterVisible:s})]})]}):null}}]),t}(f.PureComponent);n.default=(0,m.RM)(N)}}]);
//# sourceMappingURL=7816.6fddeec6.chunk.js.map