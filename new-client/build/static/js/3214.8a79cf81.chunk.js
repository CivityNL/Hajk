"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[3214,2130],{41566:function(e,t,r){r.r(t);var n=r(29439),i=r(72791),s=r(40508),a=r(96746),l=r(38254),o=r(75814),u=r(13811),c=r(43950),d=r(80184);t.default=function(e){var t,r=e.layer,h=r.getSource(),p="function"===typeof h.getParams&&(null===(t=h.getParams())||void 0===t?void 0:t.CQL_FILTER)||"",f=(0,i.useState)(p),g=(0,n.Z)(f,2),y=g[0],x=g[1];return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.Z,{htmlFor:"cqlfilter",children:"Ange CQL-filter"}),(0,d.jsx)(a.Z,{id:"cqlfilter",type:"text",multiline:!0,fullWidth:!0,placeholder:"foo='bar' AND fii='baz'",value:y,onChange:function(e){return x(e.target.value)},endAdornment:(0,d.jsx)(l.Z,{position:"end",children:(0,d.jsx)(o.Z,{disableInteractive:!0,title:"Tryck f\xf6r att ladda om lagret med angivet filter",children:(0,d.jsx)(u.Z,{edge:"end",onClick:function(){var e=y.trim();0===e.length&&(e=void 0),r.getSource().updateParams({CQL_FILTER:e})},size:"large",children:(0,d.jsx)(c.Z,{})})})})})]})}},4976:function(e,t,r){r.r(t);r(72791);var n=r(13811),i=r(22007),s=r(80184);t.default=function(e){var t=e.index,r=void 0===t?0:t,a=e.layer,l=e.enableDownloadLink,o=void 0!==l&&l,u=Array.isArray(a.subLayers)?encodeURI(a.subLayers[r]):null,c=a.get("url"),d="".concat(c,"/kml?layers=").concat(u,"&mode=download");return o?null!==u&&(0,s.jsx)(n.Z,{"aria-label":"download",onClick:function(){document.location=d},size:"small",children:(0,s.jsx)(i.Z,{})}):null}},43214:function(e,t,r){r.r(t);var n=r(93433),i=r(15671),s=r(43144),a=r(97326),l=r(60136),o=r(29388),u=r(1413),c=r(72791),d=r(45953),h=r(4565),p=r(75814),f=r(61091),g=r(50228),y=r(76863),x=r(91964),v=r(42618),b=r(25878),m=r(19924),j=r(77907),Z=r(98937),S=r(2094),L=r(29823),k=r(61611),C=r(4976),w=r(5397),I=r(85172),P=r(80184),V=(0,y.ZP)("div")((function(){return{display:"flex",float:"left",cursor:"pointer"}})),T=(0,y.ZP)("div")((function(e){var t=e.theme;return{width:"100%",borderBottom:"".concat(t.spacing(.2)," solid ").concat(t.palette.divider)}})),A=(0,y.ZP)((function(e){return(0,P.jsx)(d.ZP,(0,u.Z)({justifyContent:"space-between",container:!0,alignItems:"center",wrap:"nowrap"},e))}))((function(e){e.theme;return{width:"100%"}})),F=(0,y.ZP)("div")((function(){return{display:"flex",alignItems:"center"}})),O=(0,y.ZP)("div")((function(){return{display:"flex",alignItems:"center",width:35,height:35,cursor:"pointer"}})),E=(0,y.ZP)(h.Z)((function(e){return{cursor:"pointer",fontSize:e.theme.typography.pxToRem(15)}})),R=(0,y.ZP)("div")((function(){return{display:"flex",alignItems:"center",cursor:"pointer",float:"left",marginRight:"5px"}})),_=(0,y.ZP)("img")((function(e){return{marginLeft:e.theme.spacing(.4),maxWidth:"250px"}})),U=(0,y.ZP)("img")((function(e){var t=e.theme;return{width:t.typography.pxToRem(18),height:t.typography.pxToRem(18),marginRight:"5px"}})),q=(0,y.ZP)("div")((function(){return{margin:"10px 45px"}})),z=(0,y.ZP)("ul")((function(){return{padding:0,margin:0,listStyle:"none"}})),D=function(e){(0,l.Z)(r,e);var t=(0,o.Z)(r);function r(e){var s;(0,i.Z)(this,r),(s=t.call(this,e)).openInformative=function(e){return function(t){s.props.onOpenChapter(e)}},s.toggleVisible=function(e){return function(t){var r=!s.state.visible;s.setState({visible:r}),e.setVisible(r)}},s.setHidden=function(e){var t=s.props.layer;e===t&&(s.props.layer.getSource().updateParams({LAYERS:"",CQL_FILTER:null}),t.setVisible(!1),s.setState({visible:!1,visibleSubLayers:[]}))},s.setVisible=function(e){var t,r=null;e.hasOwnProperty("layer")&&e.hasOwnProperty("subLayersToShow")?(r=e.subLayersToShow,t=e.layer):(r=s.props.layer.subLayers,t=e),t===s.props.layer&&(s.props.layer.setVisible(!0),s.props.layer.getSource().updateParams({LAYERS:r.join(),CQL_FILTER:null,STYLES:Object.entries(s.props.layer.layersInfo).filter((function(e){return-1!==r.indexOf(e[0])})).map((function(e){return e[1].style})).join(",")}),s.setState({visible:!0,visibleSubLayers:r}))},s.toggleGroupVisible=function(e){return function(t){!s.state.visible?s.setVisible(e):s.setHidden(e)}},s.toggleLayerVisible=function(e){return function(t){var r,i=(0,n.Z)(s.state.visibleSubLayers),a=i.some((function(t){return t===e})),l=s.state.visible;if(r=l,a?i=i.filter((function(t){return t!==e})):i.push(e),!l&&i.length>0&&(r=!0),0===i.length&&(r=!1),i.length>=1){var o=[];i.forEach((function(e){o.push(s.props.layer.layersInfo[e].style)})),s.props.layer.getSource().updateParams({LAYERS:i.join(),STYLES:Object.entries(s.props.layer.layersInfo).filter((function(e){return-1!==i.indexOf(e[0])})).map((function(e){return e[1].style})).join(","),CQL_FILTER:null}),s.props.layer.setVisible(r),s.setState({visible:r,visibleSubLayers:i})}else s.setHidden(s.props.layer)}},s.renderInfoToggler=function(){return!s.isInfoEmpty()&&(0,P.jsx)(O,{children:s.state.infoVisible?(0,P.jsx)(m.Z,{onClick:function(){return s.toggleInfo()}}):(0,P.jsx)(b.Z,{onClick:function(){return s.toggleInfo()},style:{boxShadow:s.state.infoVisible?"rgb(204, 204, 204) 2px 3px 1px":"inherit",borderRadius:"100%"}})})};var l=e.layer.get("layerInfo");return s.state={caption:l.caption,visible:e.layer.get("visible"),visibleSubLayers:e.layer.get("visible")?e.layer.subLayers:[],expanded:!1,name:e.layer.get("name"),legend:l.legend,status:"ok",infoVisible:!1,infoTitle:l.infoTitle,infoText:l.infoText,infoUrl:l.infoUrl,infoUrlText:l.infoUrlText,infoOwner:l.infoOwner,infoExpanded:!1,instruction:l.instruction,open:!1,opacityValue:1,toggleSettings:!1,toggleSubLayerSettings:{}},s.toggleSubLayerSettings=s.toggleSubLayerSettings.bind((0,a.Z)(s)),s.renderSubLayer=s.renderSubLayer.bind((0,a.Z)(s)),s.hideExpandArrow=!0===(null===l||void 0===l?void 0:l.hideExpandArrow),s}return(0,s.Z)(r,[{key:"componentDidMount",value:function(){var e=this,t=this.props.model;t.globalObserver.subscribe("layerswitcher.hideLayer",this.setHidden),t.globalObserver.subscribe("layerswitcher.showLayer",this.setVisible),t.observer.subscribe("hideLayer",this.setHidden),t.observer.subscribe("showLayer",this.setVisible),t.observer.subscribe("toggleGroup",this.toggleGroupVisible),t.globalObserver.subscribe("layerswitcher.wmsLayerLoadStatus",(function(t){"loaderror"!==e.state.status&&e.state.name===t.id&&e.setState({status:t.status})}))}},{key:"renderStatus",value:function(){return"loaderror"===this.state.status&&(0,P.jsx)(p.Z,{disableInteractive:!0,title:"Lagret kunde inte laddas in. Kartservern svarar inte.",children:(0,P.jsx)(O,{children:(0,P.jsx)(x.Z,{})})})}},{key:"renderLegendImage",value:function(){var e=this.state.legend[0]&&this.state.legend[0].url?this.state.legend[0].url:"";return e?(0,P.jsx)("img",{width:"60",alt:"legend",src:e}):null}},{key:"findChapters",value:function(e,t){var r=this,i=[];return Array.isArray(t)&&(i=t.reduce((function(t,i){return Array.isArray(i.layers)&&(i.layers.some((function(t){return t===e}))&&(t=[].concat((0,n.Z)(t),[i])),i.chapters.length>0&&(t=[].concat((0,n.Z)(t),(0,n.Z)(r.findChapters(e,i.chapters))))),t}),[])),i}},{key:"renderChapterLinks",value:function(e){var t=this;if(e&&e.length>0){var r=this.findChapters(this.props.layer.get("name"),e);return r.length>0?(0,P.jsxs)(q,{children:[(0,P.jsx)(h.Z,{children:"Inneh\xe5ll fr\xe5n denna kategori finns ben\xe4mnt i f\xf6ljande kapitel i \xf6versiktsplanen:"}),(0,P.jsx)(z,{children:r.map((function(e,r){return(0,P.jsx)("li",{children:(0,P.jsxs)(f.Z,{size:"small",onClick:t.openInformative(e),children:[e.header,(0,P.jsx)(v.Z,{sx:{marginLeft:1,fontSize:"16px"}})]})},r)}))})]}):null}return null}},{key:"toggle",value:function(){this.setState({open:!this.state.open})}},{key:"toggleInfo",value:function(){this.setState({infoVisible:!this.state.infoVisible})}},{key:"isInfoEmpty",value:function(){var e=this.findChapters(this.props.layer.get("name"),this.props.chapters),t=this.state,r=t.infoCaption,n=t.infoUrl,i=t.infoOwner,s=t.infoText;return!(r||n||i||s||e.length>0)}},{key:"renderLegendIcon",value:function(e){return(0,P.jsx)(U,{alt:"Teckenf\xf6rklaringsikon",src:e})}},{key:"renderSubLayer",value:function(e,t,r){var n=this.state.visibleSubLayers.some((function(e){return e===t})),i=this.toggleSubLayerSettings.bind(this,r),s=e.layersInfo[t].legendIcon;return(0,P.jsxs)(T,{children:[(0,P.jsxs)(A,{children:[(0,P.jsxs)(d.ZP,{container:!0,alignItems:"center",wrap:"nowrap",children:[(0,P.jsx)(R,{onClick:this.toggleLayerVisible(t),children:n?(0,P.jsx)(j.Z,{}):(0,P.jsx)(Z.Z,{})}),s&&this.renderLegendIcon(s),(0,P.jsx)(E,{children:e.layersInfo[t].caption})]}),(0,P.jsxs)(F,{children:[(0,P.jsx)(O,{children:(0,P.jsx)(C.default,{index:r,layer:this.props.layer,enableDownloadLink:this.props.mapConfig.map.enableDownloadLink})}),(0,P.jsx)(O,{children:this.state.toggleSubLayerSettings[r]?(0,P.jsx)(L.Z,{onClick:function(){return i()}}):(0,P.jsx)(S.Z,{onClick:function(){return i()}})})]})]}),this.state.toggleSubLayerSettings[r]?(0,P.jsx)(d.ZP,{item:!0,xs:12,children:(0,P.jsx)(_,{alt:"Teckenf\xf6rklaring",src:this.props.layer.layersInfo[t].legend})}):null]},r)}},{key:"renderSubLayers",value:function(){var e=this,t=this.state.open,r=this.props.layer;return t?(0,P.jsx)(g.Z,{sx:{marginLeft:"45px"},children:r.subLayers.map((function(t,n){return e.renderSubLayer(r,t,n)}))}):null}},{key:"renderInfo",value:function(){var e=this.state,t=e.infoTitle,r=e.infoText;return r?(0,P.jsxs)(q,{children:[(0,P.jsx)(h.Z,{variant:"subtitle2",children:t}),(0,P.jsx)(h.Z,{variant:"body2",dangerouslySetInnerHTML:{__html:r}})]}):null}},{key:"renderMetadataLink",value:function(){var e=this.state,t=e.infoUrl,r=e.infoUrlText;return t?(0,P.jsx)(q,{children:(0,P.jsx)("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:r||t})}):null}},{key:"renderOwner",value:function(){var e=this.state.infoOwner;return e?(0,P.jsx)(q,{children:(0,P.jsx)(h.Z,{variant:"body2",dangerouslySetInnerHTML:{__html:e}})}):null}},{key:"renderDetails",value:function(){return this.state.infoVisible?(0,P.jsxs)("div",{children:[this.renderInfo(),this.renderMetadataLink(),this.renderOwner(),(0,P.jsx)("div",{children:this.renderChapterLinks(this.props.chapters||[])})]}):null}},{key:"toggleSettings",value:function(){this.setState({toggleSettings:!this.state.toggleSettings})}},{key:"toggleSubLayerSettings",value:function(e){var t=this.state.toggleSubLayerSettings;t[e]=!t[e],this.setState({toggleSubLayerSettings:t})}},{key:"render",value:function(){var e=this,t=this.props,r=t.cqlFilterVisible,n=t.layer,i=this.state,s=i.open,a=i.visible,l=i.visibleSubLayers,o=i.toggleSettings,u=i.infoVisible;var c=n.get("layerInfo").legendIcon;return(0,P.jsxs)(d.ZP,{sx:{marginLeft:this.hideExpandArrow?"45px":"21px"},children:[(0,P.jsxs)(d.ZP,{container:!0,alignItems:"center",wrap:"nowrap",children:[!1===this.hideExpandArrow&&(0,P.jsx)(V,{children:s?(0,P.jsx)(I.Z,{onClick:function(){return e.toggle()}}):(0,P.jsx)(w.Z,{onClick:function(){return e.toggle()}})}),(0,P.jsx)(T,{children:(0,P.jsxs)(A,{children:[(0,P.jsxs)(d.ZP,{container:!0,alignItems:"center",wrap:"nowrap",onClick:this.toggleGroupVisible(n),children:[(0,P.jsx)(R,{children:a?l.length!==n.subLayers.length?(0,P.jsx)(j.Z,{sx:{fill:"gray"}}):(0,P.jsx)(j.Z,{}):(0,P.jsx)(Z.Z,{})}),c&&this.renderLegendIcon(c),(0,P.jsx)(E,{children:n.get("caption")})]}),(0,P.jsxs)(F,{children:[this.renderStatus(),this.renderInfoToggler(),(0,P.jsx)(O,{children:o?(0,P.jsx)(L.Z,{onClick:function(){return e.toggleSettings()}}):(0,P.jsx)(S.Z,{onClick:function(){return e.toggleSettings()}})})]})]})})]}),this.renderDetails(),o&&u&&!this.isInfoEmpty()?(0,P.jsx)("hr",{}):null,(0,P.jsx)("div",{children:(0,P.jsx)(k.default,{options:this.props.options,layer:n,cqlFilterVisible:r,observer:this.props.model.observer,toggled:o,showOpacity:!0,showLegend:!1})}),this.renderSubLayers()]})}}]),r}(c.Component);t.default=D},61611:function(e,t,r){r.r(t);var n=r(15671),i=r(43144),s=r(60136),a=r(29388),l=r(72791),o=r(72130),u=r(41566),c=r(4565),d=r(11601),h=r(76863),p=r(80184),f=(0,h.ZP)("div")((function(e){e.theme;return{overflow:"hidden",paddingLeft:"45px",paddingRight:"30px",paddingBottom:"10px",paddingTop:"10px"}})),g=(0,h.ZP)("div")((function(e){e.theme;return{display:"flex",flexFlow:"row nowrap",alignItems:"center"}})),y=(0,h.ZP)("div")((function(e){e.theme;return{flex:"0 1 auto",minWidth:"40px"}})),x=(0,h.ZP)("div")((function(e){e.theme;return{padding:"0 16px",flex:"1 1 auto","& > span":{top:"4px"}}})),v=function(e){(0,s.Z)(r,e);var t=(0,a.Z)(r);function r(e){var i,s;(0,n.Z)(this,r),(s=t.call(this,e)).updateOpacity=function(e){var t=e.target.getOpacity();s.setState({opacityValue:t})},s.opacitySliderChanged=function(e,t){s.props.layer.setOpacity(t)},s.toggle=function(e){s.setState({toggled:!s.state.toggled})};var a=e.layer,l=a.get("layerInfo");return s.state={opacityValue:a.get("opacity"),legend:l.legend},null===(i=a.on)||void 0===i||i.call(a,"change:opacity",s.updateOpacity),s}return(0,i.Z)(r,[{key:"renderOpacitySlider",value:function(){var e=this.state.opacityValue;return(0,p.jsxs)(g,{children:[(0,p.jsx)(y,{children:(0,p.jsx)(c.Z,{variant:"subtitle2",children:"Opacitet:"})}),(0,p.jsx)(x,{children:(0,p.jsx)(d.ZP,{size:"small",value:e,min:0,max:1,step:.05,onChange:this.opacitySliderChanged})}),(0,p.jsx)(y,{children:(0,p.jsxs)(c.Z,{variant:"subtitle2",children:[Math.trunc(100*e.toFixed(2))," %"]})})]})}},{key:"renderSettings",value:function(){var e;return(0,p.jsx)("div",{children:(0,p.jsxs)(f,{children:[!1!==(null===(e=this.props.options)||void 0===e?void 0:e.enableTransparencySlider)&&this.props.showOpacity?this.renderOpacitySlider():null,this.props.showLegend?this.renderLegendImage():null,this.props.layer.getProperties().filterable?(0,p.jsx)(o.default,{layer:this.props.layer}):null,this.props.cqlFilterVisible&&(0,p.jsx)(u.default,{layer:this.props.layer})]})})}},{key:"renderLegendImage",value:function(){var e,t,r,n=this.props.index?this.props.index:0,i=null!==(e=null===(t=this.state.legend)||void 0===t||null===(r=t[n])||void 0===r?void 0:r.url)&&void 0!==e?e:"";return i?(0,p.jsx)("div",{children:(0,p.jsx)("img",{"max-width":"250px",alt:"Teckenf\xf6rklaring",src:i})}):null}},{key:"render",value:function(){return(0,p.jsx)("div",{children:(0,p.jsx)("div",{children:this.props.toggled?this.renderSettings():null})})}}]),r}(l.PureComponent);t.default=v},72130:function(e,t,r){r.r(t);var n=r(4942),i=r(15671),s=r(43144),a=r(60136),l=r(29388),o=r(72791),u=r(76863),c=r(63381),d=r(35702),h=r(40508),p=r(81898),f=r(43595),g=r(61091),y=r(4565),x=r(34951),v=r(25806),b=r(80184),m=(0,u.ZP)(p.Z)((function(e){return{margin:e.theme.spacing(1),minWidth:120}})),j=(0,u.ZP)(y.Z)((function(e){e.theme;return{fontWeight:500}})),Z=function(e){(0,a.Z)(r,e);var t=(0,l.Z)(r);function r(e){var s;return(0,i.Z)(this,r),(s=t.call(this,e)).loadFeatureInfo=function(){var e=s.props.layer.getProperties(),t=e.url,r=e.featureType;(0,v.hfetch)(t+"?service=WFS&request=describeFeatureType&outputFormat=application/json&typename=".concat(r)).then((function(e){e.json().then((function(e){var t=e.featureTypes.find((function(e){return e.typeName===r}));if(t&&Array.isArray(t.properties)){var n=t.properties.filter((function(e){return"gml:Geometry"!==e.type})).map((function(e){return e.name}));s.setState({layerProperties:n})}}))}))},s.handleChange=function(e){s.setState((0,n.Z)({},e.target.name,e.target.value))},s.setFilter=function(e){s.props.layer.set("filterAttribute",s.state.filterAttribute),s.props.layer.set("filterComparer",s.state.filterComparer),s.props.layer.set("filterValue",s.state.filterValue),s.props.layer.getSource().refresh()},s.resetFilter=function(e){s.setState({filterAttribute:"",filterValue:"",filterComparer:""}),s.props.layer.set("filterAttribute",""),s.props.layer.set("filterComparer",""),s.props.layer.set("filterValue",""),s.props.layer.getSource().refresh()},s.state={filterAttribute:e.layer.get("filterAttribute")||"",filterValue:e.layer.get("filterValue")||"",filterComparer:e.layer.get("filterComparer")||"",layerProperties:[]},s.loadFeatureInfo(),s}return(0,s.Z)(r,[{key:"render",value:function(){return this.props.layer instanceof x.Z?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j,{variant:"subtitle2",children:"Filtrera inneh\xe5ll baserat p\xe5 attribut"}),(0,b.jsxs)(m,{children:[(0,b.jsx)(h.Z,{htmlFor:"attribute",children:"Attribut"}),(0,b.jsx)(c.Z,{value:this.state.filterAttribute,onChange:this.handleChange,inputProps:{name:"filterAttribute",id:"attribute"},children:this.state.layerProperties.map((function(e,t){return(0,b.jsx)(d.Z,{value:e,children:e},t)}))})]}),(0,b.jsxs)(m,{children:[(0,b.jsx)(h.Z,{htmlFor:"comparer",children:"J\xe4mf\xf6rare"}),(0,b.jsxs)(c.Z,{value:this.state.filterComparer,onChange:this.handleChange,inputProps:{name:"filterComparer",id:"comparer"},children:[(0,b.jsx)(d.Z,{value:"gt",children:"St\xf6rre \xe4n"}),(0,b.jsx)(d.Z,{value:"lt",children:"Mindre \xe4n"}),(0,b.jsx)(d.Z,{value:"eq",children:"Lika med"}),(0,b.jsx)(d.Z,{value:"not",children:"Skilt fr\xe5n"})]})]}),(0,b.jsx)(m,{children:(0,b.jsx)(f.Z,{value:this.state.filterValue,onChange:this.handleChange,placeholder:"Filterv\xe4rde",inputProps:{name:"filterValue","aria-label":"V\xe4rde"}})}),(0,b.jsx)(g.Z,{variant:"contained",color:"primary",onClick:this.setFilter,children:"Aktivera"}),(0,b.jsx)(g.Z,{onClick:this.resetFilter,children:"\xc5terst\xe4ll"})]}):null}}]),r}(o.PureComponent);t.default=Z}}]);
//# sourceMappingURL=3214.8a79cf81.chunk.js.map