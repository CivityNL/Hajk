"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[8954],{28954:function(e,t,r){r.r(t);var n=r(37762),i=r(15861),o=r(43144),a=r(15671),l=r(66274),u=r(99359),s=r(16296),c=r(64687),f=r.n(c),Z=r(34951),d=r(5426),p=r(43572),v=r(88490),h=r(56957),y=r(64802),b=r(90927),g=r(64665),w=r(5400),m=r(66233),F=r(69236),P=(0,u.Z)("map"),E=(0,u.Z)("layerName"),S=(0,u.Z)("drawModel"),O=(0,u.Z)("observer"),j=(0,u.Z)("kmlSource"),T=(0,u.Z)("kmlLayer"),x=(0,u.Z)("parser"),k=(0,u.Z)("currentExtent"),L=(0,u.Z)("handleInitiationParametersMissing"),C=(0,u.Z)("initiateKmlLayer"),D=(0,u.Z)("addMapDropListeners"),I=(0,u.Z)("preventDefaultDropBehavior"),M=(0,u.Z)("handleDrop"),N=(0,u.Z)("importDroppedKml"),R=(0,u.Z)("vectorLayerExists"),_=(0,u.Z)("getAllMapLayers"),A=(0,u.Z)("layerHasCorrectNameAndType"),K=(0,u.Z)("isVectorLayer"),G=(0,u.Z)("connectExistingVectorLayer"),X=(0,u.Z)("createNewKmlLayer"),z=(0,u.Z)("getNewVectorSource"),V=(0,u.Z)("getNewVectorLayer"),H=(0,u.Z)("translateFeatureToViewSrs"),U=(0,u.Z)("setFeatureStyle"),W=(0,u.Z)("setFeatureStyleFromProps"),B=(0,u.Z)("setStyleFromStyleFunction"),J=(0,u.Z)("styleFillIsNullish"),Y=(0,u.Z)("setFeatureTextProperties"),q=(0,u.Z)("createFeatureStyle"),Q=(0,u.Z)("getFillStyle"),$=(0,u.Z)("getImageStyle"),ee=(0,u.Z)("getStrokeStyle"),te=(0,u.Z)("getTextStyle"),re=(0,u.Z)("getFeaturePointPosition"),ne=(0,u.Z)("prepareForMapInjection"),ie=(0,u.Z)("tagFeaturesAsImported"),oe=(0,u.Z)("getAllImportedFeatures"),ae=(0,u.Z)("kmlSourceHasFeatures"),le=(0,u.Z)("fitMapToExtent"),ue=(0,u.Z)("setFeatureProperties"),se=(0,u.Z)("getKmlCompatibleFeatures"),ce=(0,o.Z)((function e(t){var r=this;if((0,a.Z)(this,e),Object.defineProperty(this,P,{writable:!0,value:void 0}),Object.defineProperty(this,E,{writable:!0,value:void 0}),Object.defineProperty(this,S,{writable:!0,value:void 0}),Object.defineProperty(this,O,{writable:!0,value:void 0}),Object.defineProperty(this,j,{writable:!0,value:void 0}),Object.defineProperty(this,T,{writable:!0,value:void 0}),Object.defineProperty(this,x,{writable:!0,value:void 0}),Object.defineProperty(this,k,{writable:!0,value:void 0}),Object.defineProperty(this,L,{writable:!0,value:function(){throw new Error("Failed to initiate KML-model, - required parameters missing. \n Required parameters: map, layerName")}}),Object.defineProperty(this,C,{writable:!0,value:function(){return(0,l.Z)(r,R)[R]()?(0,l.Z)(r,G)[G]():(0,l.Z)(r,X)[X]()}}),Object.defineProperty(this,D,{writable:!0,value:function(){var e=document.getElementById("map");["drop","dragover","dragend","dragleave","dragenter"].forEach((function(t){e.addEventListener(t,(0,l.Z)(r,I)[I],!1)})),e.addEventListener("drop",(0,l.Z)(r,M)[M],!1)}}),Object.defineProperty(this,I,{writable:!0,value:function(e){e.stopPropagation(),e.preventDefault()}}),Object.defineProperty(this,M,{writable:!0,value:function(){var e=(0,i.Z)(f().mark((function e(t){var n,i,o,a,u,c,Z;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=!1,i=!1,e.prev=3,a=(0,s.Z)(t.dataTransfer.files);case 5:return e.next=7,a.next();case 7:if(!(n=!(u=e.sent).done)){e.next=14;break}c=u.value,"kml"!==(Z=c.type?c.type:c.name.split(".").pop())&&"application/vnd.google-earth.kml+xml"!==Z||(0,l.Z)(r,N)[N](c);case 11:n=!1,e.next=5;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(3),i=!0,o=e.t0;case 20:if(e.prev=20,e.prev=21,!n||null==a.return){e.next=25;break}return e.next=25,a.return();case 25:if(e.prev=25,!i){e.next=28;break}throw o;case 28:return e.finish(25);case 29:return e.finish(20);case 30:e.next=35;break;case 32:e.prev=32,e.t1=e.catch(0),console.error("Error importing KML-file... ".concat(e.t1));case 35:case"end":return e.stop()}}),e,null,[[0,32],[3,16,20,30],[21,,25,29]])})));return function(t){return e.apply(this,arguments)}}()}),Object.defineProperty(this,N,{writable:!0,value:function(e){var t=new FileReader,n=Math.random().toString(36).slice(2,9);t.onload=function(){r.import(t.result,{zoomToExtent:!0,setProperties:{KML_ID:n}}),(0,l.Z)(r,O)[O]&&(0,l.Z)(r,O)[O].publish("kmlModel.fileImported",{id:n})},t.readAsText(e)}}),Object.defineProperty(this,R,{writable:!0,value:function(){return(0,l.Z)(r,_)[_]().some((function(e){return(0,l.Z)(r,A)[A](e)}))}}),Object.defineProperty(this,_,{writable:!0,value:function(){return(0,l.Z)(r,P)[P].getLayers().getArray()}}),Object.defineProperty(this,A,{writable:!0,value:function(e){return e.get("name")===(0,l.Z)(r,E)[E]&&(0,l.Z)(r,K)[K](e)}}),Object.defineProperty(this,K,{writable:!0,value:function(e){return e instanceof Z.Z}}),Object.defineProperty(this,G,{writable:!0,value:function(){var e=(0,l.Z)(r,_)[_]().find((function(e){return(0,l.Z)(r,A)[A](e)}));(0,l.Z)(r,T)[T]=e,(0,l.Z)(r,j)[j]=e.getSource()}}),Object.defineProperty(this,X,{writable:!0,value:function(){(0,l.Z)(r,j)[j]=(0,l.Z)(r,z)[z](),(0,l.Z)(r,T)[T]=(0,l.Z)(r,V)[V]((0,l.Z)(r,j)[j]),(0,l.Z)(r,T)[T].set("name",(0,l.Z)(r,E)[E]),(0,l.Z)(r,P)[P].addLayer((0,l.Z)(r,T)[T])}}),Object.defineProperty(this,z,{writable:!0,value:function(){return new d.Z({wrapX:!1})}}),Object.defineProperty(this,V,{writable:!0,value:function(e){return new Z.Z({source:e,layerType:"system",zIndex:5e3,caption:"KML model"})}}),Object.defineProperty(this,H,{writable:!0,value:function(e){var t,n,i,o;if(null===(null!==(t=null===e||void 0===e||null===(n=e.getGeometry)||void 0===n||null===(i=(o=n.call(e)).getType)||void 0===i?void 0:i.call(o))&&void 0!==t?t:null))return null;var a=(0,l.Z)(r,P)[P].getView().getProjection();e.getGeometry().transform("EPSG:4326",a)}}),Object.defineProperty(this,U,{writable:!0,value:function(e){var t;e||console.warn("Cannot apply a style on nothing. (Supplied feature is nullish).");var n=e.get("EXTRACTED_STYLE")||e.get("style")||null;if(null!==n)return(0,l.Z)(r,W)[W](e,n);var i=null!==(t=e.getStyleFunction())&&void 0!==t?t:null;return null!==i?(0,l.Z)(r,B)[B](e,i):void 0}}),Object.defineProperty(this,W,{writable:!0,value:function(e,t){try{var n=JSON.parse(t);"Text"===(e.get("DRAW_METHOD")||e.get("geometryType")||null)&&(0,l.Z)(r,Y)[Y](e,n.text),e.setStyle((0,l.Z)(r,q)[q](n))}catch(i){console.error("KML-model: Style attribute could not be parsed. Error: ".concat(i))}}}),Object.defineProperty(this,B,{writable:!0,value:function(e,t){var n=t(e,(0,l.Z)(r,P)[P].getView().getResolution());(0,l.Z)(r,J)[J](n)&&n[0].setFill(new b.Z({color:[0,0,0,0]})),e.setStyle(n)}}),Object.defineProperty(this,J,{writable:!0,value:function(e){return e[0]&&e[0].getFill&&null===e[0].getFill()}}),Object.defineProperty(this,Y,{writable:!0,value:function(e,t){e.get("USER_TEXT")||(e.set("USER_TEXT",t),e.set("TEXT_SETTINGS",{backgroundColor:"#000000",foregroundColor:"#FFFFFF",size:14}))}}),Object.defineProperty(this,q,{writable:!0,value:function(e){return new g.ZP({fill:(0,l.Z)(r,Q)[Q](e),image:(0,l.Z)(r,$)[$](e),stroke:(0,l.Z)(r,ee)[ee](e),text:(0,l.Z)(r,te)[te](e)})}}),Object.defineProperty(this,Q,{writable:!0,value:function(e){var t=e.fillStyle,r=e.fillColor;return t?new b.Z({color:t.color}):new b.Z({color:r})}}),Object.defineProperty(this,$,{writable:!0,value:function(e){var t=e.imageStyle,r=e.pointColor;return t?new w.Z({radius:6,stroke:new m.Z({color:t.strokeColor,width:t.strokeWidth,lineDash:t.dash}),fill:new b.Z({color:t.fillColor})}):new w.Z({radius:6,stroke:new m.Z({color:"#FFFFFF",width:2,lineDash:null}),fill:new b.Z({color:r})})}}),Object.defineProperty(this,ee,{writable:!0,value:function(e){var t=e.strokeStyle;if(t)return new m.Z({lineDash:t.dash,color:t.color,width:t.width});var r=e.strokeDash,n=e.strokeWidth,i=e.strokeColor;return new m.Z({lineDash:r,color:i,width:n})}}),Object.defineProperty(this,te,{writable:!0,value:function(e){var t=e.text;return new F.Z({font:"12pt sans-serif",fill:new b.Z({color:"#FFFFF"}),text:t,overflow:!0,stroke:new m.Z({color:"rgba(0, 0, 0, 0.5)",width:3}),offsetX:0,offsetY:-15})}}),Object.defineProperty(this,re,{writable:!0,value:function(e){if("Point"!==e.getType())return null;var t=e.getCoordinates();return{n:t[1],e:t[0]}}}),Object.defineProperty(this,ne,{writable:!0,value:function(e){if(!e||0===(null===e||void 0===e?void 0:e.length))return null;e.forEach((function(e){(0,l.Z)(r,H)[H](e),(0,l.Z)(r,U)[U](e),(0,l.Z)(r,S)[S]&&e.set("USER_DRAWN",!0)}))}}),Object.defineProperty(this,ie,{writable:!0,value:function(e){if(!e||0===(null===e||void 0===e?void 0:e.length))return null;e.forEach((function(e){e.set("KML_IMPORT",!0),e.set("SHOW_TEXT",!0)}))}}),Object.defineProperty(this,oe,{writable:!0,value:function(){return(0,l.Z)(r,j)[j].getFeatures().filter((function(e){return!0===e.get("KML_IMPORT")}))}}),Object.defineProperty(this,ae,{writable:!0,value:function(){return(0,l.Z)(r,j)[j].getFeatures().length>0}}),Object.defineProperty(this,le,{writable:!0,value:function(){(0,l.Z)(r,P)[P].getView().fit((0,l.Z)(r,k)[k],{size:(0,l.Z)(r,P)[P].getSize(),padding:[20,20,20,20],maxZoom:7})}}),Object.defineProperty(this,ue,{writable:!0,value:function(e,t){var r,i=(0,n.Z)(e);try{for(i.s();!(r=i.n()).done;){r.value.setProperties(t)}}catch(o){i.e(o)}finally{i.f()}}}),this.importedKmlStillHasFeatures=function(e){return(0,l.Z)(r,j)[j].getFeatures().filter((function(t){return t.get("KML_ID")===e})).length>0},this.parseFeatures=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{prepareForMapInjection:!0},n=t.prepareForMapInjection;try{var i,o=null!==(i=(0,l.Z)(r,x)[x].readFeatures(e))&&void 0!==i?i:[];return(0,l.Z)(r,ie)[ie](o),n&&(0,l.Z)(r,ne)[ne](o),{features:o,error:null}}catch(a){return{features:[],error:a}}},this.import=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{zoomToExtent:!0},n=r.parseFeatures(e),i=n.features,o=n.error;return null!==o?{status:"FAILED",error:o}:(t.setProperties&&(0,l.Z)(r,ue)[ue](i,t.setProperties),(0,l.Z)(r,S)[S]?(0,l.Z)(r,S)[S].addKmlFeatures(i):(0,l.Z)(r,j)[j].addFeatures(i),(0,l.Z)(r,k)[k]=(0,l.Z)(r,j)[j].getExtent(),t.zoomToExtent&&r.zoomToCurrentExtent(),{status:"SUCCESS",error:null})},this.export=function(){var e=(0,l.Z)(r,j)[j].getFeatures().filter((function(e){return!0!==e.get("HIDDEN")}));if(!e||0===(null===e||void 0===e?void 0:e.length))return{status:"FAILED",error:"No features exist in the current kml-layer."};var t=(0,l.Z)(r,se)[se](e);if(0===t.length)return{status:"FAILED",error:"Could not transform any features to the .kml standard."};var n=(0,l.Z)(r,x)[x].writeFeatures(t,"".concat((0,l.Z)(r,E)[E],"-kml-export"));try{return(0,y.saveAs)(new Blob([n],{type:"application/vnd.google-earth.kml+xml;charset=utf-8"}),"Ritexport - ".concat((new Date).toLocaleString(),".kml")),{status:"SUCCESS",error:null}}catch(i){return{status:"FAILED",error:"Could not save the KML-file. File-saver Error."}}},Object.defineProperty(this,se,{writable:!0,value:function(e){var t=[];return e.forEach((function(e){var n=e.clone(),i=n.getGeometry()instanceof v.Z;if((0,l.Z)(r,S)[S]&&(n.set("EXTRACTED_STYLE",JSON.stringify((0,l.Z)(r,S)[S].extractFeatureStyleInfo(e))),n.set("TEXT_SETTINGS",JSON.stringify(e.get("TEXT_SETTINGS")))),i){var o=n.getGeometry();n.set("CIRCLE_RADIUS",o.getRadius()),n.set("CIRCLE_CENTER",JSON.stringify(o.getCenter()));var a=(0,h.Bb)(o,96);n.setGeometry(a)}n.getGeometry().transform((0,l.Z)(r,P)[P].getView().getProjection(),"EPSG:4326"),t.push(n)})),t}}),this.zoomToCurrentExtent=function(){(0,l.Z)(r,ae)[ae]()&&null!==(0,l.Z)(r,k)[k]&&!1===(0,l.Z)(r,k)[k].map(Number.isFinite).includes(!1)&&(0,l.Z)(r,le)[le]((0,l.Z)(r,k)[k])},this.removeImportedFeatures=function(){(0,l.Z)(r,oe)[oe]().forEach((function(e){(0,l.Z)(r,j)[j].removeFeature(e)})),(0,l.Z)(r,k)[k]=(0,l.Z)(r,j)[j].getExtent()},this.setLayer=function(e){(0,l.Z)(r,E)[E]=e,(0,l.Z)(r,C)[C](),(0,l.Z)(r,k)[k]=(0,l.Z)(r,j)[j].getExtent()},this.getCurrentLayerName=function(){return(0,l.Z)(r,E)[E]},this.getCurrentExtent=function(){return(0,l.Z)(r,k)[k]},!t.map||!t.layerName)return(0,l.Z)(this,L)[L]();(0,l.Z)(this,P)[P]=t.map,(0,l.Z)(this,E)[E]=t.layerName,(0,l.Z)(this,S)[S]=t.drawModel||null,(0,l.Z)(this,O)[O]=t.observer||null,t.enableDragAndDrop&&(0,l.Z)(this,D)[D](),(0,l.Z)(this,x)[x]=new p.ZP,(0,l.Z)(this,k)[k]=null,(0,l.Z)(this,C)[C]()}));t.default=ce}}]);
//# sourceMappingURL=8954.93600e2f.chunk.js.map