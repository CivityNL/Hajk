(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[7646],{77646:function(e,t,r){"use strict";r.r(t);var n=r(15671),o=r(43144),i=r(64665),a=r(18029),s=r(90927),l=r(66233),u=r(5400),d=r(5426),c=r(34951),g=r(29409),h=r(62652),v=r(42708),p=r(67738),y=r(96603),f=function(){function e(t){var r=this;(0,n.Z)(this,e),this.setTravelMode=function(e){r.travelMode=r.googleMapsApi.DirectionsTravelMode.hasOwnProperty(e)?r.googleMapsApi.DirectionsTravelMode[e]:"WALKING",r.travelModeLabel=r.travelModeLabels[r.travelMode],r.localObserver.publish("doneWithStep",3)},this.getCurrentPositionSuccess=function(e){r.position={latitude:e.coords.latitude,longitude:e.coords.longitude},r.setPosition()},this.getCurrentPositionError=function(e){console.error(e)},this.setPosition=function(){if(r.layer_start.getSource().clear(),r.position.longitude&&r.position.latitude){var e=new g.Z([r.position.longitude,r.position.latitude]),t=(0,v.vs)(e.getCoordinates(),"EPSG:4326",r.olMap.getView().getProjection());e.setCoordinates(t);var n=new h.Z({geometry:e});n.setStyle(r.style_start),r.layer_start.getSource().addFeature(n),r.olMap.getView().setCenter(e.getCoordinates()),r.localObserver.publish("doneWithStep",1),r.localObserver.publish("startModeSelected","gps")}},this.getLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(r.getCurrentPositionSuccess,r.getCurrentPositionError):window.alert("Kan inte f\xe5 position. Skriv startposition i rutan eller tryck position p\xe5 kartan.")},this.activateStartMode=function(){r.olMap.once("singleclick",r.startPointSelection)},this.startPointSelection=function(e){var t=new h.Z;t.setGeometry(new g.Z(e.coordinate));var n=(0,v.vs)(t.getGeometry().getCoordinates(),r.projection,"EPSG:4326"),o=n[0],i=n[1];r.layer_start.getSource().clear(),r.layer_start.getSource().addFeature(t),t.setStyle(r.style_start);var a=r.position;a.latitude=i,a.longitude=o,r.position=a,r.localObserver.publish("doneWithStep",1),r.localObserver.publish("startModeSelected","manual")},this.activateEndMode=function(){r.onEndKey=r.olMap.once("singleclick",r.endPointSelection)},this.endPointSelection=function(e){var t=new h.Z;t.setGeometry(new g.Z(e.coordinate));var n=(0,v.vs)(t.getGeometry().getCoordinates(),r.projection,"EPSG:4326"),o=n[0],i=n[1];r.layer_end.getSource().clear(),r.layer_end.getSource().addFeature(t),t.setStyle(r.style_end);var a=r.position;a.latitudeEnd=i,a.longitudeEnd=o,r.position=a,r.localObserver.publish("doneWithStep",2)},this.olMap=t.map,this.localObserver=t.localObserver,this.apiKey=t.options.apiKey,this.travelMode="WALKING",this.travelModeLabels={WALKING:"G\xe5",DRIVING:"K\xf6r",TRANSIT:"Kollektivtrafik",BICYCLING:"Cykla"},this.position={latitude:void 0,longitude:void 0,latitudeEnd:void 0,longitudeEnd:void 0},this.projection=t.app.config.mapConfig.map.projection,y({key:this.apiKey}).then((function(e){r.googleMapsApi=e})),this.initiateRoutingLayerInOpenLayersMap()}return(0,o.Z)(e,[{key:"generatePinIcon",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#000000",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"24",r='<?xml version="1.0" encoding="UTF-8"?>\n    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1"  width="'.concat(t,'" height="').concat(t,'" viewBox="0 0 ').concat(t," ").concat(t,'">\n    <path fill="').concat(e,'" d="M16,12V4H17V2H7V4H8V12L6,14V16H11.2V22H12.8V16H18V14L16,12Z" />\n    </svg>');return"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(r)}},{key:"initiateRoutingLayerInOpenLayersMap",value:function(){this.style_start=new i.ZP({image:new a.Z({src:this.generatePinIcon("#00a83b","36")})}),this.style_end=new i.ZP({image:new a.Z({src:this.generatePinIcon("#ff4747")})}),this.style_route=new i.ZP({image:new a.Z({src:this.generatePinIcon("#6e6e6e")})}),this.style_route_normal=this.style_route,this.style_route_highlight=new i.ZP({image:new a.Z({src:this.generatePinIcon("#47ff87")})}),this.layer_drawing_style=new i.ZP({fill:new s.Z({color:"rgba(255, 255, 255, 0.5)"}),stroke:new l.Z({color:"rgba(0, 0, 255, 0.5)",width:4}),image:new u.Z({radius:6,fill:new s.Z({color:"rgba(0, 0, 0, 0.5)"}),stroke:new l.Z({color:"rgba(255, 255, 255, 0.5)",width:2})})});var e=new d.Z({}),t=new d.Z({}),r=new d.Z({}),n=new d.Z({});void 0===this.layer_start&&(this.layer_start=new c.Z({layerType:"system",zIndex:5e3,source:e,name:"pluginRoutingStart",content:"point",queryable:!1,style:this.style_start}),this.layer_end=new c.Z({layerType:"system",zIndex:5e3,source:t,name:"pluginRoutingEnd",content:"point",queryable:!1,style:this.style_end}),this.layer_route=new c.Z({layerType:"system",zIndex:5e3,source:r,name:"pluginRoutingRoute",content:"point",queryable:!0,style:this.style_route}),this.layer_drawing=new c.Z({layerType:"system",zIndex:5e3,source:n,name:"pluginRoutingDrawing",content:"line",queryable:!1,style:this.layer_drawing_style}),this.olMap.addLayer(this.layer_start),this.olMap.addLayer(this.layer_end),this.olMap.addLayer(this.layer_route),this.olMap.addLayer(this.layer_drawing))}},{key:"activateRoutingMode",value:function(){this.searchTrip()}},{key:"searchTrip",value:function(){var e=this,t=this.position;if(void 0===t.latitude||void 0===t.longitude||void 0===t.latitudeEnd||void 0===t.longitudeEnd)this.localObserver.publish("startStopPointsMissing");else{var r=new this.googleMapsApi.DirectionsService,n={origin:{lat:t.latitude,lng:t.longitude},destination:{lat:t.latitudeEnd,lng:t.longitudeEnd},travelMode:this.travelMode};r.route(n,(function(t){switch(t.status){case"REQUEST_DENIED":e.localObserver.publish("requestDenied");break;case"ZERO_RESULTS":e.localObserver.publish("zeroResults");break;case"OK":e.plotRoute(t,e.map,e.layer_route,e.layer_drawing);break;default:e.localObserver.publish("otherError",t.status)}}))}}},{key:"plotRoute",value:function(e,t,r,n){r.getSource().clear();var o=e.routes[0].legs[0].steps,i=document.createElement("div"),a=document.createElement("p"),s=document.createElement("ol");a.innerHTML='\n                    <table class="table table-condensed">\n                      <tbody>\n                        <tr><td><b>F\xe4rds\xe4tt</b></td><td>'.concat(this.travelModeLabel,"</td></tr>\n                        <tr><td><b>Avst\xe5nd</b></td><td>").concat(e.routes[0].legs[0].distance.text," (").concat(e.routes[0].legs[0].distance.value," m)</td></tr>\n                        <tr><td><b>Tid</b></td><td>").concat(e.routes[0].legs[0].duration.text,"</td></tr>\n                        <tr><td><b>Startadress</b></td><td>").concat(e.routes[0].legs[0].start_address,"</td></tr>\n                        <tr><td><b>Slutadress</b></td><td>").concat(e.routes[0].legs[0].end_address,"</td></tr>\n                      </tbody>\n                    </table>\n                    "),i.appendChild(a);for(var l=0;l<o.length;l++){var u=o[l].start_location.lat(),d=o[l].start_location.lng(),c=new g.Z([d,u]),y=(0,v.vs)(c.getCoordinates(),"EPSG:4326",this.projection);c.setCoordinates(y);var f=l+1,w=new h.Z({geometry:c,info:o[l].instructions});w.number=""+f,w.setStyle(this.style_route),r.getSource().addFeature(w);var m=document.createElement("li");m.onclick=this.highlightFeature.bind(this),m.id="step_number"+f,m.innerHTML=o[l].instructions,s.appendChild(m)}i.appendChild(s);for(var b=document.getElementById("resultList");b.firstChild;)b.removeChild(b.firstChild);document.getElementById("resultList").appendChild(i);var _=new p.ZP({}).readGeometry(e.routes[0].overview_polyline,{dataProjection:"EPSG:4326",featureProjection:this.projection});n.getSource().clear();var S=new h.Z({type:"routing",geometry:_});S.setStyle(this.layer_drawing_style),n.getSource().addFeature(S);var Z=(this.position.latitude+this.position.latitudeEnd)/2,M=(this.position.longitude+this.position.longitudeEnd)/2;this.olMap.getView().setCenter((0,v.vs)([M,Z],"EPSG:4326",this.projection)),this.olMap.getView().fit(n.getSource().getExtent(),this.olMap.getSize())}},{key:"highlightFeature",value:function(e){var t=-1;t="B"===e.target.nodeName?e.target.parentNode.id.substring("step_number".length):e.target.id.substring("step_number".length);for(var r=this.layer_route.getSource().getFeatures(),n=0;n<r.length;n++)r[n].number===t?r[n].setStyle(this.style_route_highlight):r[n].setStyle(this.style_route_normal)}},{key:"drawRoute",value:function(e){var t=new p.ZP({}).readGeometry(e),r=new h.Z({type:"routing",geometry:t});r.setStyle(this.style_route),this.get("layer_drawing").getSource().addFeature(r)}},{key:"clearMap",value:function(){this.layer_start.getSource().clear(),this.layer_end.getSource().clear(),this.layer_route.getSource().clear(),this.layer_drawing.getSource().clear(),document.getElementById("resultList").innerHTML="",this.position={latitude:void 0,longitude:void 0,latitudeEnd:void 0,longitudeEnd:void 0}}}]),e}();t.default=f},96603:function(e){var t="https://maps.googleapis.com/maps/api/js",r="__googleMapsApiOnLoadCallback",n=["channel","client","key","language","region","v"],o=null;e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o=o||new Promise((function(o,i){var a=setTimeout((function(){window[r]=function(){},i(new Error("Could not load the Google Maps API"))}),e.timeout||1e4);window[r]=function(){null!==a&&clearTimeout(a),o(window.google.maps),delete window[r]};var s=document.createElement("script"),l=["callback=".concat(r)];n.forEach((function(t){e[t]&&l.push("".concat(t,"=").concat(e[t]))})),e.libraries&&e.libraries.length&&l.push("libraries=".concat(e.libraries.join(","))),s.src="".concat(e.apiUrl||t,"?").concat(l.join("&")),document.body.appendChild(s)}))}},67738:function(e,t,r){"use strict";r.d(t,{ZP:function(){return f}});var n=r(15671),o=r(43144),i=r(60136),a=r(29388),s=r(62652),l=r(35844),u=r(43017),d=r(16862);function c(e,t,r,n,o,i){void 0!==o?i=void 0!==i?i:0:(o=[],i=0);for(var a=t;a<r;){var s=e[a++];o[i++]=e[a++],o[i++]=s;for(var l=2;l<n;++l)o[i++]=e[a++]}return o.length=i,o}var g=r(42708),h=r(52952),v=r(56861),p=r(49791);function y(e){for(var t,r="";e>=32;)t=63+(32|31&e),r+=String.fromCharCode(t),e>>=5;return t=e+63,r+=String.fromCharCode(t)}var f=function(e){(0,i.Z)(r,e);var t=(0,a.Z)(r);function r(e){var o;return(0,n.Z)(this,r),e=e||{},(o=t.call(this)).dataProjection=(0,g.U2)("EPSG:4326"),o.factor_=e.factor?e.factor:1e5,o.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY",o}return(0,o.Z)(r,[{key:"readFeatureFromText",value:function(e,t){var r=this.readGeometryFromText(e,t);return new s.Z(r)}},{key:"readFeaturesFromText",value:function(e,t){return[this.readFeatureFromText(e,t)]}},{key:"readGeometryFromText",value:function(e,t){var r=(0,h.tP)(this.geometryLayout_),n=function(e,t,r){var n;r=r||1e5;var o=new Array(t);for(n=0;n<t;++n)o[n]=0;for(var i=function(e,t){t=t||1e5;for(var r=function(e){for(var t=function(e){for(var t=[],r=0,n=0,o=0,i=e.length;o<i;++o){var a=e.charCodeAt(o)-63;r|=(31&a)<<n,a<32?(t.push(r),r=0,n=0):n+=5}return t}(e),r=0,n=t.length;r<n;++r){var o=t[r];t[r]=1&o?~(o>>1):o>>1}return t}(e),n=0,o=r.length;n<o;++n)r[n]/=t;return r}(e,r),a=0,s=i.length;a<s;)for(n=0;n<t;++n,++a)o[n]+=i[a],i[a]=o[n];return i}(e,r,this.factor_);c(n,0,n.length,r,n);var o=(0,v.Ml)(n,0,n.length,r),i=new l.Z(o,this.geometryLayout_);return(0,p.fI)(i,!1,this.adaptOptions(t))}},{key:"writeFeatureText",value:function(e,t){var r=e.getGeometry();return r?this.writeGeometryText(r,t):((0,d.h)(!1,40),"")}},{key:"writeFeaturesText",value:function(e,t){return this.writeFeatureText(e[0],t)}},{key:"writeGeometryText",value:function(e,t){var r=(e=(0,p.fI)(e,!0,this.adaptOptions(t))).getFlatCoordinates(),n=e.getStride();return c(r,0,r.length,n,r),function(e,t,r){var n;r=r||1e5;var o=new Array(t);for(n=0;n<t;++n)o[n]=0;for(var i=0,a=e.length;i<a;)for(n=0;n<t;++n,++i){var s=e[i],l=s-o[n];o[n]=s,e[i]=l}return function(e,t){t=t||1e5;for(var r=0,n=e.length;r<n;++r)e[r]=Math.round(e[r]*t);return function(e){for(var t=0,r=e.length;t<r;++t){var n=e[t];e[t]=n<0?~(n<<1):n<<1}return function(e){for(var t="",r=0,n=e.length;r<n;++r)t+=y(e[r]);return t}(e)}(e)}(e,r)}(r,n,this.factor_)}}]),r}(u.Z)}}]);
//# sourceMappingURL=7646.94dd2986.chunk.js.map