"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[4567],{74567:function(e,t,n){n.r(t);var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(72791),l=n(76863),d=n(50228),u=n(4565),c=n(78506),h=n.n(c),p=n(61091),m=n(43595),f=n(59911),v=n(45473),F=n(63818),g=n(50120),x=n(81898),k=n(54871),j=n(72900),y=n(88264),b=n(67394),D=n(32232),T=n(44366),Z=n(98246),S=n(80184),C=(0,l.ZP)("div")((function(){return{height:"calc(100% - 60px)",overflowX:"hidden",borderBottom:"1px solid #ccc"}})),E=(0,l.ZP)("div")((function(){return{paddingBottom:"10px"}})),A=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;if((0,r.Z)(this,n),(i=t.call(this,e)).save=function(){i.props.model.save((function(e){if(e&&e.TransactionResponse&&e.TransactionResponse.TransactionSummary&&e.TransactionResponse.TransactionSummary.totalInserted){var t=e.TransactionResponse.TransactionSummary.totalInserted.toString();Number(t)>0?i.props.options.showThankYou?i.setState({displayThankYou:!0}):i.setState({displayThankYou:!0},(function(){i.props.model.observer.publish("abort")})):i.saveError()}else i.saveError()}),(function(e){i.saveError()}))},i.saveError=function(){i.props.model.globalObserver.publish("core.alert","Det gick inte att spara, f\xf6rs\xf6k igen senare.")},i.createMarkup=function(){return{__html:i.props.options.thankYou}},e.page.text){var a=h().html2json(e.page.text);i.state={json:a,displayThankYou:!1},i.formErrors={}}return i}return(0,i.Z)(n,[{key:"getError",value:function(e){return this.formErrors.hasOwnProperty(e.name)?(0,S.jsx)("div",{children:this.formErrors[e.name]}):null}},{key:"checkInteger",value:function(e,t){var n=Object.assign({},this.props.model.formValues);/^\d+$/.test(t)||""===t?n[e]=t:this.props.model.formValues[e]||(n[e]=""),this.props.model.formValues=n,this.forceUpdate()}},{key:"checkNumber",value:function(e,t){var n=Object.assign({},this.props.model.formValues);/^\d+([.,](\d+)?)?$/.test(t)||""===t?(t=t.replace(",","."),n[e]=t):this.props.model.formValues[e]||(n[e]=""),this.props.model.formValues=n,this.forceUpdate()}},{key:"checkUrl",value:function(e,t){var n=/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!$&'()*+,;=]|:|@)|\/|\?)*)?$/i.test(t),r=Object.assign({},this.props.model.formValues);n||""===t?(r[e]=t,delete this.formErrors[e]):(r[e]="",this.formErrors[e]="Ange en giltig url. t.ex. https://www.example.com"),this.props.model.formValues=r,this.forceUpdate()}},{key:"checkText",value:function(e,t){var n=Object.assign({},this.props.model.formValues);n[e]=t,this.props.model.formValues=n,this.forceUpdate()}},{key:"checkSelect",value:function(e,t){var n=Object.assign({},this.props.model.formValues);n[e]=t,this.props.model.formValues=n,this.forceUpdate()}},{key:"checkMultiple",value:function(e,t,n,r){var i=Object.assign({},this.props.model.formValues);i[e][r].checked=t,this.props.model.formValues=i,this.forceUpdate()}},{key:"checkDate",value:function(e,t){var n=Object.assign({},this.props.model.formValues);n[e]=t,this.props.model.formValues=n,this.forceUpdate()}},{key:"getValueMarkup",value:function(e,t){var n=this;if(!e)return null;"int"===e.dataType&&(e.textType="heltal"),"number"===e.dataType&&(e.textType="nummer"),"date"===e.dataType&&(e.textType="datum");var r=this.props.model.formValues[e.name];switch(void 0!==r&&null!==r||(r=""),""===r&&e.initialRender&&null!==e.defaultValue&&(r=e.defaultValue),Array.isArray(t)&&(t=t.join(" ")),e.textType){case"heltal":return(0,S.jsx)(f.Z,{id:e.id,label:t||e.name,sx:{minWidth:"60%"},margin:"normal",value:r,onChange:function(t){n.checkInteger(e.name,t.target.value),e.initialRender=!1}});case"nummer":return(0,S.jsx)(f.Z,{id:e.id,label:t||e.name,sx:{minWidth:"60%"},margin:"normal",value:r,onChange:function(t){n.checkNumber(e.name,t.target.value),e.initialRender=!1}});case"datum":return(0,S.jsx)(f.Z,{id:e.id,label:t||e.name,sx:{minWidth:"60%"},type:"datetime-local",margin:"normal",value:r,onChange:function(t){n.checkDate(e.name,t.target.value),e.initialRender=!1},InputLabelProps:{shrink:!0}});case"url":case"fritext":return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(f.Z,{id:e.id,multiline:!0,label:t||e.name,sx:{minWidth:"60%"},margin:"normal",value:r,onChange:function(t){n.checkText(e.name,t.target.value),e.initialRender=!1},onBlur:function(t){"url"===e.textType&&n.checkUrl(e.name,t.target.value),e.initialRender=!1}}),this.getError(e)]});case"flerval":var i=[];"string"===typeof e.defaultValue&&(i=e.defaultValue.split(",")),e.initialRender&&i.forEach((function(e){r.forEach((function(t){e===t.value&&(t.checked=!0)}))}));var a=e.values.map((function(t,i){var a=e.name+i,o=Array.isArray(r)&&r.find((function(e){return e.value===t}))||{checked:!1};return(0,S.jsx)(j.Z,{control:(0,S.jsx)(v.Z,{checked:o.checked,onChange:function(r){n.checkMultiple(e.name,r.target.checked,t,i),e.initialRender=!1}}),label:t},a)}));return(0,S.jsx)("div",{children:(0,S.jsxs)(x.Z,{component:"fieldset",children:[(0,S.jsx)(g.Z,{component:"legend",children:t||e.name}),(0,S.jsx)(k.Z,{children:a})]})});case"lista":var o=[];return Array.isArray(e.values)&&(o=e.values.map((function(e,t){return(0,S.jsx)("option",{value:e,children:e},t)})),void 0!==e.defaultValue&&""!==e.defaultValue||o.unshift((0,S.jsx)("option",{value:"",children:"-V\xe4lj v\xe4rde-"},"-1"))),r&&""!==r||!e.defaultValue||(r=e.defaultValue,!1!==e.initialRender&&setTimeout((function(){n.checkSelect(e.name,r)}),0)),(0,S.jsx)("div",{children:(0,S.jsxs)(x.Z,{component:"fieldset",children:[(0,S.jsx)(g.Z,{component:"legend",children:t||e.name}),(0,S.jsx)(F.Z,{value:r,input:(0,S.jsx)(m.Z,{name:e.name,id:e.name}),onChange:function(t){n.checkSelect(e.name,t.target.value),e.initialRender=!1},children:o})]})});default:return(0,S.jsx)("span",{children:r})}}},{key:"getFieldConfig",value:function(e){return this.props.serviceConfig.editableFields.find((function(t){return t.name===e}))}},{key:"renderFromAttribute",value:function(e){var t=this;return e?e.type&&"toolbar"===e.type?(0,S.jsx)(T.default,{ref:"toolbar",field:e.field,geotype:e.geotype,serviceConfig:this.props.serviceConfig,enabled:!0,model:this.props.model,onChangeTool:function(){window.innerWidth<600&&(t.props.model.globalObserver.publish("core.minimizeWindow"),t.props.enqueueSnackbar("Klicka i kartan f\xf6r att rita objekt"))}}):e.field?this.getValueMarkup(this.getFieldConfig(e.field),e.label):void 0:null}},{key:"renderFromJsonDom",value:function(e){var t=this;return e&&e.child?e.child.map((function(e,n){if("element"===e.node)switch(e.tag){case"div":return(0,S.jsxs)("div",{children:[t.renderFromAttribute(e.attr),t.renderFromJsonDom(e)]},n);case"p":return(0,S.jsxs)("p",{children:[t.renderFromAttribute(e.attr),t.renderFromJsonDom(e)]},n);case"label":return(0,S.jsx)("label",{children:t.renderFromJsonDom(e)},n);case"h1":return(0,S.jsx)(u.Z,{variant:"h1",children:t.renderFromJsonDom(e)},n);case"h2":return(0,S.jsx)(u.Z,{variant:"h2",children:t.renderFromJsonDom(e)},n);case"h3":return(0,S.jsx)(u.Z,{variant:"h3",children:t.renderFromJsonDom(e)},n);case"h4":return(0,S.jsx)(u.Z,{variant:"h4",children:t.renderFromJsonDom(e)},n);case"h5":return(0,S.jsx)(u.Z,{variant:"h5",children:t.renderFromJsonDom(e)},n);case"h6":return(0,S.jsx)(u.Z,{variant:"h6",children:t.renderFromJsonDom(e)},n);case"a":return(0,S.jsx)("a",{href:e.attr.href,rel:"noopener noreferrer",target:"_blank",children:t.renderFromJsonDom(e)},n);case"ul":return(0,S.jsx)("ul",{children:t.renderFromJsonDom(e)},n);case"li":return(0,S.jsx)("li",{children:t.renderFromJsonDom(e)},n);case"br":return(0,S.jsx)("br",{},n);case"img":return(0,S.jsx)("img",{src:e.attr.src,width:e.attr.width,height:e.attr.height,alt:e.attr.alt,children:t.renderFromJsonDom(e)},n);default:return null}return"text"===e.node?(0,S.jsx)("span",{children:e.text},n):null})):null}},{key:"renderButtons",value:function(){var e=this,t=this.props,n=t.page,r=t.numPages,i=t.onPrevPage,a=t.onNextPage,o=(0,S.jsx)(p.Z,{variant:"contained",sx:{float:"left",margin:1},onClick:function(){"undefined"!==typeof e.refs.toolbar&&e.refs.toolbar.storeValues(),i()},children:(0,S.jsx)(b.Z,{})}),s=(0,S.jsx)(p.Z,{variant:"contained",sx:{float:"right",margin:1},onClick:function(){"undefined"!==typeof e.refs.toolbar&&e.refs.toolbar.storeValues(),a()},children:(0,S.jsx)(y.Z,{})}),l=(0,S.jsx)(p.Z,{variant:"contained",sx:{float:"right",margin:1},onClick:this.save,children:"Skicka"}),d=(0,S.jsx)(p.Z,{variant:"contained",sx:{float:"right",margin:1},onClick:function(){e.props.model.observer.publish("abort")},children:this.props.options.collectAgain?"Tyck till igen":"St\xe4ng"}),u=(0,S.jsx)(p.Z,{variant:"contained",sx:{float:"right",margin:1},onClick:function(){e.props.model.app.windows.forEach((function(e){"collector"===e.type&&e.closeWindow()}))},children:"St\xe4ng"});return this.state.displayThankYou?this.props.options.collectAgain?(0,S.jsxs)("div",{children:[d,u]}):(0,S.jsx)("div",{children:d}):1===r?(0,S.jsx)("div",{children:l}):r>1&&n.order===r-1?(0,S.jsxs)("div",{children:[o,l]}):n.order>0&&n.order<r-1?(0,S.jsxs)("div",{children:[o,s]}):0===n.order?(0,S.jsx)("div",{children:s}):null}},{key:"renderThankYou",value:function(){return(0,S.jsx)("div",{dangerouslySetInnerHTML:this.createMarkup()})}},{key:"renderSlide",value:function(){var e=this.props.page,t=this.state.json;return(0,S.jsx)(D.Z,{direction:this.props.direction||"left",in:!0,mountOnEnter:!0,unmountOnExit:!0,sx:{height:"100%"},children:(0,S.jsxs)("div",{children:[(0,S.jsx)(u.Z,{variant:"h4",children:e.header}),(0,S.jsx)(E,{children:this.renderFromJsonDom(t)})]})})}},{key:"render",value:function(){var e=this.state.displayThankYou;return this.props.active&&(0,S.jsxs)(d.Z,{sx:{height:"100%"},children:[(0,S.jsx)(C,{children:e?this.renderThankYou():this.renderSlide()}),(0,S.jsx)("div",{children:this.renderButtons()})]})}}]),n}(s.Component);t.default=(0,Z.RM)(A)},44366:function(e,t,n){n.r(t);var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(72791),l=n(76863),d=n(61091),u=n(16426),c=n(21456),h=n(43526),p=n(4565),m=n(27982),f=n(80184),v=(0,l.ZP)(d.Z)((function(e){return{margin:e.theme.spacing(1),width:"115px"}})),F=(0,l.ZP)("div")((function(e){e.theme;return{margin:"5px"}})),g=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;if((0,r.Z)(this,n),(i=t.call(this,e)).state={activeTool:void 0},i.props.model.observer.subscribe("abortInteraction",(function(){i.setState({activeTool:void 0})})),i.props.model.wkt){i.props.model.vectorSource.clear();var a=new m.Z,o=i.props.model.formValues[i.props.field];if(o&&o.length>0)a.readFeatures(o).forEach((function(e){i.props.model.vectorSource.addFeature(e)}))}return i}return(0,i.Z)(n,[{key:"componentWillUnmount",value:function(){this.props.model.observer.unsubscribe("abortInteraction"),this.props.model.deactivateInteraction()}},{key:"changeTool",value:function(e,t){var n=this.props.model;if(this.props.onChangeTool(),t&&this.state.activeTool===t.toLowerCase())return n.deactivateInteraction(),this.setState({activeTool:void 0});if(this.state.activeTool===e)return n.deactivateInteraction(),this.setState({activeTool:void 0});switch(n.deactivateInteraction(),e){case"add":n.activateInteraction("add",t);break;case"remove":n.activateInteraction("remove");break;case"modify":n.activateInteraction("modify");break;case"move":n.activateInteraction("move")}}},{key:"onAddPointClicked",value:function(){this.setState({activeTool:"point"}),this.changeTool("add","Point")}},{key:"onAddLineClicked",value:function(){this.setState({activeTool:"linestring"}),this.changeTool("add","LineString")}},{key:"onAddPolygonClicked",value:function(){this.setState({activeTool:"polygon"}),this.changeTool("add","Polygon")}},{key:"getStatusMessage",value:function(e){return e?e.ExceptionReport?(0,f.jsxs)(p.Z,{children:["Uppdateringen misslyckades:"," ",e.ExceptionReport.Exception.ExceptionText.toString()]}):e.TransactionResponse&&e.TransactionResponse.TransactionSummary?(0,f.jsxs)("div",{children:[(0,f.jsx)(p.Z,{children:"Uppdateringen lyckades."}),(0,f.jsxs)(p.Z,{children:["Antal skapade objekt:"," ",e.TransactionResponse.TransactionSummary.totalInserted.toString()]}),(0,f.jsxs)(p.Z,{children:["Antal borttagna objekt:"," ",e.TransactionResponse.TransactionSummary.totalDeleted.toString()]}),(0,f.jsxs)(p.Z,{children:["Antal uppdaterade objekt:"," ",e.TransactionResponse.TransactionSummary.totalUpdated.toString()]})]}):(0,f.jsx)(p.Z,{children:"Status f\xf6r uppdateringen kunde inte avl\xe4sas ur svaret fr\xe5n servern."}):(0,f.jsx)(p.Z,{children:"Uppdateringen lyckades men det uppt\xe4cktes inte n\xe5gra \xe4ndringar."})}},{key:"onSaveClicked",value:function(){var e=this;this.props.model.editSource&&this.props.model.save((function(t){e.props.model.filty=!1,e.props.model.refreshEditingLayer(),e.props.app.globalObserver.publish("core.alert",e.getStatusMessage(t))}))}},{key:"onCancelClicked",value:function(){this.props.model.deactivate(),this.props.panel.setState({checked:!1,enabled:!1,selectedSource:!1}),this.setState({activeTool:void 0})}},{key:"getSelectedStyle",value:function(e){var t={};return e===this.state.activeTool&&(t.backgroundColor="#ccc"),t}},{key:"storeValues",value:function(){if(this.props.model.wkt){var e=new m.Z,t="";this.props.model.vectorSource.getFeatures().length>0&&(t=e.writeFeatures(this.props.model.vectorSource.getFeatures()));var n=Object.assign({},this.props.model.formValues);n[this.props.field]=t,this.props.model.formValues=n,this.props.model.vectorSource.clear()}}},{key:"render",value:function(){var e=this,t=this.props.serviceConfig,n=!this.props.enabled,r=!1,i=!1,a=!1;return this.props.model.wkt?(r=-1!==this.props.geotype.indexOf("point"),i=-1!==this.props.geotype.indexOf("polygon"),a=-1!==this.props.geotype.indexOf("line")):t&&(r=t.editPoint,a=t.editLine,i=t.editPolygon),(0,f.jsx)("div",{children:(0,f.jsx)(F,{children:(0,f.jsxs)("div",{children:[(0,f.jsxs)(v,{variant:"contained",disabled:!1===n?!r:n,onClick:function(){e.onAddPointClicked()},type:"button",title:"L\xe4gg till plats",style:this.getSelectedStyle("point"),children:["Plats",(0,f.jsx)(u.Z,{sx:{marginLeft:1}})]}),(0,f.jsxs)(v,{variant:"contained",disabled:!1===n?!a:n,onClick:function(){e.onAddLineClicked()},type:"button",title:"L\xe4gg till str\xe4cka",style:this.getSelectedStyle("linestring"),children:["Str\xe4cka",(0,f.jsx)(h.Z,{sx:{marginLeft:1}})]}),(0,f.jsxs)(v,{variant:"contained",disabled:!1===n?!i:n,onClick:function(){e.onAddPolygonClicked()},type:"button",title:"L\xe4gg till omr\xe5de",style:this.getSelectedStyle("polygon"),children:["Omr\xe5de",(0,f.jsx)(c.Z,{sx:{marginLeft:1}})]})]})})})}}]),n}(s.Component);t.default=g}}]);
//# sourceMappingURL=4567.aaf3c2cf.chunk.js.map