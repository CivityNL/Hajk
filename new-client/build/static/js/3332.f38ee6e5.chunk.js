"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[3332,647],{43332:function(e,t,r){r.r(t);var n=r(15671),i=r(43144),a=r(60136),s=r(29388),l=r(72791),o=r(54164),c=r(17428),u=r(61091),d=r(45953),h=r(11601),g=r(75814),m=r(34951),S=r(647),f=r(49392),y=r(24137),v=r(2325),p=r(4606),x=r(66120),j=r(80184),Z=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e){var i,a,s;return(0,n.Z)(this,r),(s=t.call(this,e)).bindSubscriptions=function(){s.localObserver.subscribe("initiateTimeSliderView",(function(){s.initiateTimeSliderView()})),s.localObserver.subscribe("resetTimeSliderView",(function(){s.resetTimeSliderView()})),s.localObserver.subscribe("resetTimeSlider",(function(){s.resetTimeSlider()})),s.localObserver.subscribe("toggleSlider",(function(e){s.toggleSlider(e)}))},s.validateLayers=function(){var e=s.props.layers,t={error:!1,errorType:"",faultyLayers:[]};return 0===e.length&&(t.error=!0,t.errorType="layers_missing"),e.forEach((function(e){e.get("timeSliderStart")&&e.get("timeSliderEnd")||(t.error=!0,t.errorType="layer_error",t.faultyLayers.push({layerId:e.get("name"),layerError:"date_missing"})),e.get("timeSliderStart")===e.get("timeSliderEnd")&&(t.error=!0,t.errorType="layer_error",t.faultyLayers.push({layerId:e.get("name"),layerError:"date_start_equals_end"}))})),t},s.initiateTimeSliderView=function(){s.setState({currentUnixTime:s.startTime},(function(){s.initiateTimeLineLayers(),s.refreshLayers()}))},s.resetTimeSliderView=function(){s.resetTimeSlider(),s.resetTimeLineLayers()},s.resetTimeSlider=function(){s.toggleSlider(!1),s.localObserver.publish("updateHeaderTitle",""),s.setState({currentUnixTime:s.startTime},(function(){s.refreshLayers()}))},s.initiateTimeLineLayers=function(){s.layers.forEach((function(e){var t=e.getSource();e instanceof m.Z?(t.originalStyleFunction=e.getStyleFunction(),t.on("addfeature",s.handleFeatureAdded),e.setStyle(null)):t.updateParams({TIME:new Date(s.state.currentUnixTime).toISOString()}),e.setVisible(!0)}))},s.resetTimeLineLayers=function(){s.layers.forEach((function(e){var t=e.getSource();e instanceof m.Z?(t.un("addfeature",s.handleFeatureAdded),e.setStyle(t.originalStyleFunction),e.setVisible(!1)):(t.updateParams({TIME:void 0}),e.setVisible(!1))}))},s.handleFeatureAdded=function(e){var t=e.target,r=e.feature;s.getTimeSliderLayerStyle(r,t.originalStyleFunction)},s.refreshLayers=function(){s.layers.forEach((function(e){e instanceof m.Z?e.getSource().refresh():e.getSource().updateParams({TIME:new Date(s.startTime).toISOString()})}))},s.getUnixTimeFromString=function(e){var t=e.substr(0,4),r=e.substr(4,2),n=e.substr(6,2);return new Date("".concat(t,"-").concat(r,"-").concat(n)).getTime()},s.getTime=function(e){var t=void 0;return s.layers.forEach((function(r){var n=r.get(e);if(n){var i=s.getUnixTimeFromString(n);t||(t=i),("timeSliderStart"===e&&t>i||"timeSliderEnd"===e&&t<i)&&(t=i)}})),t},s.shouldFeatureShow=function(e){var t=s.state.currentUnixTime,r=e.get("start"),n=e.get("end");if(!r||!n)return!1;var i=new Date(r),a=new Date(n);return(!i.getTime()>0||!a.getTime()>0)&&(i=s.getUnixTimeFromString(r),a=s.getUnixTimeFromString(n)),i<=t&&a>=t},s.toggleSlider=function(e){s.setState({playing:e}),s.localObserver.publish("toggleHeaderPlayButton",e),e?(clearInterval(s.sliderTimer),s.sliderTimer=null,s.sliderTimer=setInterval((function(){var e=s.state.currentUnixTime+s.state.stepSize;e>=s.endTime&&(e=s.endTime,clearInterval(s.sliderTimer),s.localObserver.publish("toggleHeaderPlayButton",!1),s.setState({playing:!1})),s.handleSliderChange(e)}),s.state.sliderSpeed)):clearInterval(s.sliderTimer)},s.getStepSize=function(e){var t=864e5;switch(e){case"years":return 365*t;case"months":return 31*t;default:return t}},s.setNextDate=function(e){var t=s.state,r=t.currentUnixTime,n=t.resolution,i=new Date(r),a=new Date(e);return"years"===n?i.getFullYear()===a.getFullYear()&&(r<=e?a.setFullYear(i.getFullYear()+1):a.setFullYear(i.getFullYear()-1)):"months"===n?i.getMonth()===a.getMonth()&&(r<=e?a.setMonth(i.getMonth()+1):a.setMonth(i.getMonth()-1)):i.getDay()===a.getDay()&&(r<=e?a.setDate(i.getDate()+1):a.setDate(i.getDate()-1)),a},s.handleSliderChange=function(e){var t=s.setNextDate(e);s.setState({currentUnixTime:t.getTime()},(function(){s.updateLayers(),s.updateHeader()}))},s.updateHeader=function(){var e=s.state,t=e.currentUnixTime,r=e.resolution;s.localObserver.publish("updateHeaderTitle",s.getDateLabel(t,r))},s.getDateLabel=function(e,t){var r={},n=new Date(e);switch(t){case"years":r={year:"numeric"};break;case"months":r={month:"long",year:"numeric"};break;default:r={day:"numeric",month:"long",year:"numeric"}}return n.toLocaleString("default",r)},s.getShortDateLabel=function(e,t){var r={},n=new Date(e);switch(t){case"years":r={year:"numeric"};break;case"months":r={month:"short",year:"numeric"};break;default:r={day:"numeric",month:"short"}}return n.toLocaleString("default",r)},s.updateLayers=function(){var e=s.map.getView().calculateExtent();s.layers.map((function(t){var r=t.getSource();return t instanceof m.Z?r.forEachFeatureInExtent(e,(function(e){s.getTimeSliderLayerStyle(e,r.originalStyleFunction)})):r.updateParams({TIME:new Date(s.state.currentUnixTime).toISOString()})}))},s.createMarks=function(e,t,r){for(var n=[],i=Math.floor(e/(r-1)),a=0;a<r;a++){var l=s.startTime+i*a;n.push({value:l,label:s.getShortDateLabel(l,t)})}return n},s.getMarks=function(e){var t=s.endTime-s.startTime,r=Math.floor(t/2592e6);return s.markResolution=r>=12*e?"years":r>=e?"months":"days",s.createMarks(t,s.markResolution,e)},s.handleResolutionChange=function(e){s.setState({resolution:e,stepSize:s.getStepSize(e)})},s.handleSliderSpeedChange=function(e){s.setState({sliderSpeed:e},(function(){s.toggleSlider(s.state.playing)}))},s.renderSettingsDialog=function(){var e=s.state,t=e.settingsDialog,r=e.resolution,n=e.sliderSpeed,i=e.layerStatus;return t?(0,o.createPortal)((0,j.jsx)(f.default,{options:{text:(0,j.jsx)(S.default,{layers:s.layers,layerStatus:i,resolution:r,sliderSpeed:n,handleResolutionChange:s.handleResolutionChange,handleSliderSpeedChange:s.handleSliderSpeedChange}),headerText:"Tidslinjeinst\xe4llningar",buttonText:"OK",useLegacyNonMarkdownRenderer:!0},open:t,onClose:function(){s.setState({settingsDialog:!1})}}),document.getElementById("windows-container")):null},s.renderSettingsButton=function(){var e=s.state.layerStatus;return(0,j.jsx)(c.Z,{color:"error",invisible:!e.error,badgeContent:"".concat(e.faultyLayers.length>0?e.faultyLayers.length:1),children:(0,j.jsx)(u.Z,{variant:"contained",onClick:function(){s.setState({settingsDialog:!s.state.settingsDialog})},children:(0,j.jsx)(x.Z,{})})})},s.state={playing:!1,resolution:null!==(i=s.props.defaultResolution)&&void 0!==i?i:"years",stepSize:s.getStepSize(null!==(a=s.props.defaultResolution)&&void 0!==a?a:"years"),loadingError:!0,layerStatus:s.validateLayers(),settingsDialog:!1,sliderSpeed:1e3},s.map=e.map,s.layers=e.layers,s.startTime=s.getTime("timeSliderStart"),s.endTime=s.getTime("timeSliderEnd"),s.marks=s.getMarks(5),s.markResolution="",s.localObserver=e.localObserver,s.bindSubscriptions(),s}return(0,i.Z)(r,[{key:"componentDidMount",value:function(){!0===this.props.visibleAtStart&&this.initiateTimeSliderView()}},{key:"getTimeSliderLayerStyle",value:function(e,t){this.shouldFeatureShow(e)?e.setStyle(t):e.setStyle(null)}},{key:"render",value:function(){var e=this,t=this.state,r=t.currentUnixTime,n=t.stepSize,i=t.playing;return r?(0,j.jsxs)(d.ZP,{container:!0,sx:{padding:2},children:[(0,j.jsx)(j.Fragment,{children:this.renderSettingsDialog()}),(0,j.jsx)(d.ZP,{item:!0,xs:12,sx:{paddingLeft:"years"===this.markResolution?2:"months"===this.markResolution?4:6,paddingRight:"years"===this.markResolution?2:"months"===this.markResolution?4:6},children:(0,j.jsx)(h.ZP,{size:"small",value:r,min:this.startTime,max:this.endTime,step:n,marks:this.marks,onChange:function(t,n){n!==r&&e.handleSliderChange(n)}})}),(0,j.jsxs)(d.ZP,{container:!0,direction:"row",justifyContent:"center",alignItems:"center",spacing:2,children:[(0,j.jsx)(d.ZP,{item:!0,align:"center",xs:4,children:(0,j.jsx)(g.Z,{disableInteractive:!0,title:i?"Stoppa tidslinjen":"Starta tidslinjen",children:(0,j.jsx)(u.Z,{variant:"contained",onClick:function(){e.toggleSlider(!i)},children:i?(0,j.jsx)(v.Z,{}):(0,j.jsx)(y.Z,{})})})}),(0,j.jsx)(d.ZP,{item:!0,align:"center",xs:4,children:(0,j.jsx)(g.Z,{disableInteractive:!0,title:"\xc5terst\xe4ll tidslinjen",children:(0,j.jsx)(u.Z,{variant:"contained",onClick:this.resetTimeSlider,children:(0,j.jsx)(p.Z,{})})})}),(0,j.jsx)(d.ZP,{item:!0,align:"center",xs:4,children:(0,j.jsx)(g.Z,{disableInteractive:!0,title:"Inst\xe4llningar",children:this.renderSettingsButton()})})]})]}):(0,j.jsxs)(d.ZP,{container:!0,alignItems:"center",justifyContent:"center",sx:{width:"100%",height:"100%"},children:[(0,j.jsx)(j.Fragment,{children:this.renderSettingsDialog()}),(0,j.jsx)(d.ZP,{item:!0,children:this.renderSettingsButton()})]})}}]),r}(l.PureComponent);t.default=Z},647:function(e,t,r){r.r(t);var n=r(15671),i=r(43144),a=r(60136),s=r(29388),l=r(72791),o=r(75814),c=r(71770),u=r(45953),d=r(4565),h=r(81898),g=r(63381),m=r(35702),S=r(37924),f=r(45629),y=r(35110),v=r(65514),p=r(4346),x=r(73369),j=r(91964),Z=r(80184),T=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).renderLayerList=function(){var e=i.props,t=e.layers,r=e.layerStatus;return(0,Z.jsx)(f.Z,{children:t.map((function(e,t){var n=e.get("name"),a=e.get("visible"),s=!1,l="";return r.faultyLayers.filter((function(e){return e.layerId===n})).forEach((function(e){s=!0,l=e.layerError})),(0,Z.jsxs)(y.ZP,{sx:{borderLeft:function(e){return"".concat(e.spacing(.5)," solid ").concat(s?e.palette.error.main:e.palette.success.main)}},disabled:!a,children:[s&&(0,Z.jsx)(o.Z,{disableInteractive:!0,title:"".concat(s?"date_start_equals_end"===l?"Start- och slutdatumet p\xe5 lagret har samma v\xe4rde!":"Start- eller slutdatumet p\xe5 lagret saknas!":"Lagret ser okej ut!"),children:(0,Z.jsx)(v.Z,{children:(0,Z.jsx)(j.Z,{})})},"tt_".concat(t)),(0,Z.jsx)(p.Z,{primary:e.get("caption")}),(0,Z.jsx)(x.Z,{children:(0,Z.jsx)(o.Z,{disableInteractive:!0,title:a?"D\xf6lj lager":"Visa lager",children:(0,Z.jsx)(c.Z,{checked:a,onChange:function(){e.setVisible(!a),i.setState({time:new Date})},name:"checkedA",inputProps:{"aria-label":"secondary checkbox"}})})})]},t)}))})},i.renderSettingsContainer=function(){var e=i.props,t=e.sliderSpeed,r=e.resolution,n=e.handleResolutionChange,a=e.handleSliderSpeedChange;return(0,Z.jsxs)(u.ZP,{container:!0,spacing:2,children:[(0,Z.jsx)(u.ZP,{item:!0,xs:6,children:(0,Z.jsxs)(h.Z,{fullWidth:!0,children:[(0,Z.jsxs)(g.Z,{variant:"standard",labelId:"select-stepSize-label",id:"select-stepSize",value:t,onChange:function(e){a(e.target.value)},children:[(0,Z.jsx)(m.Z,{value:2e3,children:"L\xe5ngsam (0.5 Hz)"}),(0,Z.jsx)(m.Z,{value:1e3,children:"Medium (1 Hz)"}),(0,Z.jsx)(m.Z,{value:500,children:"Snabb (2 Hz)"})]}),(0,Z.jsx)(S.Z,{children:"\xc4ndra tidslinjens hastighet"})]})}),(0,Z.jsxs)(u.ZP,{item:!0,xs:6,children:[(0,Z.jsx)(h.Z,{fullWidth:!0,children:(0,Z.jsxs)(g.Z,{variant:"standard",labelId:"select-resolution-label",id:"select-resolution",value:r,onChange:function(e){n(e.target.value)},children:[(0,Z.jsx)(m.Z,{value:"days",children:"Dag"}),(0,Z.jsx)(m.Z,{value:"months",children:"M\xe5nad"}),(0,Z.jsx)(m.Z,{value:"years",children:"\xc5r"})]})}),(0,Z.jsx)(S.Z,{children:"\xc4ndra tidslinjens uppl\xf6sning"})]})]})},i.layerStatus=e.layerStatus,i}return(0,i.Z)(r,[{key:"render",value:function(){return"layers_missing"===this.props.layerStatus.errorType?(0,Z.jsx)(u.ZP,{container:!0,children:(0,Z.jsx)(d.Z,{children:"Inga tidslinje-lager kunde hittas. Kontakta systemadministrat\xf6ren."})}):(0,Z.jsxs)(u.ZP,{container:!0,children:[(0,Z.jsx)(u.ZP,{item:!0,xs:12,children:(0,Z.jsx)(d.Z,{children:"Lagerstatus: "})}),(0,Z.jsx)(u.ZP,{item:!0,xs:12,children:this.renderLayerList()}),(0,Z.jsx)(u.ZP,{item:!0,xs:12,children:(0,Z.jsx)(d.Z,{children:"Inst\xe4llningar: "})}),(0,Z.jsx)(u.ZP,{item:!0,xs:12,children:this.renderSettingsContainer()})]})}}]),r}(l.PureComponent);t.default=T},2325:function(e,t,r){var n=r(64836);t.Z=void 0;var i=n(r(45649)),a=r(80184),s=(0,i.default)((0,a.jsx)("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"}),"Pause");t.Z=s},24137:function(e,t,r){var n=r(64836);t.Z=void 0;var i=n(r(45649)),a=r(80184),s=(0,i.default)((0,a.jsx)("path",{d:"M8 5v14l11-7z"}),"PlayArrow");t.Z=s},4606:function(e,t,r){var n=r(64836);t.Z=void 0;var i=n(r(45649)),a=r(80184),s=(0,i.default)((0,a.jsx)("path",{d:"M7.11 8.53 5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z"}),"RotateLeftOutlined");t.Z=s},66120:function(e,t,r){var n=r(64836);t.Z=void 0;var i=n(r(45649)),a=r(80184),s=(0,i.default)((0,a.jsx)("path",{d:"M19.43 12.98c.04-.32.07-.64.07-.98 0-.34-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.09-.16-.26-.25-.44-.25-.06 0-.12.01-.17.03l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.06-.02-.12-.03-.18-.03-.17 0-.34.09-.43.25l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98 0 .33.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.09.16.26.25.44.25.06 0 .12-.01.17-.03l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.06.02.12.03.18.03.17 0 .34-.09.43-.25l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zm-1.98-1.71c.04.31.05.52.05.73 0 .21-.02.43-.05.73l-.14 1.13.89.7 1.08.84-.7 1.21-1.27-.51-1.04-.42-.9.68c-.43.32-.84.56-1.25.73l-1.06.43-.16 1.13-.2 1.35h-1.4l-.19-1.35-.16-1.13-1.06-.43c-.43-.18-.83-.41-1.23-.71l-.91-.7-1.06.43-1.27.51-.7-1.21 1.08-.84.89-.7-.14-1.13c-.03-.31-.05-.54-.05-.74s.02-.43.05-.73l.14-1.13-.89-.7-1.08-.84.7-1.21 1.27.51 1.04.42.9-.68c.43-.32.84-.56 1.25-.73l1.06-.43.16-1.13.2-1.35h1.39l.19 1.35.16 1.13 1.06.43c.43.18.83.41 1.23.71l.91.7 1.06-.43 1.27-.51.7 1.21-1.07.85-.89.7.14 1.13zM12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm0 6c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"}),"SettingsOutlined");t.Z=s}}]);
//# sourceMappingURL=3332.f38ee6e5.chunk.js.map