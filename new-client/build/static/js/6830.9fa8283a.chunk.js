"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[6830],{86830:function(e,t,r){r.r(t),r.d(t,{default:function(){return E}});var n=r(37762),i=r(1413),a=r(15861),o=r(93433),s=r(15671),c=r(43144),l=r(66274),u=r(99359),g=r(64687),h=r.n(g),p=r(38629),d=r(42708),m=r(37130),f=r(35125),v=r(64802),w=r(34951),y=r(10430),x=r(5426),P=r(56957),S=r(62652),T=r(24673),b=r(68789),I=r(64665),L=r(66233),C=r(90927),Z=r(70328),F=r(57707),M=r(2421),V=r(92245),B=(0,u.Z)("getPngDependencies"),O=(0,u.Z)("saveToPdf"),k=(0,u.Z)("saveToPng"),E=function(){function e(t){var c,u,g,w,x,P=this;(0,s.Z)(this,e),this.scaleBarLengths={100:2.5,200:5,250:10,400:20,500:25,1e3:50,2e3:75,2500:100,5e3:250,1e4:500,25e3:1e3,5e4:2500,1e5:5e3,2e5:1e4},this.previewLayer=null,this.previewFeature=null,this.marginAmount=.03,this.textIconMarginAmount=.06,this.margin=0,this.textIconsMargin=0,this.mapMargin=0,this.pdfCreationCancelled=null,this.getMapScale=function(){P.printView.setZoom(P.originalView.getZoom());var e=P.printView.getProjection().getMetersPerUnit();return P.printView.getResolution()*e*39.37*(25.4/.28)},this.getFittingScale=function(){var e=P.getMapScale();return P.scales.reduce((function(t,r){return Math.abs(r-e)<Math.abs(t-e)?r:t}))},this.removePreview=function(){P.previewFeature=void 0,P.previewLayer.getSource().clear(),P.map.removeInteraction(P.translate)},this.getPreviewCenter=function(){var e=P.previewFeature.getGeometry().getExtent();return(0,m.getCenter)(e)},this.getMargin=function(e,t){return t*Math.max.apply(Math,(0,o.Z)(e))},this.getPaperDim=function(e,t){return"portrait"===t?(0,o.Z)(P.dims[e]).reverse():P.dims[e]},this.renderPreviewFeature=function(e,t){e?P.addPreview(t):P.removePreview()},this.getImageDataBlobFromUrl=function(e){return new Promise((function(t,r){var n=new Image;n.setAttribute("crossOrigin","anonymous"),n.onerror=function(e){r(e)},n.onload=function(){var e=document.createElement("canvas");e.width=this.naturalWidth,e.height=this.naturalHeight,e.getContext("2d").drawImage(this,0,0),t({data:e.toDataURL("image/png"),width:e.width,height:e.height})},n.src=e}))},this.getImageForPdfFromUrl=function(){var e=(0,a.Z)(h().mark((function e(t,r){var n,i,a,o,s,c,l;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.getImageDataBlobFromUrl(t);case 2:return n=e.sent,i=n.data,a=n.width,o=n.height,c=a*(s=r/a),l=o*s,e.abrupt("return",{data:i,width:c,height:l});case 10:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.getPlacement=function(e,t,r,n,i){var a=P.textIconsMargin+P.margin,o={x:0,y:0};return"topLeft"===e?(o.x=a,o.y=a):"topRight"===e?(o.x=n-t-a,o.y=a):"bottomRight"===e?(o.x=n-t-a,o.y=i-r-a):(o.x=a,o.y=i-r-a),o},this.getFittingScaleBarLength=function(e){var t=P.scaleBarLengths[e];return t||(e<250?5:e<2500?.02*e:.05*e)},this.getLengthText=function(e){var t="m";return e>1e3&&(e/=1e3,t="km"),"".concat(Number(e).toLocaleString("sv-SE")," ").concat(t)},this.drawScaleBar=function(e,t,r,n,i,a,o,s){var c=P.getLengthText(a);e.setFontSize(8),e.setFont("helvetica","bold"),e.setTextColor(r),e.setLineWidth(.25),e.text(c,t.x+n+1,t.y+4),e.setFontSize(10),e.text("Skala: ".concat(P.getUserFriendlyScale(i)," (vid ").concat(o.toUpperCase()," ").concat("landscape"===s?"liggande":"st\xe5ende",")"),t.x,t.y+1),e.setDrawColor(r),e.line(t.x,t.y+3,t.x+n,t.y+3),e.line(t.x,t.y+2,t.x,t.y+4),e.line(t.x+n,t.y+2,t.x+n,t.y+4),e.line(t.x+n/2,t.y+2.5,t.x+n/2,t.y+3.5)},this.addScaleBar=function(e,t,r,n,i,a,o,s){var c=25.4/n/a,l=P.getFittingScaleBarLength(r),u=l*c,g=P.getPlacement(i,u+9,6,e.internal.pageSize.width,e.internal.pageSize.height);P.drawScaleBar(e,g,t,u,r,l,o,s)},this.desiredPrintOptionsOk=function(e){var t=e.resolution,r=e.scale/1e3;return P.getScaleResolution(r,t,P.map.getView().getCenter())>=P.printView.getMinResolution()},this.getScaleResolution=function(e,t,r){return e/(0,d._Q)(P.map.getView().getProjection(),t/25.4,r)},this.getMapBackgroundColor=function(){var e=document.getElementById("map").style.backgroundColor;return""!==e?e:"white"},this.getVisibleTileAndImageLayers=function(){return P.map.getLayers().getArray().filter((function(e){return e.getVisible()&&P.layerIsTileOrImageLayer(e)}))},this.layerIsTileOrImageLayer=function(e){return e instanceof F.Z&&e.getSource()instanceof M.Z||e instanceof Z.Z&&e.getSource()instanceof V.Z},this.getVisibleImageLayers=function(){return P.map.getLayers().getArray().filter((function(e){return e.getVisible()&&e instanceof Z.Z&&e.getSource()instanceof V.Z}))},this.getLayerPlacementIndex=function(e){return P.map.getLayers().getArray().map((function(e){return e.get("name")})).indexOf(e.get("name"))},this.exchangeLayer=function(e){try{var t,r;e.setVisible(!1),P.hiddenLayers.add(e);var n=e.getSource(),a=new V.Z((0,i.Z)((0,i.Z)({},n.getProperties()),{},{projection:n.getProjection(),crossOrigin:null!==(t=n.crossOrigin)&&void 0!==t?t:"anonymous",params:(0,i.Z)({},n.getParams()),ratio:1,hidpi:!1})),o=null!==(r=e.getOpacity())&&void 0!==r?r:1,s=new Z.Z({opacity:o,source:a}),c=P.getLayerPlacementIndex(e);P.map.getLayers().insertAt(c,s),P.addedLayers.add(s)}catch(l){console.error("Failed to exchange the supplied layer with a print-layer! Error: ".concat(l))}},this.getBoundingBoxFromUrl=function(e){return e.searchParams.get("BBOX").split(",").map((function(e){return parseFloat(e)}))},this.loadImageTile=function(e,t){var r=e.getContext("2d"),n=t.url,i=t.x,a=t.y,o=t.tileWidth,s=t.tileHeight;return new Promise((function(e,t){var c=document.createElement("img");c.onload=function(){r.drawImage(c,i,a,o,s),e()},c.onerror=function(){t()},c.crossOrigin="anonymous",c.src=n}))},this.getTileColumn=function(e,t,r){for(var n=[];;){var i=n.reduce((function(e,t){return e+t.tileHeight}),0);if(i>=e)return n;var a=e-i,o=a>P.maxTileSize?P.maxTileSize:a,s=e-i-o;n.push({x:t,y:s,tileWidth:r,tileHeight:o})}},this.getVersionThreeBoundingBox=function(e,t,r,n){var i=(t[2]-t[0])/r,a=(t[3]-t[1])/n;return"".concat(t[0]+i*(r-e.y-e.tileHeight),",").concat(t[1]+a*e.x,",").concat(t[0]+i*(r-e.y),", ").concat(t[1]+a*(e.x+e.tileWidth))},this.getVersionOneBoundingBox=function(e,t,r,n){var i=(t[3]-t[1])/r,a=(t[2]-t[0])/n;return"".concat(t[0]+a*e.x,",").concat(t[1]+i*(r-e.y-e.tileHeight),",").concat(t[0]+a*(e.x+e.tileWidth),",").concat(t[1]+i*(r-e.y))},this.appendBoundingBox=function(e,t,r,i,a){var o,s=(0,n.Z)(e);try{for(s.s();!(o=s.n()).done;){var c=o.value;c.bBox="1.3.0"===a?P.getVersionThreeBoundingBox(c,t,r,i):P.getVersionOneBoundingBox(c,t,r,i)}}catch(l){s.e(l)}finally{s.f()}},this.getTileInformation=function(e,t,r){for(var n=[],i=P.getBoundingBoxFromUrl(r),a=r.searchParams.get("VERSION"),s=0;!(s>=t);){var c=t-s,l=c>P.maxTileSize?P.maxTileSize:c;n.push.apply(n,(0,o.Z)(P.getTileColumn(e,s,l))),s+=l}return P.appendBoundingBox(n,i,e,t,a),n},this.prepareImageLayer=function(e,t){try{e.getSource().setImageLoadFunction((function(e,r){var a=new URL(r),o=a.searchParams;o.set("DPI",t.resolution),o.set("MAP_RESOLUTION",t.resolution),o.set("FORMAT_OPTIONS","dpi:".concat(t.resolution));var s=parseFloat(o.get("HEIGHT"))||1,c=parseFloat(o.get("WIDTH"))||1;if(Math.max(s,c)>P.maxTileSize){var l=P.getTileInformation(s,c,a),u=document.createElement("canvas");u.width=c,u.height=s;var g,h=[],p=(0,n.Z)(l);try{for(p.s();!(g=p.n()).done;){var d=g.value,m=new URL(a.toString());m.searchParams.set("BBOX",d.bBox),m.searchParams.set("HEIGHT",d.tileHeight),m.searchParams.set("WIDTH",d.tileWidth),h.push(P.loadImageTile(u,(0,i.Z)((0,i.Z)({},d),{},{url:m.toString()})))}}catch(f){p.e(f)}finally{p.f()}Promise.allSettled(h).then((function(){e.getImage().src=u.toDataURL()}))}else e.getImage().src=a.toString()}))}catch(r){console.error("Failed to update the DPI-options while creating print-image (Single-tile WMS). Error: ".concat(r))}},this.prepareActiveLayersForPrint=function(e){var t,r=(0,n.Z)(P.getVisibleTileAndImageLayers());try{for(r.s();!(t=r.n()).done;){var i=t.value;P.exchangeLayer(i,e)}}catch(c){r.e(c)}finally{r.f()}var a,o=(0,n.Z)(P.getVisibleImageLayers());try{for(o.s();!(a=o.n()).done;){var s=a.value;P.prepareImageLayer(s,e)}}catch(c){o.e(c)}finally{o.f()}},this.resetPrintLayers=function(){var e,t=(0,n.Z)(P.hiddenLayers);try{for(t.s();!(e=t.n()).done;){e.value.setVisible(!0)}}catch(o){t.e(o)}finally{t.f()}var r,i=(0,n.Z)(P.addedLayers);try{for(i.s();!(r=i.n()).done;){var a=r.value;P.map.removeLayer(a)}}catch(o){i.e(o)}finally{i.f()}P.hiddenLayers=new Set,P.addedLayers=new Set},this.print=function(e){var t=e.format,r=e.orientation,n=e.resolution,i=e.scale/1e3,s="portrait"===r?(0,o.Z)(P.dims[t]).reverse():P.dims[t],c=Math.round(s[0]*n/25.4),l=Math.round(s[1]*n/25.4);P.useCustomTileLoaders&&P.prepareActiveLayersForPrint(e),P.printView.setCenter(P.originalView.getCenter()),P.map.setView(P.printView),P.originalMapSize=P.map.getSize();var u=P.getScaleResolution(i,n,P.map.getView().getCenter());P.map.once("rendercomplete",(0,a.Z)(h().mark((function n(){var i,a,o,g,d,m,v,w,y,x,S,T,b,I,L,C,Z,F,M,V;return h().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!0!==P.pdfCreationCancelled){n.next=3;break}return P.pdfCreationCancelled=!1,n.abrupt("return",!1);case 3:return n.next=5,(0,p.delay)(500);case 5:if((i=document.createElement("canvas")).width=c,i.height=l,a=i.getContext("2d"),o=P.getMapBackgroundColor(),a.fillStyle=o,a.fillRect(0,0,c,l),document.querySelectorAll(".ol-viewport canvas").forEach((function(e){if(e.width>0){var t=e.parentNode.style.opacity;if(a.globalAlpha=""===t?1:Number(t),e.style.transform){var r=e.style.transform.match(/^matrix\(([^(]*)\)$/)[1].split(",").map(Number);CanvasRenderingContext2D.prototype.setTransform.apply(a,r)}a.drawImage(e,0,0)}})),(g=new f.ZP({orientation:r,format:t,putOnlyUsedFonts:!0,compress:!0})).addImage(i,"JPEG",0,0,s[0],s[1]),P.margin>0&&(e.useTextIconsInMargin?g.setLineWidth(2*P.mapMargin):g.setLineWidth(2*P.margin),g.setDrawColor("red"),e.useTextIconsInMargin,g.rect(0,0,s[0],s[1],"S")),!(e.includeLogo&&P.logoUrl.trim().length>=5)){n.next=31;break}return n.prev=17,n.next=20,P.getImageForPdfFromUrl(P.logoUrl,P.logoMaxWidth);case 20:d=n.sent,m=d.data,v=d.width,w=d.height,y=P.getPlacement(e.logoPlacement,v,w,s[0],s[1]),g.addImage(m,"PNG",y.x,y.y,v,w),n.next=31;break;case 28:n.prev=28,n.t0=n.catch(17),P.localObserver.publish("error-loading-logo-image");case 31:if(!(e.includeNorthArrow&&P.northArrowUrl.trim().length>=5)){n.next=46;break}return n.prev=32,n.next=35,P.getImageForPdfFromUrl(P.northArrowUrl,10);case 35:x=n.sent,S=x.data,T=x.width,b=x.height,I=P.getPlacement(e.northArrowPlacement,T,b,s[0],s[1]),g.addImage(S,"PNG",I.x,I.y,T,b),n.next=46;break;case 43:n.prev=43,n.t1=n.catch(32),P.localObserver.publish("error-loading-arrow-image");case 46:e.includeScaleBar&&P.addScaleBar(g,e.mapTextColor,e.scale,e.resolution,e.scaleBarPlacement,u,e.format,e.orientation),e.mapTitle.trim().length>0&&(L=e.useTextIconsInMargin?16:12+P.margin,g.setFontSize(24),g.setTextColor(e.mapTextColor),g.text(e.mapTitle,s[0]/2,L,{align:"center"})),e.printComment.trim().length>0&&(C=e.useTextIconsInMargin?22:18+P.margin,g.setFontSize(11),g.setTextColor(e.mapTextColor),g.text(e.printComment,s[0]/2,C,{align:"center"})),P.copyright.length>0&&(Z=e.useTextIconsInMargin?6:P.margin,g.setFontSize(8),g.setTextColor(e.mapTextColor),g.text(P.copyright,s[0]-4-Z,s[1]-4-Z,{align:"right"})),P.disclaimer.length>0&&(F=e.useTextIconsInMargin?6:P.margin,g.setFontSize(8),g.setTextColor(e.mapTextColor),M=g.splitTextToSize(P.disclaimer,s[0]/2-P.margin-8),V=g.getTextDimensions(M,{fontSize:8}),g.text(M,s[0]-4-F,s[1]-6-F-V.h,{align:"right"})),P.useCustomTileLoaders&&P.resetPrintLayers(),P.saveToFile(g,c,e.saveAsType).then((function(){P.localObserver.publish("print-completed")})).catch((function(e){console.warn(e),P.localObserver.publish("print-failed-to-save")})).finally((function(){P.restoreOriginalView()}));case 53:case"end":return n.stop()}}),n,null,[[17,28],[32,43]])}))));var g=(0,m.getCenter)(P.previewFeature.getGeometry().getExtent());P.previewLayer.setVisible(!1),P.map.getTargetElement().style.width="".concat(c,"px"),P.map.getTargetElement().style.height="".concat(l,"px"),P.map.updateSize(),P.map.getView().setCenter(g),P.map.getView().setResolution(u)},this.restoreOriginalView=function(){P.previewLayer.setVisible(!0),P.map.setSize(P.originalMapSize),P.map.getTargetElement().style.width="",P.map.getTargetElement().style.height="",P.map.updateSize(),P.map.setView(P.originalView)},Object.defineProperty(this,B,{writable:!0,value:function(){var e=(0,a.Z)(h().mark((function e(){var t;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([r.e(3661),r.e(8611)]).then(r.t.bind(r,43661,23));case 3:return t=e.sent,e.abrupt("return",{pdfjs:t});case 7:throw e.prev=7,e.t0=e.catch(0),new Error("Failed to import required dependencies. Error: ".concat(e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}()}),Object.defineProperty(this,O,{writable:!0,value:function(){var e=(0,a.Z)(h().mark((function e(t,r){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t.save("".concat(r,".pdf")),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new Error("Failed to save PDF. Error: ".concat(e.t0));case 7:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(t,r){return e.apply(this,arguments)}}()}),Object.defineProperty(this,k,{writable:!0,value:function(){var e=(0,a.Z)(h().mark((function e(t,r,n){var i,a,o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,l.Z)(P,B)[B]();case 3:i=e.sent,(a=i.pdfjs).GlobalWorkerOptions.workerSrc="//cdnjs.cloudflare.com/ajax/libs/pdf.js/".concat(a.version,"/pdf.worker.js"),o=t.output("arraybuffer"),a.getDocument({data:o}).promise.then((function(e){e.getPage(1).then((function(e){var t=document.createElement("canvas"),i=t.getContext("2d"),a=e.getViewport({scale:1}),o=n/a.width,s=e.getViewport({scale:o}),c={canvasContext:i,viewport:s};t.height=s.height,t.width=s.width,e.render(c).promise.then((function(){t.toBlob((function(e){(0,v.saveAs)(e,"".concat(r,".png"))}))}))}))})),e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(0),new Error("Failed to save PNG. Error: ".concat(e.t0));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,r,n){return e.apply(this,arguments)}}()}),this.saveToFile=function(){var e=(0,a.Z)(h().mark((function e(t,r,n){var i;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i="Kartexport - ".concat((new Date).toLocaleString()),e.prev=1,e.t0=n,e.next="PDF"===e.t0?5:"PNG"===e.t0?6:7;break;case 5:return e.abrupt("return",(0,l.Z)(P,O)[O](t,i));case 6:return e.abrupt("return",(0,l.Z)(P,k)[k](t,i,r));case 7:throw new Error("Supplied type could not be handled. The supplied type was ".concat(n," and currently only PDF and PNG is supported."));case 8:e.next=13;break;case 10:throw e.prev=10,e.t1=e.catch(1),new Error("Failed to save file... ".concat(e.t1));case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t,r,n){return e.apply(this,arguments)}}(),this.cancelPrint=function(){P.pdfCreationCancelled=!0,P.restoreOriginalView(),P.useCustomTileLoaders&&P.resetPrintLayers()},this.getUserFriendlyScale=function(e){return"1:".concat(Number(e).toLocaleString("sv-SE"))},this.map=t.map,this.dims=t.dims,this.logoUrl=null!==(c=t.options.logo)&&void 0!==c?c:"",this.northArrowUrl=null!==(u=t.options.northArrow)&&void 0!==u?u:"",this.logoMaxWidth=t.options.logoMaxWidth,this.scales=t.options.scales,this.copyright=null!==(g=t.options.copyright)&&void 0!==g?g:"",this.disclaimer=null!==(w=t.options.disclaimer)&&void 0!==w?w:"",this.localObserver=t.localObserver,this.mapConfig=t.mapConfig,this.useCustomTileLoaders=null===(x=t.options.useCustomTileLoaders)||void 0===x||x,this.maxTileSize=t.options.maxTileSize||4096,this.originalView=this.map.getView(),this.originalMapSize=null,this.hiddenLayers=new Set,this.addedLayers=new Set,this.printView=new y.ZP({center:this.originalView.getCenter(),constrainOnlyCenter:this.mapConfig.constrainOnlyCenter,constrainResolution:!1,maxZoom:24,minZoom:0,projection:this.originalView.getProjection(),resolutions:this.mapConfig.allResolutions,zoom:this.originalView.getZoom()})}return(0,c.Z)(e,[{key:"addPreviewLayer",value:function(){this.previewLayer=new w.Z({source:new x.Z,layerType:"system",zIndex:5e3,name:"pluginPrint",caption:"Print layer",style:new I.ZP({stroke:new L.Z({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new C.Z({color:"rgba(255, 145, 20, 0.4)"})})}),this.map.addLayer(this.previewLayer)}},{key:"addPreview",value:function(e){var t=e.scale,r=e.format,n=e.orientation,i=e.useMargin,a=!!i&&e.useTextIconsInMargin,o=this.getPaperDim(r,n);this.margin=i?this.getMargin(o,this.marginAmount):0,this.textIconsMargin=a?0:6,this.mapMargin=a?this.getMargin(o,this.textIconMarginAmount):0;var s=25.4/.28,c=e.useMargin&&e.useTextIconsInMargin?o[1]-35:o[1],l=(o[0]-2*this.margin)/25.4*s,u=(c-2*this.margin)/25.4*s,g=this.previewFeature?(0,m.getCenter)(this.previewFeature.getGeometry().getExtent()):this.map.getView().getCenter(),h=l/s/39.37*t/2*1,p=u/s/39.37*t/2*1,d=[[[g[0]-h,g[1]-p],[g[0]-h,g[1]+p],[g[0]+h,g[1]+p],[g[0]+h,g[1]-p],[g[0]-h,g[1]-p]]],f=new S.Z({geometry:new P.ZP(d)});this.removePreview(),this.previewFeature=f,this.previewLayer.getSource().addFeature(f),this.translate=new T.Z({features:new b.Z([f])}),this.map.addInteraction(this.translate)}}]),e}()}}]);
//# sourceMappingURL=6830.9fa8283a.chunk.js.map