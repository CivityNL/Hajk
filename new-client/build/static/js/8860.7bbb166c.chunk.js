"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[8860],{28860:function(e,t,r){r.r(t);var i=r(15671),n=r(43144),o=r(34951),a=r(5426),g=r(64665),l=r(66233),s=r(90927),u=r(18029),c=r(5400),p=r(37130),y=r(56957),f=r(62652),h=r(57707),S=r(70328),d=r(2421),m=r(92245),v=r(24673),x=r(15678),C=r(81019),k=r(68789),F=r(25806),w=function(e){return/^#/.test(e)?e:"#"+e.match(/\d+(\.\d+)?/g).splice(0,3).map((function(e){var t=parseInt(e,10).toString(16);return parseInt(e)<16&&(t="0"+t),t})).join("")},T=function(){function e(t){(0,i.Z)(this,e),this.map=t.map,this.app=t.app,this.localObserver=t.localObserver,this.exportUrl=t.options.exportUrl,this.scales=this.validateScales(t.options.scales),this.copyright="\xa9 Lantm\xe4teriverket i2009/00858",this.autoScale=!1,this.instruction="",this.addPreviewLayer()}return(0,n.Z)(e,[{key:"validateScales",value:function(e){return"string"==typeof e&&/(\d+)(,\s*\d+)*/.test(e)?e.split(",").map((function(e){return Number(e)})):[250,500,1e3,2500,5e3,1e4,25e3,5e4,1e5,25e4]}},{key:"addPreviewLayer",value:function(){this.previewLayer=new o.Z({source:new a.Z,layerType:"system",zIndex:5e3,name:"pluginExport",caption:"Export plugin",style:new g.ZP({stroke:new l.Z({color:"rgba(0, 0, 0, 0.7)",width:2}),fill:new s.Z({color:"rgba(255, 145, 20, 0.4)"})})}),this.map.addLayer(this.previewLayer)}},{key:"removePreview",value:function(){this.previewFeature=void 0,this.previewLayer.getSource().clear(),this.map.removeInteraction(this.translate)}},{key:"getPreviewFeature",value:function(){return this.previewFeature}},{key:"getPreviewCenter",value:function(){var e=this.getPreviewFeature().getGeometry().getExtent();return(0,p.getCenter)(e)}},{key:"addPreview",value:function(e,t,r){var i=25.4/.28,n=t.width/i/39.37*e/2*1,o=t.height/i/39.37*e/2*1,a=[[[r[0]-n,r[1]-o],[r[0]-n,r[1]+o],[r[0]+n,r[1]+o],[r[0]+n,r[1]-o],[r[0]-n,r[1]-o]]],g=new f.Z({geometry:new y.ZP(a)});this.removePreview(),this.previewFeature=g,this.previewLayer.getSource().addFeature(g),this.translate=new v.Z({features:new k.Z([g])}),this.map.addInteraction(this.translate)}},{key:"findWMS",value:function(){var e=this;return this.map.getLayers().getArray().filter((function(e){return(e instanceof h.Z||e instanceof S.Z)&&(e.getSource()instanceof d.Z||e.getSource()instanceof m.Z)&&e.getVisible()})).map((function(t,r){var i="string"===typeof t.getSource().getParams().LAYERS?t.getSource().getParams().LAYERS.split(","):t.getSource().getParams().LAYERS;return{url:t.getSource().get("url"),layers:i,zIndex:r,workspacePrefix:null,coordinateSystemId:e.map.getView().getProjection().getCode().split(":")[1]}}))}},{key:"findVector",value:function(){function e(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function t(t){var r=/rgb(a)?\((\d+), (\d+), (\d+)(, [\d.]+)?\)/.exec(t);if(null!==r){var i=parseInt(r[2]),n=parseInt(r[3]),o=parseInt(r[4]);return parseInt(r[5])?null:"#"+e(i)+e(n)+e(o)}return null}function r(e){function r(e){var r=e.join(", ");return t("rgba(".concat(r,")"))}if(!e)return null;Array.isArray(e)&&(2===e.length&&(e=e[1]),1===e.length&&(e=e[0]));var i,n="#FC345C",o=.5,a="#FC345C",g=3,l="round",s="solid",p=10,y="#FC345C",f="",h="16",S="#FFFFFF",d="#000000";return e.getText&&e.getText()&&e.getText().getFont&&e.getText().getFont()&&(h=e.getText().getFont().match(/\d+/)[0]),e.getText&&e.getText()&&e.getText().getFill&&e.getText().getFill()&&("string"===typeof e.getText().getFill().getColor()?S=e.getText().getFill().getColor():Array.isArray(e.getText().getFill().getColor())&&(S=r(e.getText().getFill().getColor()))),e.getText&&e.getText()&&e.getText().getStroke&&e.getText().getStroke()&&("string"===typeof e.getText().getFill().getColor()?d=e.getText().getStroke().getColor():Array.isArray(e.getText().getStroke().getColor())&&(d=r(e.getText().getStroke().getColor()))),S&&/^rgb/.test(S)&&(S=t(S)),d&&(d=/^rgb\(/.test(d)?t(d):null),e.getFill&&e.getFill()&&e.getFill().getColor()&&(w(e.getFill().getColor())?(n=w(e.getFill().getColor()),i=e.getFill().getColor(),o=parseFloat(i.match(/\d+(\.\d+)?/g).splice(3,1)[0])):Array.isArray(e.getFill().getColor())&&(n=r(e.getFill().getColor()),o=e.getFill().getColor()[e.getFill().getColor().length-1])),e.getFill&&e.getStroke()&&(w(e.getStroke().getColor())?a=w(e.getStroke().getColor()):Array.isArray(e.getStroke().getColor())&&(a=r(e.getStroke().getColor())),g=e.getStroke().getWidth()||3,l=e.getStroke().getLineCap()||"round",s=e.getStroke().getLineDash()?12===e.getStroke().getLineDash()[0]?"dash":"dot":"solid"),e.getImage&&e.getImage()&&(e.getImage()instanceof u.Z&&(f=e.getImage().getSrc()),e.getImage()instanceof c.Z&&(p=e.getImage().getRadius(),y=w(e.getImage().getFill().getColor()))),{fillColor:n,fillOpacity:o,strokeColor:a,strokeOpacity:1,strokeWidth:g,strokeLinecap:l,strokeDashstyle:s,pointRadius:p,pointFillColor:y,pointSrc:f,labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3,fontSize:h,fontColor:S,fontBackColor:d}}function i(e,t){switch(t){case"Point":return[e];case"LineString":return e;case"Polygon":return e[0];case"MultiPolygon":return e[0][0];case"Circle":return[e[0],e[1]]}}var n=this.previewLayer.getSource().getFeatures()[0].getGeometry().getExtent();return this.map.getLayers().getArray().filter((function(e){return e instanceof o.Z&&e.getVisible()&&"pluginExport"!==e.get("name")})).map((function(e){return function(e,t){function n(e){var t="";return e.getProperties()&&"Text"===e.getProperties().type?t=e.getProperties().description?e.getProperties().description:e.getProperties().name?e.getProperties().name:"":(e.getStyle&&Array.isArray(e.getStyle())&&e.getStyle()[1]&&e.getStyle()[1].getText()&&e.getStyle()[1].getText().getText()&&(t=e.getStyle()[1].getText().getText()),e.getStyle&&e.getStyle()&&e.getStyle().getText&&e.getStyle().getText()&&(t=e.getStyle().getText().getText()),t)}return{features:e.map((function(e){var o,a=e.getGeometry().getType(),g=e.getGeometry(),l=null;if(!e.getStyle()&&t){var s=t.getStyle()(e)[0];e.setStyle(s)}return o="Circle"===a?i([g.getCenter(),[g.getRadius(),0]],"Circle"):i(g.getCoordinates(),a),"MultiPolygon"===a&&(l=g.getCoordinates()[0].slice(1,g.getCoordinates()[0].length)),{type:a,attributes:{text:n(e),style:r(e.getStyle())},coordinates:o,holes:l}}))}}(e.getSource().getFeaturesInExtent(n),e)})).filter((function(e){return e.features.length>0}))}},{key:"findWMTS",value:function(){return this.map.getLayers().getArray().filter((function(e){return e.getSource()instanceof x.Z&&e.getVisible()})).map((function(e){var t=e.getSource();return{url:Array.isArray(t.getUrls())?t.getUrls()[0]:t.get("url"),axisMode:"natural"}}))}},{key:"findArcGIS",value:function(){return this.map.getLayers().getArray().filter((function(e){return e.getSource()instanceof C.Z&&e.getVisible()})).map((function(e){var t=e.getSource().get("url"),r=e.get("extent")||[],i=[],n=e.get("projection");return"string"===typeof e.getSource().getParams("params").LAYERS&&(i=e.getSource().getParams("params").LAYERS.replace("show:","").split(",")),"string"===typeof n&&(n=n.replace("EPSG:","")),{url:t,layers:i,spatialReference:n,extent:{left:r[0],bottom:r[1],right:r[2],top:r[3]}}}))}},{key:"exportPDF",value:function(e,t){var r=this.previewLayer.getSource().getFeatures()[0].getGeometry().getExtent(),i=r[0],n=r[2],o=r[1],a=r[3],g=this.exportUrl,l={wmsLayers:[],vectorLayers:[],size:null,resolution:e.resolution,bbox:null};l.vectorLayers=this.findVector()||[],l.wmsLayers=this.findWMS()||[],l.wmtsLayers=this.findWMTS()||[],l.arcgisLayers=this.findArcGIS()||[],l.size=[parseInt(e.size.width*e.resolution),parseInt(e.size.height*e.resolution)],l.bbox=[i,n,o,a],l.orientation=e.orientation,l.format=e.format,l.scale=e.scale,(0,F.hfetch)(g,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:JSON.stringify(l)})}).then((function(e){e.text().then((function(e){t&&t(e)}))})).catch((function(e){alert("Det gick inte att exportera kartan. "+e),console.error(e)}))}},{key:"resolutionToScale",value:function(e,t){return t*e*39.37}},{key:"getMap",value:function(){return this.map}}]),e}();t.default=T}}]);
//# sourceMappingURL=8860.7bbb166c.chunk.js.map