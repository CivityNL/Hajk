"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[3179],{83179:function(e,a,t){t.r(a);var r=t(15671),n=t(43144),i=t(10736),s=function(){function e(a){var t=this;(0,r.Z)(this,e),this.update=function(e){!1===e.target.getAnimating()&&t.localObserver.publish("mapUpdated",t.getAnchor())},this.app=a.app,this.getCleanUrl=a.getCleanUrl,this.cqlFilters={},this.map=a.map,this.localObserver=a.localObserver,this.map.getView().on("change",this.update),this.app.globalObserver.subscribe("search.searchPhraseChanged",(function(){t.localObserver.publish("mapUpdated",t.getAnchor())})),this.map.getLayers().getArray().forEach((function(e){var a=e.get("name");e.on("change:visible",(function(e){t.localObserver.publish("mapUpdated",t.getAnchor())})),e.getSource().on("change",(function(e){var r,n=e.target;if("function"===typeof n.getParams){var i=null===(r=n.getParams())||void 0===r?void 0:r.CQL_FILTER;null!==i&&void 0!==i&&(t.cqlFilters[a]=i),t.localObserver.publish("mapUpdated",t.getAnchor())}}))}))}return(0,n.Z)(e,[{key:"getMap",value:function(){return this.map}},{key:"getVisibleLayers",value:function(){return this.map.getLayers().getArray().filter((function(e){return e.getVisible()&&e.getProperties().name&&(0,i.isValidLayerId)(e.getProperties().name)})).map((function(e){return e.getProperties().name})).join(",")}},{key:"getAnchor",value:function(){var e,a=(null===(e=document.getElementById("searchInputField"))||void 0===e?void 0:e.value.trim())||"",t=this.cqlFilters,r=this.getCleanUrl(),n=new URL(document.location.href.split("?")[0]);return n.searchParams.append("m",this.app.config.activeMap),n.searchParams.append("x",this.map.getView().getCenter()[0]),n.searchParams.append("y",this.map.getView().getCenter()[1]),n.searchParams.append("z",this.map.getView().getZoom()),n.searchParams.append("l",this.getVisibleLayers()),!0===r&&n.searchParams.append("clean",r),Object.keys(t).length>0&&n.searchParams.append("f",JSON.stringify(t)),a.length>0&&n.searchParams.append("q",a),n.toString()}}]),e}();a.default=s}}]);
//# sourceMappingURL=3179.55278316.chunk.js.map