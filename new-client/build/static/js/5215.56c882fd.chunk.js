"use strict";(self.webpackChunkhajk_client=self.webpackChunkhajk_client||[]).push([[5215,4906],{28619:function(e,t,i){i.r(t);var o=i(15671),r=i(43144),n=i(60136),s=i(29388),a=i(4942),c=i(72791),l=i(76863),u=i(48928),d=i(73978),h=i(58487),p=i(16398),f=i(80184),v=(0,l.ZP)(u.Z)((function(e){var t=e.theme;return(0,a.Z)({marginBottom:t.spacing(1),width:"210px"},t.breakpoints.down("sm"),{boxShadow:"none",borderBottom:"1px solid #ccc",borderRadius:0,margin:0,width:"100%",justifyContent:"left"})})),m=(0,l.ZP)(d.Z)((function(e){return{background:e.theme.palette.text.primary}})),g=function(e){(0,n.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;(0,o.Z)(this,i);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))).state={open:!1,text:""},e}return(0,r.Z)(i,[{key:"render",value:function(){var e=this.props,t=e.abstract,i=e.icon,o=e.onClick,r=e.title;return(0,f.jsx)(v,{onClick:o,children:(0,f.jsx)(h.Z,{children:(0,f.jsx)(p.Z,{avatar:(0,f.jsx)(m,{children:i}),title:r,subheader:t})})})}}]),i}(c.PureComponent);g.defaultProps={abstract:"Beskrivning saknas",title:"Titel saknas"},t.default=g},73151:function(e,t,i){i.r(t);var o=i(15671),r=i(43144),n=i(97326),s=i(60136),a=i(29388),c=i(72791),l=i(85286),u=i(54164),d=i(66788),h=i(35110),p=i(65514),f=i(4346),v=i(26191),m=i(28619),g=i(74599),w=i(80184),y=function(e){(0,s.Z)(i,e);var t=(0,a.Z)(i);function i(e){var r;(0,o.Z)(this,i),(r=t.call(this,e)).handleButtonClick=function(e){r.showWindow({hideOtherPluginWindows:!0,runCallback:!0}),r.props.app.globalObserver.publish("core.onlyHideDrawerIfNeeded")},r.showWindow=function(e){var t=e.hideOtherPluginWindows||!0,i=e.runCallback||!0;if(r.props.app.activeTool=r.type,r.props.app.globalObserver.publish("analytics.trackEvent",{eventName:"pluginShown",pluginName:r.type,activeMap:r.props.app.config.activeMap}),!0===r.state.windowVisible)return null;!0===t&&r.props.app.onWindowOpen((0,n.Z)(r)),r.setState({windowVisible:!0},(function(){!0===i&&"function"===typeof r.props.custom.onWindowShow&&r.props.custom.onWindowShow()}))},r.closeWindow=function(){r.type===r.props.app.activeTool&&(r.props.app.activeTool=void 0),r.setState({windowVisible:!1},(function(){"function"===typeof r.props.custom.onWindowHide&&r.props.custom.onWindowHide()}))},r.type=e.type.toLowerCase()||void 0,r.description=e.options.description||e.custom.description;var s=!1===r.props.app.config.mapConfig.map.clean&&(l.isMobile?e.options.visibleAtStartMobile:e.options.visibleAtStart)||!1;s&&r.props.app.globalObserver.publish("analytics.trackEvent",{eventName:"pluginShown",pluginName:r.type,activeMap:r.props.app.config.activeMap}),r.state={title:e.options.title||e.custom.title||"Unnamed plugin",color:e.options.color||e.custom.color||null,windowVisible:s},r.title=e.options.title||e.custom.title||"Unnamed plugin",r.width=e.options.width||e.custom.width||400,r.height=e.options.height||e.custom.height||"auto",r.position=e.options.position||e.custom.position||"left",e.app.registerWindowPlugin((0,n.Z)(r));var a="".concat(r.type,".showWindow");e.app.globalObserver.subscribe(a,(function(e){r.showWindow(e)}));var c="".concat(r.type,".closeWindow");return e.app.globalObserver.subscribe(c,(function(){r.closeWindow()})),r}return(0,r.Z)(i,[{key:"componentDidUpdate",value:function(e){e.custom.title!==this.props.custom.title&&this.setState({title:this.props.custom.title}),e.custom.color!==this.props.custom.color&&this.setState({color:this.props.custom.color})}},{key:"pluginIsWidget",value:function(e){return["left","right"].includes(e)}},{key:"renderWindow",value:function(e){var t=this.props.options.target;return"function"===typeof(null===e||void 0===e?void 0:e.render)?e.render():(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(v.default,{globalObserver:this.props.app.globalObserver,title:this.state.title,color:this.state.color,onClose:this.closeWindow,open:this.state.windowVisible,onResize:this.props.custom.onResize,onMaximize:this.props.custom.onMaximize,onMinimize:this.props.custom.onMinimize,draggingEnabled:this.props.custom.draggingEnabled,customPanelHeaderButtons:this.props.custom.customPanelHeaderButtons,resizingEnabled:this.props.custom.resizingEnabled,scrollable:this.props.custom.scrollable,allowMaximizedWindow:this.props.custom.allowMaximizedWindow,disablePadding:this.props.custom.disablePadding,width:this.width,height:this.height,position:this.position,mode:"window",layerswitcherConfig:this.props.app.config.mapConfig.tools.find((function(e){return"layerswitcher"===e.type})),children:c.cloneElement(this.props.children,{windowVisible:this.state.windowVisible})}),("toolbar"===t||this.pluginIsWidget(t))&&this.renderDrawerButton(),this.pluginIsWidget(t)&&this.renderWidgetButton("".concat(t,"-column")),"control"===t&&this.renderControlButton()]})}},{key:"renderDrawerButton",value:function(){return(0,u.createPortal)((0,w.jsx)(d.Z,{mdUp:this.pluginIsWidget(this.props.options.target),children:(0,w.jsxs)(h.ZP,{button:!0,divider:!0,selected:this.state.windowVisible,onClick:this.handleButtonClick,children:[(0,w.jsx)(p.Z,{children:this.props.custom.icon}),(0,w.jsx)(f.Z,{primary:this.title})]})}),document.getElementById("plugin-buttons"))}},{key:"renderWidgetButton",value:function(e){return(0,u.createPortal)((0,w.jsx)(d.Z,{mdDown:!0,children:(0,w.jsx)(m.default,{icon:this.props.custom.icon,onClick:this.handleButtonClick,title:this.title,abstract:this.description})}),document.getElementById(e))}},{key:"renderControlButton",value:function(){return(0,u.createPortal)((0,w.jsx)(g.default,{icon:this.props.custom.icon,onClick:this.handleButtonClick,title:this.title,abstract:this.description}),document.getElementById("plugin-control-buttons"))}},{key:"render",value:function(){return!0!==this.props.app.config.mapConfig.map.clean&&this.renderWindow(this.props.custom)}}]),i}(c.PureComponent);t.default=y},75215:function(e,t,i){i.r(t);var o=i(1413),r=i(15671),n=i(43144),s=i(60136),a=i(29388),c=i(72791),l=i(73151),u=i(34311),d=i(99900),h=i(64906),p=i(85194),f=i.n(p),v=i(80184),m=function(e){(0,s.Z)(i,e);var t=(0,a.Z)(i);function i(e){var o;return(0,r.Z)(this,i),(o=t.call(this,e)).onWindowHide=function(){o.localObserver.publish("resetView"),o.editModel.reset()},o.localObserver=f()(),o.editModel=new h.default({map:e.map,app:e.app,observer:o.localObserver,options:e.options}),o}return(0,n.Z)(i,[{key:"render",value:function(){return(0,v.jsx)(l.default,(0,o.Z)((0,o.Z)({},this.props),{},{type:"Edit",custom:{icon:(0,v.jsx)(u.Z,{}),title:"Redigera",description:"Redigera objekt i kartan (WFS)",height:500,width:500,top:void 0,left:void 0,onWindowHide:this.onWindowHide},children:(0,v.jsx)(d.default,{app:this.props.app,model:this.editModel,observer:this.localObserver})}))}}]),i}(c.PureComponent);t.default=m},64906:function(e,t,i){i.r(t);var o=i(29439),r=i(1413),n=i(37762),s=i(15671),a=i(43144),c=i(63252),l=i(64665),u=i(66233),d=i(90927),h=i(5400),p=i(50315),f=i(56957),v=i(95881),m=i(34951),g=i(5426),w=i(28562),y=i(489),b=i(79717),k=i(56134),S=i(24673),Z=i(2177),P=i(50007),x=i.n(P),E=i(25806),F=function(){function e(t){var i=this;(0,s.Z)(this,e),this.loadDataSuccess=function(e){var t,o=new c.Z;try{t=o.readFeatures(e)}catch(r){alert("Fel: data kan inte l\xe4sas in. Kontrollera koordinatsystem.")}i.geometryName=t.length>0?t[0].getGeometryName():"geom",i.editSource.editableFields.some((function(e){return e.hidden}))&&(t=i.filterByDefaultValue(t)),i.vectorSource.addFeatures(t),i.vectorSource.getFeatures().forEach((function(e){e.on("propertychange",(function(t){"removed"!==e.modification&&"added"!==e.modification&&(e.modification="updated")})),e.on("change",(function(t){"removed"!==e.modification&&"added"!==e.modification&&(e.modification="updated")}))}))},this.removeSelected=function(e){i.map.forEachFeatureAtPixel(e.pixel,(function(e){i.vectorSource.getFeatures().some((function(t){return t===e}))&&("added"===e.modification?e.modification=void 0:e.modification="removed",e.setStyle(i.getHiddenStyle()))}))},this.resetEditFeature=function(){i.editFeatureBackup=i.editFeature,i.editFeature=void 0,i.observer.publish("editFeature",i.editFeature)},this.map=t.map,this.app=t.app,this.observer=t.observer,this.options=t.options,this.activeServices=this.options.activeServices,this.sources=this.options.sources,this.vectorSource=void 0,this.layer=void 0,this.select=void 0,this.modify=void 0,this.key=void 0,this.editFeature=void 0,this.editFeatureBackup=void 0,this.editSource=void 0,this.removeFeature=void 0,this.shell=void 0,this.instruction="",this.filty=!1,this.removalToolMode="off",this.options.sources=this.options.sources.map((function(e){0===e.uri.trim().length&&(e.uri="http://www.opengis.net/wfs");var t=new URL(e.url);return t.searchParams.delete("service"),e.url=t.href,e}))}return(0,a.Z)(e,[{key:"write",value:function(e){var t=new c.Z,i=this.editSource.layers[0].split(":"),o=2===i.length?i[0]:"",r=2===i.length?i[1]:i[0],n={featureNS:this.editSource.uri,featurePrefix:o,featureType:r,hasZ:!1,version:"1.1.0",srsName:this.editSource.projection};return t.writeTransaction(e.inserts,e.updates,e.deletes,n)}},{key:"refreshLayer",value:function(e){var t,i=this.map.getLayers().getArray().find((function(t){var i=!1;if(t.getSource().getParams){var o=t.getSource().getParams();if("object"===typeof o){var r=Array.isArray(o.LAYERS)?o.LAYERS[0].split(":"):o.LAYERS.split(":"),n=e.split(":");2===r.length&&2===n.length&&(i=e===o.LAYERS),1===r.length&&(i=n[1]===o.LAYERS)}}return i}));i&&((t=i.getSource()).changed(),t.updateParams({time:Date.now()}),this.map.updateSize())}},{key:"parseWFSTresponse",value:function(e){var t="string"!==typeof e?(new XMLSerializer).serializeToString(e):e;return(new(x())).xml2js(t)}},{key:"transact",value:function(e,t){var i=this,o=this.write(e),r=new XMLSerializer,n=this.editSource,s=o?r.serializeToString(o):void 0;s&&(0,E.hfetch)(n.url,{method:"POST",body:s,credentials:"same-origin",headers:{"Content-Type":"text/xml"}}).then((function(e){e.text().then((function(e){var o=i.parseWFSTresponse(e);o.ExceptionReport||!o.TransactionResponse||(i.refreshLayer(n.layers[0]),i.vectorSource.getFeatures().filter((function(e){return void 0!==e.modification})).forEach((function(e){return e.modification=void 0}))),t(o)}))})).catch((function(e){e.text().then((function(e){t(e)}))}))}},{key:"save",value:function(e){var t=this,i=function(e){return t.vectorSource.getFeatures().filter((function(t){return t.modification===e}))},o={updates:i("updated").map((function(e){return e.unset("boundedBy"),e})),inserts:i("added"),deletes:i("removed")};if(0===o.updates.length&&0===o.inserts.length&&0===o.deletes.length)return e();this.transact(o,e)}},{key:"getSelectStyle",value:function(e){return[new l.ZP({stroke:new u.Z({color:"rgba(0, 255, 255, 1)",width:3}),fill:new d.Z({color:"rgba(0, 0, 0, 0.5)"}),image:new h.Z({fill:new d.Z({color:"rgba(0, 0, 0, 0.5)"}),stroke:new u.Z({color:"rgba(0, 255, 255, 1)",width:2}),radius:3})}),new l.ZP({image:new p.Z({fill:new d.Z({color:"rgba(0, 0, 0, 0.2)"}),stroke:new u.Z({color:"rgba(0, 0, 0, 1)",width:2}),points:4,radius:8,angle:Math.PI/4}),geometry:function(e){var t=e.getGeometry()instanceof f.ZP?e.getGeometry().getCoordinates()[0]:e.getGeometry().getCoordinates();return new v.Z(t)}})]}},{key:"getVectorStyle",value:function(e){return[new l.ZP({stroke:new u.Z({color:"rgba(0, 0, 0, 1)",width:3}),fill:new d.Z({color:"rgba(0, 0, 0, 0.5)"}),image:new h.Z({fill:new d.Z({color:"rgba(0, 0, 0, 0.5)"}),stroke:new u.Z({color:"rgba(0, 0, 0, 1)",width:3}),radius:4})})]}},{key:"getHiddenStyle",value:function(e){return[new l.ZP({stroke:new u.Z({color:"rgba(0, 0, 0, 0)",width:0}),fill:new d.Z({color:"rgba(1, 2, 3, 0)"}),image:new h.Z({fill:new d.Z({color:"rgba(0, 0, 0, 0)"}),stroke:new u.Z({color:"rgba(0, 0, 0, 0)",width:0}),radius:0})})]}},{key:"getSketchStyle",value:function(){return[new l.ZP({fill:new d.Z({color:"rgba(255, 255, 255, 0.5)"}),stroke:new u.Z({color:"rgba(0, 0, 0, 0.5)",width:4}),image:new h.Z({radius:6,fill:new d.Z({color:"rgba(0, 0, 0, 0.5)"}),stroke:new u.Z({color:"rgba(255, 255, 255, 0.5)",width:2})})})]}},{key:"filterByDefaultValue",value:function(e){var t=this;return e.filter((function(e){return t.editSource.editableFields.some((function(t){var i=e.getProperties()[t.name];return!(!t.hidden||i!==t.defaultValue)}))}))}},{key:"loadData",value:function(e,t,i){var s,a=this,c=new URL(e.url),l={},u=(0,n.Z)(c.searchParams.entries());try{for(u.s();!(s=u.n()).done;){var d=(0,o.Z)(s.value,2),h=d[0],p=d[1];l[h.toUpperCase()]=p}}catch(m){u.e(m)}finally{u.f()}var f=(0,r.Z)((0,r.Z)({},l),{},{SERVICE:"WFS",VERSION:"1.1.0",REQUEST:"GetFeature",TYPENAME:e.layers[0],SRSNAME:e.projection}),v=new URLSearchParams(f);c.search=v.toString(),(0,E.hfetch)(c.toString()).then((function(e){if(200!==e.status)return i("data-load-error");e.text().then((function(e){return e.includes("ows:ExceptionReport")?i("data-load-error"):(a.loadDataSuccess(e),i("data-load-success"))}))})).catch((function(e){return console.warn("Error loading vectorsource... ".concat(e)),i("data-load-error")}))}},{key:"editAttributes",value:function(e){this.editFeature=e,this.observer.publish("editFeature",e)}},{key:"featureSelected",value:function(e){var t=this;0===e.selected.length&&this.editAttributes(null,null),e.selected.forEach((function(i){!i.getId()&&i.getProperties().user&&t.select.getFeatures().remove(i),e.mapBrowserEvent.filty=!0,t.editAttributes(i)}))}},{key:"refreshEditingLayer",value:function(){var e=this;this.map.getLayers().getArray().filter((function(t){return t.getProperties().caption===e.editSource.caption})).forEach((function(e){if(e.getSource){var t=e.getSource();if(t.clear&&t.clear(),t.getParams){var i=t.getParams();i.t=(new Date).getMilliseconds(),t.updateParams(i)}t.changed&&t.changed()}}))}},{key:"setLayer",value:function(e,t){var i=this;this.source=this.sources.find((function(t){return t.id===e})),this.filty=!0,this.vectorSource=new g.Z({loader:function(e){return i.loadData(i.source,e,t)},strategy:w.$6,projection:this.source.projection}),this.layer=new m.Z({layerType:"system",zIndex:5e3,name:"pluginEdit",caption:"Edit layer",source:this.vectorSource,style:this.getVectorStyle()}),this.layer&&this.map.removeLayer(this.layer),this.map.addLayer(this.layer),this.editSource=this.source,this.editFeature=null,this.observer.publish("editSource",this.source),this.observer.publish("editFeature",null),this.observer.publish("layerChanged",this.layer)}},{key:"activateModify",value:function(){var e=this;this.select=new y.Z({style:this.getSelectStyle(),toggleCondition:Z.Fi,layers:[this.layer]}),this.select.on("select",(function(t){e.featureSelected(t,e.source)})),this.modify=new b.Z({features:this.select.getFeatures()}),this.map.addInteraction(this.select),this.map.addInteraction(this.modify)}},{key:"activateAdd",value:function(e){var t=this;this.draw=new k.ZP({source:this.vectorSource,style:this.getSketchStyle(),type:e,stopClick:!0,geometryName:this.geometryName}),this.draw.on("drawend",(function(e){e.feature.modification="added",t.editAttributes(e.feature),setTimeout((function(){t.deactivateInteraction()}),1)})),this.map.addInteraction(this.draw),this.map.clickLock.add("edit")}},{key:"activateRemove",value:function(){this.remove=!0,this.map.on("singleclick",this.removeSelected)}},{key:"activateMove",value:function(){this.move=new S.Z({layers:[this.layer]}),this.map.addInteraction(this.move)}},{key:"activateInteraction",value:function(e,t){"add"===e&&this.activateAdd(t),"move"===e&&this.activateMove(),"modify"===e&&this.activateModify(),"remove"===e&&(this.map.clickLock.add("edit"),this.activateRemove()),this.map.snapHelper.add("measure")}},{key:"deactivateInteraction",value:function(){this.map.snapHelper.delete("measure"),this.select&&this.map.removeInteraction(this.select),this.modify&&this.map.removeInteraction(this.modify),this.draw&&this.map.removeInteraction(this.draw),this.move&&this.map.removeInteraction(this.move),this.remove&&(this.remove=!1,this.map.clickLock.delete("edit"),this.map.un("singleclick",this.removeSelected))}},{key:"reset",value:function(){this.editSource=void 0,this.editFeature=void 0,this.removeFeature=void 0,this.removalToolMode="off",this.filty=!1,this.map.clickLock.delete("edit"),this.layer&&(this.map.removeLayer(this.layer),this.layer=void 0),this.deactivateInteraction()}},{key:"deactivate",value:function(){this.reset(),this.observer.publish("editFeature",this.editFeature),this.observer.publish("editSource",this.editSource),this.observer.publish("deactivate")}},{key:"getSources",value:function(){return this.options.sources}}]),e}();t.default=F}}]);
//# sourceMappingURL=5215.56c882fd.chunk.js.map